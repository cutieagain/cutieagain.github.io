<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>docker-å¤šå®¹å™¨é—´äº¤äº’</title>
      <link href="2021/02/21/docker/docker-%E5%A4%9A%E5%AE%B9%E5%99%A8%E9%97%B4%E4%BA%A4%E4%BA%92/"/>
      <url>2021/02/21/docker/docker-%E5%A4%9A%E5%AE%B9%E5%99%A8%E9%97%B4%E4%BA%A4%E4%BA%92/</url>
      
        <content type="html"><![CDATA[<p><a href="https://docs.docker.com/get-started/07_multi_container/">docker-å¤šå®¹å™¨åº”ç”¨å®˜ç½‘ç¤ºä¾‹</a></p><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨ä½¿ç”¨å•ä¸ªå®¹å™¨åº”ç”¨ç¨‹åºã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬ç°åœ¨æƒ³å°†MySQLæ·»åŠ åˆ°åº”ç”¨ç¨‹åºå †æ ˆä¸­ã€‚é€šå¸¸ä¼šå‡ºç°ä»¥ä¸‹é—®é¢˜-â€œ MySQLå°†åœ¨å“ªé‡Œè¿è¡Œï¼Ÿå°†å®ƒå®‰è£…åœ¨åŒä¸€ä¸ªå®¹å™¨ä¸­è¿˜æ˜¯å•ç‹¬è¿è¡Œï¼Ÿâ€ é€šå¸¸ï¼Œ<strong>æ¯ä¸ªå®¹å™¨éƒ½åº”è¯¥åšä¸€ä»¶äº‹æƒ…å¹¶åšå¥½ã€‚</strong>åŸå› å¦‚ä¸‹ï¼š</p><ul><li>æ‚¨å¾ˆæœ‰å¯èƒ½éœ€è¦ä»¥ä¸æ•°æ®åº“ä¸åŒçš„æ–¹å¼æ‰©å±•APIå’Œå‰ç«¯</li><li>å•ç‹¬çš„å®¹å™¨å¯è®©æ‚¨éš”ç¦»ç‰ˆæœ¬å’Œæ›´æ–°ç‰ˆæœ¬</li><li>è™½ç„¶æ‚¨å¯ä»¥åœ¨æœ¬åœ°ä½¿ç”¨æ•°æ®åº“çš„å®¹å™¨ï¼Œä½†å¯èƒ½è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨æ•°æ®åº“çš„æ‰˜ç®¡æœåŠ¡ã€‚ç„¶åï¼Œæ‚¨ä¸æƒ³éšåº”ç”¨ç¨‹åºä¸€èµ·æä¾›æ•°æ®åº“å¼•æ“ã€‚</li><li>è¿è¡Œå¤šä¸ªè¿›ç¨‹å°†éœ€è¦ä¸€ä¸ªè¿›ç¨‹ç®¡ç†å™¨ï¼ˆå®¹å™¨ä»…å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ï¼‰ï¼Œè¿™å¢åŠ äº†å®¹å™¨å¯åŠ¨/å…³é—­çš„å¤æ‚æ€§</li></ul><p>è¿˜æœ‰æ›´å¤šåŸå› ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†æ›´æ–°æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä½¿å…¶å·¥ä½œå¦‚ä¸‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221170100.png" alt="Todo Appå·²è¿æ¥åˆ°MySQLå®¹å™¨"></p><h2 id="å®¹å™¨ç½‘ç»œ"><a href="#å®¹å™¨ç½‘ç»œ" class="headerlink" title="å®¹å™¨ç½‘ç»œ"></a>å®¹å™¨ç½‘ç»œ</h2><p>è¯·è®°ä½ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå®¹å™¨æ˜¯ç‹¬ç«‹è¿è¡Œçš„ï¼Œå¹¶ä¸”å¯¹åŒä¸€å°è®¡ç®—æœºä¸Šçš„å…¶ä»–è¿›ç¨‹æˆ–å®¹å™¨ä¸€æ— æ‰€çŸ¥ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•å…è®¸ä¸€ä¸ªå®¹å™¨ä¸å¦ä¸€ä¸ªå®¹å™¨å¯¹è¯ï¼Ÿç­”æ¡ˆæ˜¯ <strong>ç½‘ç»œ</strong>ã€‚ç°åœ¨ï¼Œæ‚¨ä¸å¿…æ˜¯ç½‘ç»œå·¥ç¨‹å¸ˆï¼ˆä¸‡å²ï¼ï¼‰ã€‚åªè¦è®°ä½è¿™ä¸ªè§„åˆ™â€¦</p><blockquote><p><strong>ç¬”è®°</strong></p><p>å¦‚æœä¸¤ä¸ªå®¹å™¨åœ¨åŒä¸€ç½‘ç»œä¸Šï¼Œå®ƒä»¬å¯ä»¥ç›¸äº’é€šä¿¡ã€‚å¦‚æœä¸æ˜¯ï¼Œä»–ä»¬å°±ä¸ä¼šã€‚</p></blockquote><h2 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h2><p>æœ‰ä¸¤ç§å°†å®¹å™¨æ”¾ç½®åœ¨ç½‘ç»œä¸Šçš„æ–¹æ³•ï¼š1ï¼‰åœ¨å¼€å§‹æ—¶åˆ†é…å®ƒï¼Œæˆ–2ï¼‰è¿æ¥ç°æœ‰å®¹å™¨ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†é¦–å…ˆåˆ›å»ºç½‘ç»œå¹¶åœ¨å¯åŠ¨æ—¶é™„åŠ MySQLå®¹å™¨ã€‚</p><ol><li><p>åˆ›å»ºç½‘ç»œã€‚</p><pre class="line-numbers language-none"><code class="language-none">docker network create todo-app<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>å¯åŠ¨ä¸€ä¸ªMySQLå®¹å™¨å¹¶å°†å…¶é™„åŠ åˆ°ç½‘ç»œã€‚æˆ‘ä»¬è¿˜å°†å®šä¹‰ä¸€äº›ç¯å¢ƒå˜é‡ï¼Œæ•°æ®åº“å°†ä½¿ç”¨è¿™äº›å˜é‡æ¥åˆå§‹åŒ–æ•°æ®åº“ï¼ˆè¯·å‚è§<a href="https://hub.docker.com/_/mysql/">MySQL Docker Hubåˆ—è¡¨ä¸­</a>çš„â€œç¯å¢ƒå˜é‡â€éƒ¨åˆ†ï¼‰ã€‚ <code>docker pull mysql</code></p><pre class="line-numbers language-none"><code class="language-none">docker run -d \    --network todo-app --network-alias mysql \    -v todo-mysql-data:/var/lib/mysql \    -e MYSQL_ROOT_PASSWORD=secret \    -e MYSQL_DATABASE=todos \    mysql:5.7<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœä½¿ç”¨çš„æ˜¯PowerShellï¼Œåˆ™ä½¿ç”¨æ­¤å‘½ä»¤ã€‚</p><pre class="line-numbers language-none"><code class="language-none">docker run -d `    --network todo-app --network-alias mysql `    -v todo-mysql-data:/var/lib/mysql `    -e MYSQL_ROOT_PASSWORD=secret `    -e MYSQL_DATABASE=todos `    mysql:5.7<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‚¨è¿˜å°†çœ‹åˆ°æˆ‘ä»¬æŒ‡å®šäº†<code>--network-alias</code>æ ‡å¿—ã€‚æˆ‘ä»¬ç¨åå†è®²ã€‚</p><blockquote><p><strong>å°è´¹</strong></p><p>æ‚¨ä¼šæ³¨æ„åˆ°æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯<code>todo-mysql-data</code>è¿™é‡Œå‘½åçš„å·ï¼Œå¹¶å°†å…¶æŒ‚è½½<code>/var/lib/mysql</code>åœ¨MySQLå­˜å‚¨æ•°æ®çš„ä½ç½®ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬ä»æœªè¿è¡Œè¿‡<code>docker volume create</code>å‘½ä»¤ã€‚Dockerè®¤è¯†åˆ°æˆ‘ä»¬è¦ä½¿ç”¨å‘½åå·ï¼Œå¹¶è‡ªåŠ¨ä¸ºæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªã€‚</p></blockquote></li><li><p>ä¸ºäº†ç¡®è®¤æˆ‘ä»¬å·²å¯åŠ¨å¹¶è¿è¡Œæ•°æ®åº“ï¼Œè¯·è¿æ¥åˆ°æ•°æ®åº“å¹¶éªŒè¯å…¶æ˜¯å¦è¿æ¥ã€‚</p><pre class="line-numbers language-none"><code class="language-none">docker exec -it &lt;mysql-container-id&gt; mysql -p<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å½“å‡ºç°å¯†ç æç¤ºæ—¶ï¼Œè¾“å…¥<strong>secret</strong>ã€‚åœ¨MySQL Shellä¸­ï¼Œåˆ—å‡ºæ•°æ®åº“å¹¶ç¡®è®¤æ‚¨çœ‹åˆ°è¯¥<code>todos</code>æ•°æ®åº“ã€‚</p><pre class="line-numbers language-cli" data-language="cli"><code class="language-cli">mysql&gt; SHOW DATABASES;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ‚¨åº”è¯¥çœ‹åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„è¾“å‡ºï¼š</p><pre class="line-numbers language-none"><code class="language-none">+--------------------+| Database           |+--------------------+| information_schema || mysql              || performance_schema || sys                || todos              |+--------------------+5 rows in set (0.00 sec)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸‡å²ï¼æˆ‘ä»¬æœ‰æˆ‘ä»¬çš„<code>todos</code>æ•°æ®åº“ï¼Œå¯ä»¥éšæ—¶ä½¿ç”¨ï¼</p></li></ol><h2 id="è¿æ¥åˆ°"><a href="#è¿æ¥åˆ°" class="headerlink" title="è¿æ¥åˆ°"></a>è¿æ¥åˆ°</h2><p>ç°åœ¨æˆ‘ä»¬çŸ¥é“MySQLå·²å¯åŠ¨å¹¶æ­£åœ¨è¿è¡Œï¼Œè®©æˆ‘ä»¬ä½¿ç”¨å®ƒå§ï¼ä½†æ˜¯ï¼Œé—®é¢˜æ˜¯â€¦å¦‚ä½•ï¼Ÿå¦‚æœæˆ‘ä»¬åœ¨åŒä¸€ç½‘ç»œä¸Šè¿è¡Œå¦ä¸€ä¸ªå®¹å™¨ï¼Œæˆ‘ä»¬å¦‚ä½•æ‰¾åˆ°è¯¥å®¹å™¨ï¼ˆè®°ä½æ¯ä¸ªå®¹å™¨éƒ½æœ‰è‡ªå·±çš„IPåœ°å€ï¼‰ï¼Ÿ</p><p>ä¸ºäº†å¼„æ¸…æ¥šè¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<a href="https://github.com/nicolaka/netshoot">nicolaka / netshoot</a>å®¹å™¨ï¼Œè¯¥å®¹å™¨é™„å¸¦äº†<em>è®¸å¤š</em>å·¥å…·ï¼Œå¯ç”¨äºå¯¹ç½‘ç»œé—®é¢˜è¿›è¡Œæ•…éšœæ’é™¤æˆ–è°ƒè¯•ã€‚</p><ol><li><p>ä½¿ç”¨nicolaka / netshootæ˜ åƒå¯åŠ¨ä¸€ä¸ªæ–°å®¹å™¨ã€‚ç¡®ä¿å°†å…¶è¿æ¥åˆ°åŒä¸€ç½‘ç»œã€‚</p><pre class="line-numbers language-none"><code class="language-none">docker run -it --network todo-app nicolaka/netshoot<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>åœ¨å®¹å™¨å†…éƒ¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<code>dig</code>å‘½ä»¤ï¼Œè¿™æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„DNSå·¥å…·ã€‚æˆ‘ä»¬å°†æŸ¥æ‰¾ä¸»æœºåçš„IPåœ°å€<code>mysql</code>ã€‚</p><pre class="line-numbers language-none"><code class="language-none">dig mysql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™æ ·æ‚¨å°†å¾—åˆ°ä¸€ä¸ªè¾“å‡ºâ€¦</p><pre class="line-numbers language-none"><code class="language-none">; &lt;&lt;&gt;&gt; DiG 9.14.1 &lt;&lt;&gt;&gt; mysql;; global options: +cmd;; Got answer:;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 32162;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0   ;; QUESTION SECTION:;mysql.INA   ;; ANSWER SECTION:mysql.600INA172.23.0.2   ;; Query time: 0 msec;; SERVER: 127.0.0.11#53(127.0.0.11);; WHEN: Tue Oct 01 23:47:24 UTC 2019;; MSG SIZE  rcvd: 44<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨â€œç­”å¤éƒ¨åˆ†â€ä¸­ï¼Œæ‚¨å°†çœ‹åˆ°è§£å†³è¯¥é—®é¢˜çš„<code>A</code>è®°å½• ï¼ˆæ‚¨çš„IPåœ°å€å¾ˆå¯èƒ½å…·æœ‰ä¸åŒçš„å€¼ï¼‰ã€‚å°½ç®¡é€šå¸¸ä¸æ˜¯æœ‰æ•ˆçš„ä¸»æœºåï¼Œä½†Dockerèƒ½å¤Ÿå°†å…¶è§£æä¸ºå…·æœ‰è¯¥ç½‘ç»œåˆ«åçš„å®¹å™¨çš„IPåœ°å€ï¼ˆè¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„ æ ‡å¿—å—ï¼Ÿï¼‰ã€‚<code>mysql``172.23.0.2``mysql``--network-alias</code></p><p>è¿™æ„å‘³ç€â€¦æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä»…éœ€è¦è¿æ¥åˆ°åä¸ºçš„ä¸»æœº<code>mysql</code>ï¼Œå®ƒå°†ä¸æ•°æ®åº“å¯¹è¯ï¼æ²¡æœ‰æ¯”è¿™æ›´ç®€å•çš„äº†ï¼</p></li></ol><h2 id="ä¸MySQLè¿è¡Œä½ çš„åº”ç”¨ç¨‹åº"><a href="#ä¸MySQLè¿è¡Œä½ çš„åº”ç”¨ç¨‹åº" class="headerlink" title="ä¸MySQLè¿è¡Œä½ çš„åº”ç”¨ç¨‹åº"></a>ä¸MySQLè¿è¡Œä½ çš„åº”ç”¨ç¨‹åº</h2><p>todoåº”ç”¨ç¨‹åºæ”¯æŒä¸€äº›ç¯å¢ƒå˜é‡çš„è®¾ç½®ï¼Œä»¥æŒ‡å®šMySQLè¿æ¥è®¾ç½®ã€‚ä»–ä»¬æ˜¯ï¼š</p><ul><li><code>MYSQL_HOST</code> -æ­£åœ¨è¿è¡Œçš„MySQLæœåŠ¡å™¨çš„ä¸»æœºå</li><li><code>MYSQL_USER</code> -ç”¨äºè¿æ¥çš„ç”¨æˆ·å</li><li><code>MYSQL_PASSWORD</code> -ç”¨äºè¿æ¥çš„å¯†ç </li><li><code>MYSQL_DB</code> -è¿æ¥åè¦ä½¿ç”¨çš„æ•°æ®åº“</li></ul><blockquote><p><strong>é€šè¿‡ç¯å¢ƒå˜é‡è®¾ç½®è¿æ¥è®¾ç½®</strong></p><p>å°½ç®¡é€šå¸¸å¯ä»¥ä½¿ç”¨env varsè®¾ç½®è¿æ¥è®¾ç½®ä»¥è¿›è¡Œå¼€å‘ï¼Œä½†æ˜¯ åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œåº”ç”¨ç¨‹åºæ—¶ï¼Œ<strong>å¼ºçƒˆå»ºè®®ä¸è¦</strong>ä½¿ç”¨å®ƒã€‚Dockerçš„å‰å®‰å…¨ä¸»ç®¡Diogo Monica <a href="https://diogomonica.com/2017/03/27/why-you-shouldnt-use-env-variables-for-secret-data/">å†™äº†ä¸€ç¯‡å¾ˆæ£’çš„åšå®¢æ–‡ç« ï¼Œ</a> è§£é‡Šäº†ä¸ºä»€ä¹ˆã€‚</p><p>ä¸€ç§æ›´å®‰å…¨çš„æœºåˆ¶æ˜¯ä½¿ç”¨å®¹å™¨ç¼–æ’æ¡†æ¶æä¾›çš„ç§˜å¯†æ”¯æŒã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™äº›æœºå¯†ä¼šä½œä¸ºæ–‡ä»¶å®‰è£…åœ¨æ­£åœ¨è¿è¡Œçš„å®¹å™¨ä¸­ã€‚æ‚¨ä¼šçœ‹åˆ°è®¸å¤šåº”ç”¨ç¨‹åºï¼ˆåŒ…æ‹¬MySQLæ˜ åƒå’Œtodoåº”ç”¨ç¨‹åºï¼‰ä¹Ÿæ”¯æŒå¸¦æœ‰<code>_FILE</code>åç¼€çš„env varï¼Œä»¥æŒ‡å‘åŒ…å«å˜é‡çš„æ–‡ä»¶ã€‚</p><p>ä¾‹å¦‚ï¼Œè®¾ç½®<code>MYSQL_PASSWORD_FILE</code>varå°†ä½¿åº”ç”¨ç¨‹åºå°†å¼•ç”¨æ–‡ä»¶çš„å†…å®¹ç”¨ä½œè¿æ¥å¯†ç ã€‚Dockerä¸åšä»»ä½•æ”¯æŒè¿™äº›ç¯å¢ƒå˜é‡çš„äº‹æƒ…ã€‚æ‚¨çš„åº”ç”¨å°†éœ€è¦çŸ¥é“å¯»æ‰¾å˜é‡å¹¶è·å–æ–‡ä»¶å†…å®¹ã€‚</p></blockquote><p>åœ¨è§£é‡Šäº†æ‰€æœ‰è¿™äº›å†…å®¹ä¹‹åï¼Œè®©æˆ‘ä»¬å¼€å§‹å¼€å‘å°±ç»ªå®¹å™¨ï¼</p><ol><li><p>æˆ‘ä»¬å°†æŒ‡å®šä¸Šé¢çš„æ¯ä¸ªç¯å¢ƒå˜é‡ï¼Œå¹¶å°†å®¹å™¨è¿æ¥åˆ°æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºç½‘ç»œã€‚</p><pre class="line-numbers language-none"><code class="language-none">docker run -dp 3000:3000 \  -w /app -v "$(pwd):/app" \  --network todo-app \  -e MYSQL_HOST=mysql \  -e MYSQL_USER=root \  -e MYSQL_PASSWORD=secret \  -e MYSQL_DB=todos \  node:12-alpine \  sh -c "yarn install &amp;&amp; yarn run dev"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœä½¿ç”¨çš„æ˜¯PowerShellï¼Œåˆ™ä½¿ç”¨æ­¤å‘½ä»¤ã€‚</p><pre class="line-numbers language-none"><code class="language-none">docker run -dp 3000:3000 `  -w /app -v "$(pwd):/app" `  --network todo-app `  -e MYSQL_HOST=mysql `  -e MYSQL_USER=root `  -e MYSQL_PASSWORD=secret `  -e MYSQL_DB=todos `  node:12-alpine `  sh -c "yarn install &amp;&amp; yarn run dev"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å¦‚æœæˆ‘ä»¬æŸ¥çœ‹å®¹å™¨ï¼ˆ<code>docker logs &lt;container-id&gt;</code>ï¼‰çš„æ—¥å¿—ï¼Œåˆ™åº”è¯¥çœ‹åˆ°ä¸€æ¡æ¶ˆæ¯ï¼Œè¡¨æ˜å®ƒæ­£åœ¨ä½¿ç”¨mysqlæ•°æ®åº“ã€‚</p><pre class="line-numbers language-none"><code class="language-none"># Previous log messages omitted$ nodemon src/index.js[nodemon] 1.19.2[nodemon] to restart at any time, enter `rs`[nodemon] watching dir(s): *.*[nodemon] starting `node src/index.js`Connected to mysql db at host mysqlListening on port 3000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€åº”ç”¨ç¨‹åºï¼Œç„¶åå‘å¾…åŠäº‹é¡¹åˆ—è¡¨ä¸­æ·»åŠ ä¸€äº›é¡¹ç›®ã€‚</p></li><li><p>è¿æ¥åˆ°mysqlæ•°æ®åº“å¹¶è¯æ˜é¡¹ç›®å·²è¢«å†™å…¥æ•°æ®åº“ã€‚è®°ä½ï¼Œå¯†ç æ˜¯<strong>ç§˜å¯†çš„</strong>ã€‚</p><pre class="line-numbers language-none"><code class="language-none">docker exec -it &lt;mysql-container-id&gt; mysql -p todos<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç„¶ååœ¨mysql shellä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><pre class="line-numbers language-none"><code class="language-none">mysql&gt; select * from todo_items;+--------------------------------------+--------------------+-----------+| id                                   | name               | completed |+--------------------------------------+--------------------+-----------+| c906ff08-60e6-44e6-8f49-ed56a0853e85 | Do amazing things! |         0 || 2912a79e-8486-4bc3-a4c5-460793a575ab | Be awesome!        |         0 |+--------------------------------------+--------------------+-----------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ˜¾ç„¶ï¼Œæ‚¨çš„è¡¨çœ‹èµ·æ¥ä¼šæœ‰æ‰€ä¸åŒï¼Œå› ä¸ºå®ƒåŒ…å«æ‚¨çš„é¡¹ç›®ã€‚ä½†æ˜¯ï¼Œæ‚¨åº”è¯¥çœ‹åˆ°å®ƒä»¬å­˜å‚¨åœ¨è¿™é‡Œï¼</p></li></ol><p>å¦‚æœå¿«é€Ÿæµè§ˆDocker Dashboardï¼Œæ‚¨ä¼šçœ‹åˆ°æˆ‘ä»¬æœ‰ä¸¤ä¸ªæ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºå®¹å™¨ã€‚ä½†æ˜¯ï¼Œæ²¡æœ‰çœŸæ­£çš„è¿¹è±¡è¡¨æ˜å®ƒä»¬åœ¨å•ä¸ªåº”ç”¨ç¨‹åºä¸­ç»„åˆåœ¨ä¸€èµ·ã€‚æˆ‘ä»¬å¾ˆå¿«å°±ä¼šçœ‹åˆ°å¦‚ä½•ä½¿å®ƒå˜å¾—æ›´å¥½ï¼</p><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221170125.png" alt="Docker Dashboardæ˜¾ç¤ºäº†ä¸¤ä¸ªæœªåˆ†ç»„çš„åº”ç”¨ç¨‹åºå®¹å™¨"></p><h2 id="å›é¡¾"><a href="#å›é¡¾" class="headerlink" title="å›é¡¾"></a>å›é¡¾</h2><p>è‡³æ­¤ï¼Œæˆ‘ä»¬æœ‰äº†ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œè¯¥åº”ç”¨ç¨‹åºç°åœ¨å°†å…¶æ•°æ®å­˜å‚¨åœ¨è¿è¡Œåœ¨å•ç‹¬å®¹å™¨ä¸­çš„å¤–éƒ¨æ•°æ®åº“ä¸­ã€‚æˆ‘ä»¬äº†è§£äº†ä¸€äº›æœ‰å…³å®¹å™¨ç½‘ç»œçš„çŸ¥è¯†ï¼Œå¹¶äº†è§£äº†å¦‚ä½•ä½¿ç”¨DNSæ‰§è¡ŒæœåŠ¡å‘ç°ã€‚</p><p>ä½†æ˜¯ï¼Œæ‚¨å¾ˆæœ‰å¯èƒ½å¼€å§‹å¯¹å¯åŠ¨æ­¤åº”ç”¨ç¨‹åºæ‰€éœ€åšçš„ä¸€åˆ‡æ„Ÿåˆ°æœ‰ç‚¹ä¸çŸ¥æ‰€æªã€‚æˆ‘ä»¬å¿…é¡»åˆ›å»ºä¸€ä¸ªç½‘ç»œï¼Œå¯åŠ¨å®¹å™¨ï¼ŒæŒ‡å®šæ‰€æœ‰ç¯å¢ƒå˜é‡ï¼Œå…¬å¼€ç«¯å£ç­‰ç­‰ï¼è¿™è¦è®°ä½å¾ˆå¤šï¼Œè¿™è‚¯å®šä¼šä½¿äº‹æƒ…å¾ˆéš¾ä¼ é€’ç»™å…¶ä»–äººã€‚</p><p>åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºDocker Composeã€‚å€ŸåŠ©Docker Composeï¼Œæˆ‘ä»¬å¯ä»¥ä»¥ä¸€ç§æ›´ç®€å•çš„æ–¹å¼å…±äº«æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå †æ ˆï¼Œå¹¶å…è®¸å…¶ä»–äººä½¿ç”¨ä¸€ä¸ªï¼ˆç®€å•çš„ï¼‰å‘½ä»¤å°†å®ƒä»¬æ—‹è½¬èµ·æ¥ï¼</p><h2 id="æ‰§è¡Œæµç¨‹è®°å½•"><a href="#æ‰§è¡Œæµç¨‹è®°å½•" class="headerlink" title="æ‰§è¡Œæµç¨‹è®°å½•"></a>æ‰§è¡Œæµç¨‹è®°å½•</h2><pre class="line-numbers language-none"><code class="language-none">cutiedeMacBook-Pro:app cutie$ docker network create todo-app289342da8341dc4957bdc9e797242dad9a4e3eb26fbb982d0480a191b6f803bbcutiedeMacBook-Pro:app cutie$ docker run -d \&gt;      --network todo-app --network-alias mysql \&gt;      -v todo-mysql-data:/var/lib/mysql \&gt;      -e MYSQL_ROOT_PASSWORD=secret \&gt;      -e MYSQL_DATABASE=todos \&gt;      mysql:5.7cd2f6e9da40e7658e639f0222de723b4b2444295cb76fbcb2ffa60feac97be7bcutiedeMacBook-Pro:app cutie$ docker exec -it cd2f6e9da40e7658e639f0222de723b4b2444295cb76fbcb2ffa60feac97be7b  mysql -pEnter password:ERROR 1045 (28000): Access denied for user 'root'@'localhost' (using password: YES)cutiedeMacBook-Pro:app cutie$ docker exec -it cd2f6e9da40e7658e639f0222de723b4b2444295cb76fbcb2ffa60feac97be7b  mysql -pEnter password:ERROR 1045 (28000): Access denied for user 'root'@'localhost' (using password: YES)cutiedeMacBook-Pro:app cutie$ docker exec -it cd2f6e9da40e7658e639f0222de723b4b2444295cb76fbcb2ffa60feac97be7b  mysql -pEnter password:Welcome to the MySQL monitor.  Commands end with ; or \g.Your MySQL connection id is 4Server version: 5.7.32 MySQL Community Server (GPL)Copyright (c) 2000, 2020, Oracle and/or its affiliates. All rights reserved.Oracle is a registered trademark of Oracle Corporation and/or itsaffiliates. Other names may be trademarks of their respectiveowners.Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.mysql&gt; SHOW DATABASES;+--------------------+| Database           |+--------------------+| information_schema || mysql              || performance_schema || sys                || todos              |+--------------------+5 rows in set (0.01 sec)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">cutiedeMacBook-Pro:app cutie$ docker run -it --network todo-app nicolaka/netshootUnable to find image 'nicolaka/netshoot:latest' locallylatest: Pulling from nicolaka/netshoot4c0d98bf9879: Downloadingdf962687d630: Download completef4b598a64a46: Download completea3f487e8dfcb: Download complete0d084d29b530: Download completec40275cdc1a4: Download complete53d8247f861d: Download completelatest: Pulling from nicolaka/netshoot4c0d98bf9879: Pull completedf962687d630: Pull completef4b598a64a46: Pull completea3f487e8dfcb: Pull complete0d084d29b530: Pull completec40275cdc1a4: Pull complete53d8247f861d: Pull completeDigest: sha256:6ae5a524ab390824a43a29a8a2ec7b9c013736d98a0aed264f1132196098aac2Status: Downloaded newer image for nicolaka/netshoot:latest                    dP            dP                           dP                    88            88                           8888d888b. .d8888b. d8888P .d8888b. 88d888b. .d8888b. .d8888b. d8888P88'  `88 88ooood8   88   Y8ooooo. 88'  `88 88'  `88 88'  `88   8888    88 88.  ...   88         88 88    88 88.  .88 88.  .88   88dP    dP `88888P'   dP   `88888P' dP    dP `88888P' `88888P'   dPWelcome to Netshoot! (github.com/nicolaka/netshoot)root @ / [1] ğŸ³  â†’ dig mysql; &lt;&lt;&gt;&gt; DiG 9.16.11 &lt;&lt;&gt;&gt; mysql;; global options: +cmd;; Got answer:;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 53757;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0;; QUESTION SECTION:;mysql.INA;; ANSWER SECTION:mysql.600INA172.19.0.2;; Query time: 4 msec;; SERVER: 127.0.0.11#53(127.0.0.11);; WHEN: Sun Feb 21 09:48:10 UTC 2021;; MSG SIZE  rcvd: 44<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ—¥è®°20210221</title>
      <link href="2021/02/21/%E6%97%A5%E8%AE%B0/%E6%97%A5%E8%AE%B0-20210221/"/>
      <url>2021/02/21/%E6%97%A5%E8%AE%B0/%E6%97%A5%E8%AE%B0-20210221/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="33cc73a5f8d2549e6c89dfe333dc5a8460b687d0ee7ac5b199010aefe4063273">675ef3242d144ff249cb5b90ca678376166165578abddbd822aecd43a16808c1e034c13215e1aa5d1915b7f1e9fa7947bede05dfbe49d081f4154959ab3872efb169caf5ade0e9eeaf5d9a758d0e48ed1803dc65d8fc0cceeb76aa9637b66728172d393504be71d92bdb4e0e4887dd97bdc55164377c8a3fcae04a8d23a48ed724d6d6394e498ab93c2a946db359dbb0afcd6c92b3c59840c3ec48935e3b6f1bc603e359a73e1a4c9b8d4e878b1fdb7c8d5b84fe05e59f5621948662e3f34479ca6d6f0698e95bd3955f78072d48f1b1aab8ba57ef27afe498a7b3afb47ee9951127d68bb220856a24622f8a35c3dfe84f1fb44ef1f45602a606a0b1b577c36463b9f7664c86629d66a91aa6702f1504501602420e7b793e5242c7cdc9c1f2ab7d9eeb5d79f29c39b78f28425442af2a5fd6dad331b4cac420bbd7f8806cf4e665db82343160921fe5d936bbec336ed2938b9ee029c747396fa4c60a8f019422286226041fd913af8558fec507cf56232fc39b14a5645ec033e74ccfdb3413dc138d4d2ca5ad884fe456ec423549c003255cddd007eb0545b67645a86a8ec7bf9522b01ace7ae25f0241696fad5fc6d4f66c16f00e460614aacbc4c0c98ebf0fbe15d8d513fa1dcf2ad8910c354669a48bdb5e0581261b6e5661f672793e0bb91b5cabbf26d0558ee44e2616ac12cb502df8a9821ab4782fc3d3660a0f8f7549292ebf79c348a36835b852132d376fa941c7a19f411e894d0f83317b65881d694add538421131e51decb60a75b5314a1268afe9996e4f928609b38ae6a69128f3136c8a0f816e8021453887f6175966575fb71ef431cb2886205887584820e65daf8649ec50743bb45ec136c3f9adccc3b4cbf9d848ef75c168c4844cd6e760bd6139d79a82e736f3d39ec6019baf9571cd92134eec354a61bbda79cd045d5b26aebf0398dedfdfcce4c60425e904ebba816ecbdcabe353dde311e85d8af4ce904aab36622b093ae1645757da8168546580d18fcd349e708984fc99c7e468ba3d2df486b0fc57cf6d1683802016fe4c4a31cefa8a51e31c499fc13673621c61c274510ce6de8bf36bcd4e38aa36e99772be8e4533f5853849a4562296dde59015ee6f7d3902cf233cd7c6546167d78926cb17906bae38e1706bcc0febcde39c373a175829881c68b99838509efdfb0c93d188dc02745ad6f158e8c480e32487c153e4715a74f9753cb747bb55ca5f95a23426e992ec0d7c4d08bffd2638b56ad8168c933ce28455aacd7fddf5af1c98a4286cb7a739441ad5a3308d57f6c76aa17e18bf27561e52b6668eda263bc14c91ea68426ca0592bf922020d1a9915c8c3ff2db071f437b97406b4f960ed944270248d799fdcd74093f6b2f4787acecb3b1d57942594cbafe5428fe6b74782af316fb933e51d2a6c10b373db5e96c11b06fcafe56be2b3afc22528885d18b2dc21d3d12f246236343a7c1b6f21ff642b5e885c55f1aa7aca8c0c0b8c4ccb9eecb6e4002dd459d6e891e81abaaab313b397cce43143125a159ca90e258f498a4d2f993dfc7594daaea4686b91360838f88ec135441768981aaf8c4ce73a0996654de9410dfdfc416f7d7dfeb27e85fe971f71686c674e367745864ee6e2313949663ffe99e8f8042d229928ed6b948c267f3db8b1e705a831ee0859cfbe09731519aa2a5176b5b203ffdfa1154cd89091336d4fa36ae33c5779669af91653b0cb4c57bddc93682ceb2b4a0fbbf676341ae7dbe60e0fa109d6eca8c0f30924dbfa98409bf61cfebb5522e3bc5de6936ab7eb5ce47e1a74cc107bced3ae1c898c5fcaef1d81857c5901787ef5f88f1906075938cf1238a935453bb9b935ffba306fa3fa373d2cc705537421f743912c894b07ba556f2148db9046e4b19061e05b469b44b95a50e386c6469ad01015dd1a497a7c0c770aa2f2a35eada40514cac4592500b10730e550b4666b6a27ad9e247562133d2da825a00642a2d503c995c8c70c3a327218530d05a26f070ab7ce9af2caa7194c74c1326b7c3544fe8809fef85be3cf91402ebecd62838cac2a68c687112574ca7e852d39563f81fcfcdb4646f4fd0390e289dad67575ec0cb62f096009b55c3aa0c2f60367693e2f988f02f2af5290970e0d1e4a09a42d7fbaeca594d40860e60c0548f56a997131d76cac9fb96df55a102cf34759e12ed27802dde363060ccdf8b2ceef00aeddc4f9d2563a078d630960bd928ed2a83dcbdc7aafff4751c32a8b4613a3efed7bc37b3c0d66a65b2e988f6486394e682e7f14cbd0c3b137eb314b83b831c1f84f650d3b838db71034e4af61d4dc3c5438d0cb429c3a513ce894abe2bed8e29f12c4d2ddde6216428b37c40cbaf99c071c77de9e98ee4c7041507b51e147cc08ca0154073a4a844c0d1a2b363dbf97084db672e35ca338a6bf64f2c39bd2d60408f1dcb6aef624a697115b6d2d655a1b290743e3678be628bd8a45f8feb4cc62be4ada76af71d075be178dc9a5bc514df34357ce22e5a2c9163a1302356fa2bd211b3975e5be13ae3e34feb0cd3b23c634a81e10fe5aa8b3de4dc96f1c6427691dfacb45e4620ecdf37e071117ec8b553cfebde032f0a7fe41c2137ea72fce647fadd8e639ed10c46d46597a754ea92d134ce02f260f3ac2a0cb1a0dd752ad4a8c122f8f3a581b4aca76674d0e2498f199744b946caa464b6c89624af4722ab479679e40613a56e8a71ac0a8c2f51e2e834ad151700c2fb501622155fad3dc4b0f767808d5d9a848db8b0520646728ae99280f90ccf3054f9fb657c1eaa8ffbc2c7f1ccb7e3338be3a7e0b0710403f2224095ed101e1ca623e39cafb1de7fcf019852406090e373d62b3c22d146fff35737a0dc4aa5aae97061a3c9b75c318ddc0088927c5ecf6ba4991010ec8c8915a47e00b2c781e3ce2565c852893705db4e7877ad9b960589844bf2aadfe8fdd1dff05c4f5c53cd039b55f033dd2b21abd018b634aeb03e1f57fe2fd7ae8baf944bbdf6ec863857862eed0a069990e2a31b584a3cf21f09bd083f8310660f3c22857b7ba6b86753e78c59f27df6870d680179721b18e41c2c9344ffa7a8b492706584fa0d2db276b117d4385a4b2208e8ab18b9eca2921c63e8ea25e07477ef77ad31c2abf2c98410b1961511fbee15477cd28e60e95f799fb3a1e7133fc69ac8f18c04764349058bed699f5262098ac13d6252b4aa317ed71baa87916b344d07c4e2a0aff74cdbffbf319c503642062ea68713765ec6b87c5952ba636d61afcf03d5be6a68bcc92cf1eb0e18b7da034fa54297eba6d3b5a7eecb1753fdd2857aa765fd8a32f010df5a202060c6455e49ef271bf6958e056384ef77d71f1008cf628a24920711b91c330079f50adb71be85aebc69782a2fb61a9af267b2d10813da6ae7dea5fef3f0bf59b76c971e9034e230ead1a0729e5f405ab6d636d75112eb0de165b772d696e85e1550e79123469cc06231737f8ea0fd992799ab44815c859d9cb3ec0ff9f54ff8e3eae8cf99fdceccf70c9fa113fb95fa25bfbe29755c6138f3c4449b311c83c3c1f3c2eb32d22344d3e8c184a3dbad05d12670bf895e55fac7769e522fd2a8a67cd639daacc767dd9cd934f6d37fb071c14be36bdddd971ad2caa871c3a37774dd6c1b94536e3587ae986878946456b03fcb5ded9034003a3ab17dfdfa923fc16e0f5b67a3e6912a50aef130fcbaa000b1a766c6fe7ead05b4c7db599c515bfd4f5bf7c510eef453405ad9edd4c71a97a5cc730f6c0d957ad2ab493e479ef9934ad8858ad6e46e40d4c97c617268dffaeb5083724e3f1861883cf6e3972f1d64060128845e4ef08494f2a05deeae203dc3dde9df3d4f26df0e633e067da611a6a011342d5ff64d09e2a070d07ac7fd14f87a765a4867afc66834b9ec225e70f5d54ee809da23941eed2034d902637567385fcf520711a44d21ecc296a23bfa6af167e00e965318c53c60664b5b63836320db5f8b97d844ade27dc63da4a2e4249e7020f80b4438de23a7e43291dd74285df339b68fa0f37670b0f9b4c5bfc34179a3981eb7b648df8abc930db656da00d1ea9a5bd62223fe7e8331e0a08aaadc66a82dc694da1bf14bf2f11e4344b260bb460d4b26620a5ea16394d6fb12d1327deff252bbe2b15670ad5ad39e31690b1b35ec0b606cb0ce9bd4f36d47a7db6e94a89ae8a856e84c6c968275460f87e109543b1f942c73f0ec0ee77e380ee67bcf6c9ac2678ed4556ef1791ae6b751ec7740091818fdfe523ff5e19d2229f323dbe1fd59b166d6c6564c84d6e00e28ca25b69d10ba229d5b4373708be0027164d17d3974e42a29d9b3009451be4e303fe43cab80ffd56d29c55bc2daa735d1f42a31b2a0cb803f62d77f3fd668484beb8d783c389744e904870c0d9331d8f09a20823661bb903ad8ec79c2e8329e4473c820061a90f7ff3e644833dd7438f7080b5c93930523a14c75ea0a3448f835e2b2f15caab6ef1b197cacecd529addad90a48547517d7a1a0ccf6dbfb45aa0545482e8cf66f1e57ff7f93b8f586281bbe11cb12d61159cf9eaa3d24d060f0c79ad1fe061b1c607300d29e6f629eacb6e933a2f78a5a6ade89348994c699b71a421ec5f76164e62fe1079843fda68554e5ddac5db3a421c559ca4dfae9cdb825062d2a9365533b4915cd46cac46d4ebc844a9779becfe1b45f5210a663aa</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">è¾“å…¥å¯†ç ï¼ŒæŸ¥çœ‹æ–‡ç« </span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> æ—¥è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ—¥è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>dockerå…¥é—¨</title>
      <link href="2021/02/19/docker/docker%E5%85%A5%E9%97%A8/"/>
      <url>2021/02/19/docker/docker%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="dockerå…¥é—¨"><a href="#dockerå…¥é—¨" class="headerlink" title="dockerå…¥é—¨"></a>dockerå…¥é—¨</h1><h2 id="æ–‡æ¡£"><a href="#æ–‡æ¡£" class="headerlink" title="æ–‡æ¡£"></a>æ–‡æ¡£</h2><p><a href="https://docs.docker.com/">dockerå®˜ç½‘æ–‡æ¡£</a></p><p><a href="https://docs.docker.com/get-started/">dockerå¿«é€Ÿå…¥æ‰‹</a></p><h2 id="dockeræ¦‚è¿°"><a href="#dockeræ¦‚è¿°" class="headerlink" title="dockeræ¦‚è¿°"></a><a href="https://docs.docker.com/get-started/overview/">dockeræ¦‚è¿°</a></h2><p>Dockeræ˜¯ä¸€ä¸ªç”¨äºå¼€å‘ï¼Œå‘å¸ƒå’Œè¿è¡Œåº”ç”¨ç¨‹åºçš„å¼€æ”¾å¹³å°ã€‚Dockerå°†åº”ç”¨ç¨‹åºä¸åŸºç¡€æ¶æ„åˆ†å¼€ï¼Œä»è€Œå¯ä»¥å¿«é€Ÿäº¤ä»˜è½¯ä»¶ã€‚å€ŸåŠ©Dockerå¯ä»¥ä»¥ä¸ç®¡ç†åº”ç”¨ç¨‹åºç›¸åŒçš„æ–¹å¼æ¥ç®¡ç†åŸºç¡€æ¶æ„ã€‚é€šè¿‡åˆ©ç”¨Dockerçš„æ–¹æ³•æ¥å¿«é€Ÿäº¤ä»˜ï¼Œæµ‹è¯•å’Œéƒ¨ç½²ä»£ç ï¼Œå¤§å¤§å‡å°‘ç¼–å†™ä»£ç å’Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œä»£ç ä¹‹é—´çš„å»¶è¿Ÿã€‚</p><p>dockerå¯ä»¥ç”¨äºå¿«é€Ÿä¸€è‡´äº¤ä»˜ç¨‹åºï¼Œå“åº”å¼éƒ¨ç½²å’Œæ‹“å±•ï¼Œåœ¨åŒä¸€è½¯ä»¶ä¸Šè¿è¡Œå¤šä¸ªç›¸åŒæˆ–è€…ä¸åŒçš„æœåŠ¡ï¼Œä½¿èµ„æºå¾—åˆ°å……åˆ†åˆ©ç”¨ã€‚</p><p>dockeræ¶æ„å¦‚ä¸‹</p><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210219114938.svg" alt="Dockeræ¶æ„å›¾"></p><h3 id="dockeræ¦‚å¿µ"><a href="#dockeræ¦‚å¿µ" class="headerlink" title="dockeræ¦‚å¿µ"></a>dockeræ¦‚å¿µ</h3><p><a href="http://dockone.io/article/783">10å¼ å›¾å¸¦ä½ æ·±å…¥ç†è§£Dockerå®¹å™¨å’Œé•œåƒ</a></p><p><a href="https://juejin.cn/post/6844903938030845966">Dockerçš„ä¸‰å¤§æ ¸å¿ƒç»„ä»¶ï¼šé•œåƒï¼Œå®¹å™¨ä¸ä»“åº“</a></p><h2 id="ä¸‹è½½docker"><a href="#ä¸‹è½½docker" class="headerlink" title="ä¸‹è½½docker"></a>ä¸‹è½½docker</h2><p><a href="https://docs.docker.com/get-docker/">å®˜ç½‘ä¸‹è½½åœ°å€</a></p><p>macç”µè„‘é€‰æ‹©macç‰ˆæœ¬è¿›è¡Œä¸‹è½½</p><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210219114521.png" alt="image-20210219114521282"></p><p>å®‰è£…å¥½åè¿›è¡Œå¯åŠ¨ï¼Œå’Œå®‰è£…æ™®é€šè½¯ä»¶ä¸€æ ·</p><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210219114554.png" alt="image-20210219114554407"></p><h2 id="dockerå¯ä»¥åšçš„äº‹æƒ…"><a href="#dockerå¯ä»¥åšçš„äº‹æƒ…" class="headerlink" title="dockerå¯ä»¥åšçš„äº‹æƒ…"></a>dockerå¯ä»¥åšçš„äº‹æƒ…</h2><p>å¯åŠ¨å®¹å™¨è¿è¡Œåº”ç”¨</p><p>æŒä¹…åŒ–æ•°æ®ï¼Œé˜²æ­¢æ¯æ¬¡å¯åŠ¨ä¸ä¸€è‡´</p><p>å¯ä»¥ä½¿ç”¨docker hubå…±äº«é•œåƒ</p><p>å¤šå®¹å™¨ä¹‹é—´äº¤äº’</p><blockquote><p>å¦‚æœä¸¤ä¸ªå®¹å™¨åœ¨åŒä¸€ç½‘ç»œä¸Šï¼Œå®ƒä»¬å¯ä»¥ç›¸äº’é€šä¿¡ã€‚å¦‚æœä¸æ˜¯ï¼Œä»–ä»¬å°±ä¸ä¼š</p></blockquote><p>ä½¿ç”¨docker compose</p><h2 id="Hello-World-æˆ‘çš„ç¬¬ä¸€ä¸ªdockerå®¹å™¨"><a href="#Hello-World-æˆ‘çš„ç¬¬ä¸€ä¸ªdockerå®¹å™¨" class="headerlink" title="Hello World æˆ‘çš„ç¬¬ä¸€ä¸ªdockerå®¹å™¨"></a>Hello World æˆ‘çš„ç¬¬ä¸€ä¸ªdockerå®¹å™¨</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker run -d -p 80:80 docker/getting-starteddocker run -dp 80:80 docker/getting-started #ä¹Ÿå¯ä»¥å†™åšè¿™ä¸ªï¼Œç®€å†™<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li><code>-d</code> -ä»¥åˆ†ç¦»æ¨¡å¼è¿è¡Œå®¹å™¨ï¼ˆåœ¨åå°ï¼‰</li><li><code>-p 80:80</code> -å°†ä¸»æœºçš„ç«¯å£80æ˜ å°„åˆ°å®¹å™¨ä¸­çš„ç«¯å£80</li><li><code>docker/getting-started</code> -è¦ä½¿ç”¨çš„å›¾åƒ</li></ul><p>è¿è¡Œåï¼Œå¯ä»¥ç‚¹å‡»dockerä¸­çš„dashboardæŸ¥çœ‹ä¸Šé¢èµ·èµ·æ¥çš„å®¹å™¨ï¼Œå®¹å™¨åç§°æ˜¯éšæ„åˆ›å»ºçš„</p><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210220153738.png" alt="image-20210220153738649"></p><h3 id="ä»€ä¹ˆæ˜¯å®¹å™¨ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å®¹å™¨ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å®¹å™¨ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å®¹å™¨ï¼Ÿ</h3><p>ç®€å•è¯´ï¼Œå®¹å™¨å°±æ˜¯ä¸€ä¸ªä½ æœºå™¨ä¸Šçš„ä¸€ä¸ªè¿›ç¨‹ï¼Œå®ƒä¸å…¶ä»–è¿›ç¨‹æ˜¯ç›¸äº’é—´éš”ç¦»çš„ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯å®¹å™¨é•œåƒï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å®¹å™¨é•œåƒï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å®¹å™¨é•œåƒï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å®¹å™¨é•œåƒï¼Ÿ</h3><p>å®¹å™¨é•œåƒåŒ…å«äº†æ‰€æœ‰çš„éœ€è¦èµ·ä¸€ä¸ªåº”ç”¨çš„è¦ç´ ï¼ŒåŒ…æ‹¬ä¾èµ–ï¼Œé…ç½®ï¼Œè„šæœ¬ï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶ç­‰ï¼Œä½†æ˜¯ä¹ŸåŒ…å«äº†å…¶ä»–å®¹å™¨çš„é…ç½®ï¼Œå¦‚ç¯å¢ƒå˜é‡ï¼Œé»˜è®¤å¯åŠ¨æ–¹æ³•ï¼Œä»¥åŠå…¶ä»–å…ƒæ•°æ®</p><h2 id="é•œåƒåˆ›å»ºç¤ºä¾‹"><a href="#é•œåƒåˆ›å»ºç¤ºä¾‹" class="headerlink" title="é•œåƒåˆ›å»ºç¤ºä¾‹"></a>é•œåƒåˆ›å»ºç¤ºä¾‹</h2><p>ä»¥ä¸‹å‚ç…§ <a href="https://docs.docker.com/get-started">get-started</a> æµ‹è¯•</p><p><a href="https://github.com/docker/getting-started/tree/master/app">ä¸‹è½½dockeræ–°æ‰‹appæ–‡ä»¶</a></p><p>åˆ›å»ºDockerfileï¼Œå¹¶ç²˜è´´ä¸‹é¢çš„å†…å®¹</p><pre class="line-numbers language-none"><code class="language-none">FROM node:12-alpine WORKDIR /app COPY . . RUN yarn install --production CMD ["node", "src/index.js"]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210220160623.png" alt="image-20210220160623347"></p><p>åœ¨appç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œä½¿ç”¨<code>docker build</code>å‘½ä»¤æ„å»ºå®¹å™¨æ˜ åƒã€‚ï¼ˆä¸è¦å¿˜è®°äº†åé¢é‚£ä¸ªç‚¹ï¼Œè¡¨ç¤ºå½“å‰ç›®å½•ï¼‰</p><pre class="line-numbers language-none"><code class="language-none">docker build -t getting-started .<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä»–ä½¿ç”¨äº†Dockerfileå»åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨é•œåƒï¼Œä½ ä¼šå‘ç°å¥½å¤šâ€œlayersâ€è¢«ä¸‹è½½ä¸‹æ¥äº†ï¼Œè¿™æ˜¯å› ä¸ºDockerfileä¸Šä»¥node:12-alpineä¸ºåŸºç¡€é•œåƒï¼Œä½†æ˜¯æˆ‘ä»¬çš„æœºå™¨ä¸Šé¢æ²¡æœ‰è¿™äº›é•œåƒæ–‡ä»¶ã€‚ä¸‹è½½å®Œæ¯•åï¼Œä»–ä»¬ä¼šè¢«å¤åˆ¶åˆ°æˆ‘ä»¬çš„åº”ç”¨ä¸­ï¼Œå¹¶ä½¿ç”¨<code>yarn</code>å»å®‰è£…åº”ç”¨çš„ä¾èµ–ã€‚æ‰§è¡Œå‘½ä»¤è¡Œä½¿ç”¨çš„æ˜¯ç³»ç»Ÿé»˜è®¤çš„<code>cmd</code>è½¯ä»¶ã€‚<code>-t</code>åé¢å¸¦çš„åå­—å³é•œåƒåç§°ï¼Œæ–¹ä¾¿æˆ‘ä»¬ä¹‹åå»è¿è¡Œè¯¥é•œåƒã€‚</p><p>å®‰è£…å®Œæ¯•ï¼Œå¦‚ä¸‹æ‰€ç¤º</p><pre class="line-numbers language-none"><code class="language-none">cutiedeMacBook-Pro:app cutie$ docker build -t getting-started .Sending build context to Docker daemon  4.659MBStep 1/5 : FROM node:12-alpine12-alpine: Pulling from library/node0a6724ff3fcd: Pull completeb68849637432: Pull complete7dda491622fb: Pull completece97b0f80161: Pull completeDigest: sha256:77fe10dbc042121e94db7f43b4b912a52514759b847978588eec4d5d0eb5282cStatus: Downloaded newer image for node:12-alpine ---&gt; e136be20a0bdStep 2/5 : WORKDIR /app ---&gt; Running in d9ec4d68327fRemoving intermediate container d9ec4d68327f ---&gt; a7c9152f5afeStep 3/5 : COPY . . ---&gt; fa7eda5fa1a7Step 4/5 : RUN yarn install --production ---&gt; Running in 629ef52d06b6yarn install v1.22.5[1/4] Resolving packages...[2/4] Fetching packages...info fsevents@1.2.9: The platform "linux" is incompatible with this module.info "fsevents@1.2.9" is an optional dependency and failed compatibility check. Excluding it from installation.[3/4] Linking dependencies...[4/4] Building fresh packages...Done in 145.83s.Removing intermediate container 629ef52d06b6 ---&gt; 15136bc6d899Step 5/5 : CMD ["node", "src/index.js"] ---&gt; Running in 62ad87066a4eRemoving intermediate container 62ad87066a4e ---&gt; 945f98aa1995Successfully built 945f98aa1995Successfully tagged getting-started:latest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬åœ¨dockerä¸­çš„imagesä¸­ä¹Ÿèƒ½çœ‹åˆ°æˆ‘ä»¬æ–°å»ºçš„é•œåƒäº†</p><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210220165847.png" alt="image-20210220165847096"></p><h2 id="å¯åŠ¨å®¹å™¨ç¤ºä¾‹"><a href="#å¯åŠ¨å®¹å™¨ç¤ºä¾‹" class="headerlink" title="å¯åŠ¨å®¹å™¨ç¤ºä¾‹"></a>å¯åŠ¨å®¹å™¨ç¤ºä¾‹</h2><p>ç°åœ¨æˆ‘ä»¬æ‹¥æœ‰ä¸€ä¸ªé•œåƒäº†ï¼Œå¯ä»¥è·‘ä¸€ä¸ªåº”ç”¨äº†ã€‚æ‰§è¡Œ<code>docker run</code>å‘½ä»¤ï¼Œè¿™æ—¶å€™ï¼Œç”¨åˆ°æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„é•œåƒæ–‡ä»¶äº†</p><pre class="line-numbers language-none"><code class="language-none">docker run -dp 3000:3000 getting-started<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>-d</code> detachedæ¨¡å¼ï¼Œä¿æŒå®¹å™¨åå°è¿è¡Œï¼Œå¯ä»¥æ‰§è¡Œåç»­çš„<code>exec</code>å‘½ä»¤</p><p><code>-p</code> æŒ‡å®šç«¯å£</p><pre class="line-numbers language-none"><code class="language-none">cutiedeMacBook-Pro:app cutie$ docker run -dp 3000:3000 getting-started6891eba76d5d89b534a2a815d4a77ef5d447ca41b8170b64c537f4fb17a2a88e<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç„¶ååœ¨container/appä¸­å°±èƒ½çœ‹åˆ°å·²ç»è¿è¡Œèµ·æ¥çš„å®¹å™¨</p><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210220172028.png" alt="image-20210220172028423"></p><p>æ‰“å¼€ <a href="http://localhost:3000/">http://localhost:3000</a> ï¼Œçœ‹çœ‹è¿è¡Œèµ·æ¥çš„</p><p>![image-20210220172211298](/Users/cutie/Library/Application Support/typora-user-images/image-20210220172211298.png)</p><h2 id="dockerå¸¸ç”¨å‘½ä»¤ã€åç»­è¿›è¡ŒæŠ½ç¦»å®Œå–„ã€‘"><a href="#dockerå¸¸ç”¨å‘½ä»¤ã€åç»­è¿›è¡ŒæŠ½ç¦»å®Œå–„ã€‘" class="headerlink" title="dockerå¸¸ç”¨å‘½ä»¤ã€åç»­è¿›è¡ŒæŠ½ç¦»å®Œå–„ã€‘"></a>dockerå¸¸ç”¨å‘½ä»¤ã€åç»­è¿›è¡ŒæŠ½ç¦»å®Œå–„ã€‘</h2><p><code>docker ps</code> æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„é•œåƒ</p><pre class="line-numbers language-none"><code class="language-none">cutiedeMacBook-Pro:app cutie$ docker psCONTAINER ID   IMAGE                    COMMAND                  CREATED          STATUS          PORTS                    NAMES6891eba76d5d   945f98aa1995             "docker-entrypoint.sâ€¦"   23 minutes ago   Up 23 minutes   0.0.0.0:3000-&gt;3000/tcp   amazing_babbage6b825ac83cbb   docker/getting-started   "nginx -g 'daemon ofâ€¦"   2 hours ago      Up 2 hours      0.0.0.0:80-&gt;80/tcp       nifty_colden<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><code>docker stop &lt;the-container-id&gt;</code> æ ¹æ®å®¹å™¨idæš‚åœæ­£åœ¨è¿è¡Œçš„å®¹å™¨</p><pre class="line-numbers language-none"><code class="language-none">cutiedeMacBook-Pro:app cutie$ docker stop 6891eba76d5d6891eba76d5d<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><code>docker rm &lt;the-container-id&gt;</code> æ ¹æ®å®¹å™¨idç§»é™¤ä¸ä½¿ç”¨çš„å®¹å™¨</p><pre class="line-numbers language-none"><code class="language-none">cutiedeMacBook-Pro:app cutie$ docker rm 6891eba76d5d6891eba76d5d<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><code>docker rm -f &lt;the-container-id&gt;</code> å•è¡Œå‘½ä»¤ç»ˆæ­¢å’Œåˆ é™¤å®¹å™¨</p><p><code>docker image ls</code> æŸ¥çœ‹é•œåƒåˆ—è¡¨</p><p><code>docker logs -f &lt;container-id&gt;</code> æŸ¥çœ‹æ—¥å¿—ï¼Œçœ‹å®Œæ—¥å¿—åï¼Œè¯·æŒ‰<code>Ctrtrol</code>+<code>C</code>é€€å‡º</p><pre class="line-numbers language-none"><code class="language-none">cutiedeMacBook-Pro:app cutie$ docker logs -f 9a5b851f917bUsing sqlite database at /etc/todos/todo.dbListening on port 3000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Week01-02 JVM æ ¸å¿ƒæŠ€æœ¯--å·¥å…·ä¸ GC ç­–ç•¥</title>
      <link href="2021/02/19/java%E8%BF%9B%E9%98%B6%E8%AE%AD%E7%BB%83%E8%90%A5/Week01-02-JVM-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E5%B7%A5%E5%85%B7%E4%B8%8E-GC-%E7%AD%96%E7%95%A5/"/>
      <url>2021/02/19/java%E8%BF%9B%E9%98%B6%E8%AE%AD%E7%BB%83%E8%90%A5/Week01-02-JVM-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E5%B7%A5%E5%85%B7%E4%B8%8E-GC-%E7%AD%96%E7%95%A5/</url>
      
        <content type="html"><![CDATA[<h1 id="ç¬¬-2-è¯¾-JVM-æ ¸å¿ƒæŠ€æœ¯â€“å·¥å…·ä¸-GC-ç­–ç•¥"><a href="#ç¬¬-2-è¯¾-JVM-æ ¸å¿ƒæŠ€æœ¯â€“å·¥å…·ä¸-GC-ç­–ç•¥" class="headerlink" title="ç¬¬ 2 è¯¾ JVM æ ¸å¿ƒæŠ€æœ¯â€“å·¥å…·ä¸ GC ç­–ç•¥"></a>ç¬¬ 2 è¯¾ JVM æ ¸å¿ƒæŠ€æœ¯â€“å·¥å…·ä¸ GC ç­–ç•¥</h1><p><strong>ç›®å½•</strong></p><ol><li>JDK å†…ç½®å‘½ä»¤è¡Œå·¥å…·*</li><li>JDK å†…ç½®å›¾å½¢åŒ–å·¥å…·*</li><li>GC çš„èƒŒæ™¯ä¸ä¸€èˆ¬åŸç†</li><li>ä¸²è¡Œ GC/å¹¶è¡Œ GC*ï¼ˆSerial GC/Parallel GCï¼‰</li><li>CMS GC/G1 GC*</li><li>ZGC/Shenandoah GC</li><li>ç¬¬ 2 èŠ‚è¯¾æ€»ç»“å›é¡¾ä¸ä½œä¸šå®è·µ</li></ol><h2 id="1-JDK-å†…ç½®å‘½ä»¤è¡Œå·¥å…·"><a href="#1-JDK-å†…ç½®å‘½ä»¤è¡Œå·¥å…·" class="headerlink" title="1.JDK å†…ç½®å‘½ä»¤è¡Œå·¥å…·"></a>1.JDK å†…ç½®å‘½ä»¤è¡Œå·¥å…·</h2><h3 id="JVM-å‘½ä»¤è¡Œå·¥å…·"><a href="#JVM-å‘½ä»¤è¡Œå·¥å…·" class="headerlink" title="JVM å‘½ä»¤è¡Œå·¥å…·"></a><strong>JVM å‘½ä»¤è¡Œå·¥å…·</strong></h3><p>![image-20210221220254377](/Users/cutie/Library/Application Support/typora-user-images/image-20210221220254377.png)</p><h3 id="å·¥å…·-ç®€ä»‹"><a href="#å·¥å…·-ç®€ä»‹" class="headerlink" title="å·¥å…· ç®€ä»‹"></a><strong>å·¥å…· ç®€ä»‹</strong></h3><p><strong>java</strong> Java åº”ç”¨çš„å¯åŠ¨ç¨‹åº</p><p><strong>javac</strong> JDK å†…ç½®çš„ç¼–è¯‘å·¥å…·</p><p><strong>javap</strong> åç¼–è¯‘ class æ–‡ä»¶çš„å·¥å…·</p><p><strong>javadoc</strong> æ ¹æ® Java ä»£ç å’Œæ ‡å‡†æ³¨é‡Š,è‡ªåŠ¨ç”Ÿæˆç›¸å…³çš„APIè¯´æ˜æ–‡æ¡£</p><p><strong>javah</strong> JNI å¼€å‘æ—¶, æ ¹æ® java ä»£ç ç”Ÿæˆéœ€è¦çš„ .hæ–‡ä»¶ã€‚</p><p><strong>extcheck</strong> æ£€æŸ¥æŸä¸ª jar æ–‡ä»¶å’Œè¿è¡Œæ—¶æ‰©å±• jar æœ‰æ²¡æœ‰ç‰ˆæœ¬å†²çªï¼Œå¾ˆå°‘ä½¿ç”¨</p><p><strong>jdb</strong> Java Debugger ; å¯ä»¥è°ƒè¯•æœ¬åœ°å’Œè¿œç«¯ç¨‹åº, å±äº JPDA ä¸­çš„ä¸€ä¸ª demo å®ç°, ä¾›å…¶ä»–è°ƒè¯•å™¨å‚è€ƒã€‚å¼€å‘æ—¶å¾ˆå°‘ä½¿ç”¨</p><p><strong>jdeps</strong> æ¢æµ‹ class æˆ– jar åŒ…éœ€è¦çš„ä¾èµ–</p><p><strong>jar</strong> æ‰“åŒ…å·¥å…·ï¼Œå¯ä»¥å°†æ–‡ä»¶å’Œç›®å½•æ‰“åŒ…æˆä¸º .jar æ–‡ä»¶ï¼›.jar æ–‡ä»¶æœ¬è´¨ä¸Šå°±æ˜¯ zip æ–‡ä»¶,åªæ˜¯åç¼€ä¸åŒã€‚ä½¿ç”¨æ—¶æŒ‰é¡ºåºå¯¹åº”å¥½é€‰é¡¹å’Œå‚æ•°å³å¯ã€‚</p><p><strong>keytool</strong> å®‰å…¨è¯ä¹¦å’Œå¯†é’¥çš„ç®¡ç†å·¥å…·; ï¼ˆæ”¯æŒç”Ÿæˆã€å¯¼å…¥ã€å¯¼å‡ºç­‰æ“ä½œï¼‰</p><p><strong>jarsigner</strong> JAR æ–‡ä»¶ç­¾åå’ŒéªŒè¯å·¥å…·</p><p><strong>policytool</strong> å®é™…ä¸Šè¿™æ˜¯ä¸€æ¬¾å›¾å½¢ç•Œé¢å·¥å…·, ç®¡ç†æœ¬æœºçš„ Java å®‰å…¨ç­–ç•¥</p><h3 id="JVM-å‘½ä»¤è¡Œå·¥å…·-1"><a href="#JVM-å‘½ä»¤è¡Œå·¥å…·-1" class="headerlink" title="JVM å‘½ä»¤è¡Œå·¥å…·"></a><strong>JVM å‘½ä»¤è¡Œå·¥å…·</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221220324.png" alt="image-20210221220324097"></p><p><strong>å·¥å…· ç®€ä»‹</strong></p><p><strong>jps/jinfo</strong> æŸ¥çœ‹ java è¿›ç¨‹</p><p><strong>jstat</strong> æŸ¥çœ‹ JVM å†…éƒ¨ gc ç›¸å…³ä¿¡æ¯</p><p><strong>jmap</strong> æŸ¥çœ‹ heap æˆ–ç±»å ç”¨ç©ºé—´ç»Ÿè®¡</p><p><strong>jstack</strong> æŸ¥çœ‹çº¿ç¨‹ä¿¡æ¯</p><p><strong>jcmd</strong> æ‰§è¡Œ JVM ç›¸å…³åˆ†æå‘½ä»¤ï¼ˆæ•´åˆå‘½ä»¤ï¼‰</p><p><strong>jrunscript/jjs</strong> æ‰§è¡Œ js å‘½ä»¤</p><h3 id="JVM-å‘½ä»¤è¡Œå·¥å…·-jps-jinfo"><a href="#JVM-å‘½ä»¤è¡Œå·¥å…·-jps-jinfo" class="headerlink" title="JVM å‘½ä»¤è¡Œå·¥å…·-jps/jinfo"></a><strong>JVM å‘½ä»¤è¡Œå·¥å…·-jps/jinfo</strong></h3><p> D:&gt;jps</p><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221220346.png" alt="image-20210221220346145"></p><p>32432</p><p>1716 Jps</p><p>23784 QuorumPeerMain</p><p>4264 Bootstrap</p><p>2460 Launcher</p><p>D:&gt;jps -help</p><p>usage: jps [-help]</p><p>jps [-q] [-mlvV] [<hostid>]</hostid></p><p>Definitions:</p><p><hostid>: <hostname>[:<port>]</port></hostname></hostid></p><h3 id="JVM-å‘½ä»¤è¡Œå·¥å…·-jstat"><a href="#JVM-å‘½ä»¤è¡Œå·¥å…·-jstat" class="headerlink" title="*JVM å‘½ä»¤è¡Œå·¥å…·-jstat**"></a>*<em>JVM å‘½ä»¤è¡Œå·¥å…·-jstat**</em></h3><blockquote><p>jstat -options</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221220358.png" alt="image-20210221220358285"></p><p>class ç±»åŠ è½½(Class loader)ä¿¡æ¯ç»Ÿè®¡.</p><p>compiler JIT å³æ—¶ç¼–è¯‘å™¨ç›¸å…³çš„ç»Ÿè®¡ä¿¡æ¯ã€‚</p><p>gc GC ç›¸å…³çš„å †å†…å­˜ä¿¡æ¯. ç”¨æ³•: jstat -gc -h 10 -t 864 1s 20</p><p>gccapacity å„ä¸ªå†…å­˜æ± åˆ†ä»£ç©ºé—´çš„å®¹é‡ã€‚</p><p>gccause çœ‹ä¸Šæ¬¡ GC, æœ¬æ¬¡ GCï¼ˆå¦‚æœæ­£åœ¨ GCä¸­ï¼‰çš„åŸå› , å…¶ä»–è¾“å‡ºå’Œ -gcutil é€‰é¡¹ä¸€è‡´ã€‚</p><p>gcnew å¹´è½»ä»£çš„ç»Ÿè®¡ä¿¡æ¯. ï¼ˆNew = Young = Eden + S0 + S1ï¼‰</p><p>gcnewcapacity å¹´è½»ä»£ç©ºé—´å¤§å°ç»Ÿè®¡.</p><p>gcold è€å¹´ä»£å’Œå…ƒæ•°æ®åŒºçš„è¡Œä¸ºç»Ÿè®¡ã€‚</p><p>gcoldcapacity old ç©ºé—´å¤§å°ç»Ÿè®¡.</p><p>gcmetacapacity meta åŒºå¤§å°ç»Ÿè®¡.</p><p>gcutil GC ç›¸å…³åŒºåŸŸçš„ä½¿ç”¨ç‡ï¼ˆutilizationï¼‰ç»Ÿè®¡ã€‚</p><p>printcompilation æ‰“å° JVM ç¼–è¯‘ç»Ÿè®¡ä¿¡æ¯ã€‚</p><h3 id="JVM-å‘½ä»¤è¡Œå·¥å…·-jstat-1"><a href="#JVM-å‘½ä»¤è¡Œå·¥å…·-jstat-1" class="headerlink" title="JVM å‘½ä»¤è¡Œå·¥å…·-jstat"></a><strong>JVM å‘½ä»¤è¡Œå·¥å…·-jstat</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221220417.png" alt="image-20210221220417325"></p><p>æ¼”ç¤ºï¼š</p><p>jstat -gcutil pid 1000 1000</p><p><strong>JVM å‘½ä»¤è¡Œå·¥å…·-jstat</strong> æ¼”ç¤º</p><p>![image-20210221220441062](/Users/cutie/Library/Application Support/typora-user-images/image-20210221220441062.png)</p><p>jstat -gc pid 1000 1000</p><h3 id="JVM-å‘½ä»¤è¡Œå·¥å…·-jmap"><a href="#JVM-å‘½ä»¤è¡Œå·¥å…·-jmap" class="headerlink" title="JVM å‘½ä»¤è¡Œå·¥å…·-jmap"></a><strong>JVM å‘½ä»¤è¡Œå·¥å…·-jmap</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221220503.png" alt="image-20210221220503764"></p><p>å¸¸ç”¨é€‰é¡¹å°± 3 ä¸ªï¼š</p><p>heap æ‰“å°å †å†…å­˜ï¼ˆ/å†…å­˜æ± ï¼‰çš„é…ç½®å’Œ</p><p>ä½¿ç”¨ä¿¡æ¯ã€‚</p><p>histo çœ‹å“ªäº›ç±»å ç”¨çš„ç©ºé—´æœ€å¤š, ç›´æ–¹å›¾</p><p>dump:format=b,file=xxxx.hprof</p><p>Dump å †å†…å­˜ã€‚</p><p>æ¼”ç¤º:</p><p>jmap -heap pid</p><p>jmap -histo pid</p><p>jmap -dump:format=b,file=3826.hprof</p><p>3826</p><h3 id="JVM-å‘½ä»¤è¡Œå·¥å…·-jstack"><a href="#JVM-å‘½ä»¤è¡Œå·¥å…·-jstack" class="headerlink" title="JVM å‘½ä»¤è¡Œå·¥å…·-jstack"></a><strong>JVM å‘½ä»¤è¡Œå·¥å…·-jstack</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221220514.png" alt="image-20210221220514919"></p><p>F å¼ºåˆ¶æ‰§è¡Œ thread dump. å¯åœ¨ Java è¿›ç¨‹å¡æ­»</p><p>ï¼ˆhung ä½ï¼‰æ—¶ä½¿ç”¨, æ­¤é€‰é¡¹å¯èƒ½éœ€è¦ç³»ç»Ÿæƒé™ã€‚</p><p>m æ··åˆæ¨¡å¼(mixed mode),å°† Java å¸§å’Œ native</p><p>å¸§ä¸€èµ·è¾“å‡º, æ­¤é€‰é¡¹å¯èƒ½éœ€è¦ç³»ç»Ÿæƒé™ã€‚</p><p>l é•¿åˆ—è¡¨æ¨¡å¼. å°†çº¿ç¨‹ç›¸å…³çš„ locks ä¿¡æ¯ä¸€èµ·è¾“å‡ºï¼Œ</p><p>æ¯”å¦‚æŒæœ‰çš„é”ï¼Œç­‰å¾…çš„é”ã€‚</p><p>æ¼”ç¤ºï¼š</p><p>jstack pid -l</p><h3 id="JVM-å‘½ä»¤è¡Œå·¥å…·-jcmd"><a href="#JVM-å‘½ä»¤è¡Œå·¥å…·-jcmd" class="headerlink" title="*JVM å‘½ä»¤è¡Œå·¥å…·-jcmd**"></a>*<em>JVM å‘½ä»¤è¡Œå·¥å…·-jcmd**</em></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221220529.png"></p><p>Jcmd ç»¼åˆäº†å‰é¢çš„å‡ ä¸ªå‘½ä»¤</p><p>ç¤ºä¾‹ï¼š</p><p>jcmd pid VM.version</p><p>jcmd pid VM.flags</p><p>jcmd pid VM.command_line</p><p>jcmd pid VM.system_properties</p><p>jcmd pid Thread.print</p><p>jcmd pid GC.class_histogram</p><p>jcmd pid GC.heap_info</p><h3 id="JVM-å‘½ä»¤è¡Œå·¥å…·-jrunscript-jjs"><a href="#JVM-å‘½ä»¤è¡Œå·¥å…·-jrunscript-jjs" class="headerlink" title="JVM å‘½ä»¤è¡Œå·¥å…·-jrunscript/jjs"></a><strong>JVM å‘½ä»¤è¡Œå·¥å…·-jrunscript/jjs</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221220548.png" alt="image-20210221220548729"></p><p>å½“curlå‘½ä»¤ç”¨ï¼š</p><p>jrunscript -e â€œcat(â€˜<a href="http://www.baidu.com&amp;/#39;)&quot;">http://www.baidu.com')"</a></p><p>æ‰§è¡Œjsè„šæœ¬ç‰‡æ®µ</p><p>jrunscript -e â€œprint(â€˜hello,kk.jvmâ€™+1)â€</p><p>æ‰§è¡Œjsæ–‡ä»¶</p><p>jrunscript -l js -f /XXX/XXX/test.js</p><h2 id="2-JDK-å†…ç½®å›¾å½¢åŒ–å·¥å…·"><a href="#2-JDK-å†…ç½®å›¾å½¢åŒ–å·¥å…·" class="headerlink" title="2.JDK å†…ç½®å›¾å½¢åŒ–å·¥å…·"></a>2.JDK å†…ç½®å›¾å½¢åŒ–å·¥å…·</h2><h3 id="JVM-å›¾å½¢åŒ–å·¥å…·-jconsole"><a href="#JVM-å›¾å½¢åŒ–å·¥å…·-jconsole" class="headerlink" title="JVM å›¾å½¢åŒ–å·¥å…·-jconsole"></a><strong>JVM å›¾å½¢åŒ–å·¥å…·-jconsole</strong></h3><p>![image-20210221220611310](/Users/cutie/Library/Application Support/typora-user-images/image-20210221220611310.png)</p><p>åœ¨å‘½ä»¤è¡Œè¾“å…¥ jconsole å³å¯æ‰“å¼€</p><p>æœ¬åœ° JVM å¯ä»¥ç›´æ¥é€‰æ‹©</p><p>è¿œç¨‹ JVM å¯ä»¥é€šè¿‡ JMX æ–¹å¼è¿æ¥</p><h3 id="JVM-å›¾å½¢åŒ–å·¥å…·-jconsole-1"><a href="#JVM-å›¾å½¢åŒ–å·¥å…·-jconsole-1" class="headerlink" title="JVM å›¾å½¢åŒ–å·¥å…·-jconsole"></a><strong>JVM å›¾å½¢åŒ–å·¥å…·-jconsole</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221220625.png" alt="image-20210221220625562"></p><p>å…±æœ‰ 6 ä¸ªé¢æ¿</p><p>ç¬¬ä¸€ä¸ªä¸ºæ¦‚è§ˆï¼Œå››é¡¹æŒ‡æ ‡å…·ä½“ä¸ºï¼š</p><p>å †å†…å­˜ä½¿ç”¨é‡ï¼šæ­¤å¤„å±•ç¤ºçš„å°±æ˜¯å‰é¢ Java å†…å­˜æ¨¡å‹è¯¾ç¨‹ä¸­æåˆ°çš„å †å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œä»å›¾ä¸Šå¯ä»¥çœ‹åˆ°ï¼Œå †å†…å­˜ä½¿ç”¨äº† 94MB å·¦å³ï¼Œå¹¶ä¸”ä¸€ç›´åœ¨å¢é•¿ã€‚</p><p>çº¿ç¨‹ï¼šå±•ç¤ºäº† JVM ä¸­æ´»åŠ¨çº¿ç¨‹çš„æ•°é‡ï¼Œå½“å‰æ—¶åˆ»å…±æœ‰ 17 ä¸ªæ´»åŠ¨çº¿ç¨‹ã€‚</p><p>ç±»ï¼šJVM ä¸€å…±åŠ è½½äº† 5563 ä¸ªç±»ï¼Œæ²¡æœ‰å¸è½½ç±»ã€‚</p><p>CPU å ç”¨ç‡ï¼šç›®å‰ CPU ä½¿ç”¨ç‡ä¸º 0.2%ï¼Œè¿™ä¸ªæ•°å€¼éå¸¸ä½ï¼Œä¸”æœ€é«˜çš„æ—¶å€™ä¹Ÿä¸åˆ° 3%ï¼Œåˆæ­¥åˆ¤æ–­ç³»ç»Ÿå½“å‰å¹¶æ²¡æœ‰ä»€ä¹ˆè´Ÿè½½å’Œå‹åŠ›ã€‚</p><p>æœ‰å¦‚ä¸‹å‡ ä¸ªæ—¶é—´ç»´åº¦å¯ä¾›é€‰æ‹©ï¼š</p><p>1åˆ†é’Ÿã€5åˆ†é’Ÿã€10åˆ†é’Ÿã€30åˆ†é’Ÿã€1å°æ—¶ã€2å°æ—¶ã€3å°æ—¶ã€6å°æ—¶ã€</p><p>12å°æ—¶ã€1å¤©ã€7å¤©ã€1ä¸ªæœˆã€3ä¸ªæœˆã€6ä¸ªæœˆã€1å¹´ã€å…¨éƒ¨ï¼Œä¸€å…±æ˜¯16 æ¡£ã€‚</p><p>å½“æˆ‘ä»¬æƒ³å…³æ³¨æœ€è¿‘1å°æ—¶æˆ–è€…1åˆ†é’Ÿçš„æ•°æ®ï¼Œå°±å¯ä»¥é€‰æ‹©å¯¹åº”çš„æ¡£ã€‚æ—</p><p>è¾¹çš„3ä¸ªæ ‡ç­¾é¡µ(å†…å­˜ã€çº¿ç¨‹ã€ç±»)ï¼Œä¹Ÿéƒ½æ”¯æŒé€‰æ‹©æ—¶é—´èŒƒå›´ã€‚</p><h3 id="JVM-å›¾å½¢åŒ–å·¥å…·-jconsole-2"><a href="#JVM-å›¾å½¢åŒ–å·¥å…·-jconsole-2" class="headerlink" title="JVM å›¾å½¢åŒ–å·¥å…·-jconsole"></a><strong>JVM å›¾å½¢åŒ–å·¥å…·-jconsole</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221220639.png" alt="image-20210221220639192"></p><p>å†…å­˜å›¾è¡¨åŒ…æ‹¬ï¼š</p><p>å †å†…å­˜ä½¿ç”¨é‡ï¼Œä¸»è¦åŒ…æ‹¬è€å¹´ä»£ï¼ˆå†…å­˜æ±  â€œPS Old</p><p>Genâ€ï¼‰ã€æ–°ç”Ÿä»£ï¼ˆâ€œPS Eden Spaceâ€ï¼‰ã€å­˜æ´»åŒº</p><p>ï¼ˆâ€œPS Survivor Spaceâ€ï¼‰ï¼›</p><p>éå †å†…å­˜ä½¿ç”¨é‡ï¼Œä¸»è¦åŒ…æ‹¬å†…å­˜æ± â€œMetaspaceâ€ã€</p><p>â€œCode Cacheâ€ã€â€œCompressed Class Spaceâ€ç­‰ï¼›</p><p>å¯ä»¥åˆ†åˆ«é€‰æ‹©å¯¹åº”çš„ 6 ä¸ªå†…å­˜æ± ã€‚</p><p>é€šè¿‡å†…å­˜é¢æ¿ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å„ä¸ªåŒºåŸŸçš„å†…å­˜ä½¿ç”¨å’Œ</p><p>å˜åŒ–æƒ…å†µï¼Œå¹¶ä¸”å¯ä»¥ï¼š</p><p>1.æ‰‹åŠ¨æ‰§è¡Œ gcï¼Œè§å›¾ä¸Šçš„æ ‡å·1ï¼Œç‚¹å‡»æŒ‰é’®å³å¯æ‰§è¡ŒJDK ä¸­çš„ System.gc()</p><p>2.é€šè¿‡å›¾ä¸­å³ä¸‹è§’æ ‡å· 2 çš„ç•Œé¢ï¼Œå¯ä»¥çœ‹åˆ°å„ä¸ªå†…å­˜æ± çš„ç™¾åˆ†æ¯”ä½¿ç”¨ç‡ï¼Œä»¥åŠå †/éå †ç©ºé—´çš„æ±‡æ€»ä½¿ç”¨æƒ…å†µ</p><p>3.ä»å·¦ä¸‹è§’æ ‡å· 3 çš„ç•Œé¢ï¼Œå¯ä»¥çœ‹åˆ° JVM ä½¿ç”¨çš„åƒåœ¾æ”¶é›†å™¨ï¼Œä»¥åŠæ‰§è¡Œåƒåœ¾æ”¶é›†çš„æ¬¡æ•°ï¼Œä»¥åŠç›¸åº”çš„æ—¶é—´æ¶ˆè€—ã€‚</p><h3 id="JVM-å›¾å½¢åŒ–å·¥å…·-jconsole-3"><a href="#JVM-å›¾å½¢åŒ–å·¥å…·-jconsole-3" class="headerlink" title="JVM å›¾å½¢åŒ–å·¥å…·-jconsole"></a><strong>JVM å›¾å½¢åŒ–å·¥å…·-jconsole</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221220653.png" alt="image-20210221220653140"></p><p>çº¿ç¨‹é¢æ¿å±•ç¤ºäº†çº¿ç¨‹æ•°å˜åŒ–ä¿¡æ¯ï¼Œä»¥åŠç›‘æµ‹åˆ°</p><p>çš„çº¿ç¨‹åˆ—è¡¨ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å¸¸æ ¹æ®åç§°ç›´æ¥æŸ¥çœ‹çº¿ç¨‹çš„çŠ¶æ€ï¼ˆè¿</p><p>è¡Œè¿˜æ˜¯ç­‰å¾…ä¸­ï¼‰å’Œè°ƒç”¨æ ˆï¼ˆæ­£åœ¨æ‰§è¡Œä»€ä¹ˆæ“</p><p>ä½œï¼‰ã€‚</p><p>ç‰¹åˆ«åœ°ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç›´æ¥ç‚¹å‡»â€œæ£€æµ‹æ­»é”â€æŒ‰é’®</p><p>æ¥æ£€æµ‹æ­»é”ï¼Œå¦‚æœæ²¡æœ‰æ­»é”åˆ™ä¼šæç¤ºâ€œæœªæ£€æµ‹</p><p>åˆ°æ­»é”â€ã€‚</p><h3 id="JVM-å›¾å½¢åŒ–å·¥å…·-jconsole-4"><a href="#JVM-å›¾å½¢åŒ–å·¥å…·-jconsole-4" class="headerlink" title="JVM å›¾å½¢åŒ–å·¥å…·-jconsole"></a><strong>JVM å›¾å½¢åŒ–å·¥å…·-jconsole</strong></h3><p>![image-20210221220706391](/Users/cutie/Library/Application Support/typora-user-images/image-20210221220706391.png)</p><p>ç±»ç›‘æ§é¢æ¿ï¼Œå¯ä»¥ç›´æ¥çœ‹åˆ° JVM åŠ è½½å’Œå¸è½½çš„</p><p>ç±»æ•°é‡æ±‡æ€»ä¿¡æ¯ï¼Œä»¥åŠéšç€æ—¶é—´çš„åŠ¨æ€å˜åŒ–ã€‚</p><h3 id="JVM-å›¾å½¢åŒ–å·¥å…·-jconsole-5"><a href="#JVM-å›¾å½¢åŒ–å·¥å…·-jconsole-5" class="headerlink" title="JVM å›¾å½¢åŒ–å·¥å…·-jconsole"></a><strong>JVM å›¾å½¢åŒ–å·¥å…·-jconsole</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221220723.png" alt="image-20210221220723902"></p><p>VM æ¦‚è¦çš„æ•°æ®æœ‰äº”ä¸ªéƒ¨åˆ†ï¼š</p><p>ç¬¬ä¸€éƒ¨åˆ†æ˜¯è™šæ‹Ÿæœºçš„ä¿¡æ¯ï¼›</p><p>ç¬¬äºŒéƒ¨åˆ†æ˜¯çº¿ç¨‹æ•°é‡ï¼Œä»¥åŠç±»åŠ è½½çš„</p><p>æ±‡æ€»ä¿¡æ¯ï¼›</p><p>ç¬¬ä¸‰éƒ¨åˆ†æ˜¯å †å†…å­˜å’Œ GC ç»Ÿè®¡ã€‚</p><p>ç¬¬å››éƒ¨åˆ†æ˜¯æ“ä½œç³»ç»Ÿå’Œå®¿ä¸»æœºçš„è®¾å¤‡</p><p>ä¿¡æ¯ï¼Œæ¯”å¦‚ CPU æ•°é‡ã€ç‰©ç†å†…å­˜ã€è™š</p><p>æ‹Ÿå†…å­˜ç­‰ç­‰ã€‚</p><p>ç¬¬äº”éƒ¨åˆ†æ˜¯ JVM å¯åŠ¨å‚æ•°å’Œå‡ ä¸ªå…³é”®</p><p>è·¯å¾„ï¼Œè¿™äº›ä¿¡æ¯å…¶å®è·Ÿ jinfo å‘½ä»¤çœ‹åˆ°</p><p>çš„å·®ä¸å¤šã€‚</p><h3 id="JVM-å›¾å½¢åŒ–å·¥å…·-jvisualvm"><a href="#JVM-å›¾å½¢åŒ–å·¥å…·-jvisualvm" class="headerlink" title="JVM å›¾å½¢åŒ–å·¥å…·-jvisualvm"></a><strong>JVM å›¾å½¢åŒ–å·¥å…·-jvisualvm</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221220854.png" alt="image-20210221220854205"></p><h3 id="JVM-å›¾å½¢åŒ–å·¥å…·-jvisualvm-1"><a href="#JVM-å›¾å½¢åŒ–å·¥å…·-jvisualvm-1" class="headerlink" title="JVM å›¾å½¢åŒ–å·¥å…·-jvisualvm"></a><strong>JVM å›¾å½¢åŒ–å·¥å…·-jvisualvm</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221220905.png" alt="image-20210221220905018"></p><h3 id="JVM-å›¾å½¢åŒ–å·¥å…·-jvisualvm-2"><a href="#JVM-å›¾å½¢åŒ–å·¥å…·-jvisualvm-2" class="headerlink" title="JVM å›¾å½¢åŒ–å·¥å…·-jvisualvm"></a><strong>JVM å›¾å½¢åŒ–å·¥å…·-jvisualvm</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221220919.png" alt="image-20210221220919070"></p><h3 id="JVM-å›¾å½¢åŒ–å·¥å…·-jvisualvm-3"><a href="#JVM-å›¾å½¢åŒ–å·¥å…·-jvisualvm-3" class="headerlink" title="JVM å›¾å½¢åŒ–å·¥å…·-jvisualvm"></a><strong>JVM å›¾å½¢åŒ–å·¥å…·-jvisualvm</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221220930.png" alt="image-20210221220930575"></p><h3 id="JVM-å›¾å½¢åŒ–å·¥å…·-VisualGCJVM"><a href="#JVM-å›¾å½¢åŒ–å·¥å…·-VisualGCJVM" class="headerlink" title="JVM å›¾å½¢åŒ–å·¥å…·-VisualGCJVM"></a><strong>JVM å›¾å½¢åŒ–å·¥å…·-VisualGCJVM</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221221250.png" alt="image-20210221221250412"></p><h3 id="å›¾å½¢åŒ–å·¥å…·-jmc"><a href="#å›¾å½¢åŒ–å·¥å…·-jmc" class="headerlink" title="å›¾å½¢åŒ–å·¥å…·-jmc"></a><strong>å›¾å½¢åŒ–å·¥å…·-jmc</strong></h3><p>![image-20210221221318177](/Users/cutie/Library/Application Support/typora-user-images/image-20210221221318177.png)</p><h3 id="JVM-å›¾å½¢åŒ–å·¥å…·-jmc"><a href="#JVM-å›¾å½¢åŒ–å·¥å…·-jmc" class="headerlink" title="JVM å›¾å½¢åŒ–å·¥å…·-jmc"></a><strong>JVM å›¾å½¢åŒ–å·¥å…·-jmc</strong></h3><p>![image-20210221221336485](/Users/cutie/Library/Application Support/typora-user-images/image-20210221221336485.png)</p><h3 id="JVM-å›¾å½¢åŒ–å·¥å…·-jmc-1"><a href="#JVM-å›¾å½¢åŒ–å·¥å…·-jmc-1" class="headerlink" title="JVM å›¾å½¢åŒ–å·¥å…·-jmc"></a><strong>JVM å›¾å½¢åŒ–å·¥å…·-jmc</strong></h3><p>![image-20210221221351996](/Users/cutie/Library/Application Support/typora-user-images/image-20210221221351996.png)</p><h3 id="JVM-å›¾å½¢åŒ–å·¥å…·-jmc-2"><a href="#JVM-å›¾å½¢åŒ–å·¥å…·-jmc-2" class="headerlink" title="JVM å›¾å½¢åŒ–å·¥å…·-jmc"></a><strong>JVM å›¾å½¢åŒ–å·¥å…·-jmc</strong></h3><p>![image-20210221221404197](/Users/cutie/Library/Application Support/typora-user-images/image-20210221221404197.png)</p><h3 id="JVM-å›¾å½¢åŒ–å·¥å…·-jmc-3"><a href="#JVM-å›¾å½¢åŒ–å·¥å…·-jmc-3" class="headerlink" title="JVM å›¾å½¢åŒ–å·¥å…·-jmc"></a><strong>JVM å›¾å½¢åŒ–å·¥å…·-jmc</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221221419.png" alt="image-20210221221419506"></p><h3 id="JVM-å›¾å½¢åŒ–å·¥å…·-jmc-4"><a href="#JVM-å›¾å½¢åŒ–å·¥å…·-jmc-4" class="headerlink" title="JVM å›¾å½¢åŒ–å·¥å…·-jmc"></a><strong>JVM å›¾å½¢åŒ–å·¥å…·-jmc</strong></h3><p>![image-20210221221517013](/Users/cutie/Library/Application Support/typora-user-images/image-20210221221517013.png)</p><h3 id="JVM-å›¾å½¢åŒ–å·¥å…·-jmc-5"><a href="#JVM-å›¾å½¢åŒ–å·¥å…·-jmc-5" class="headerlink" title="JVM å›¾å½¢åŒ–å·¥å…·-jmc"></a><strong>JVM å›¾å½¢åŒ–å·¥å…·-jmc</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221221536.png" alt="image-20210221221535991"></p><h3 id="JVM-å·¥å…·æ€»ç»“"><a href="#JVM-å·¥å…·æ€»ç»“" class="headerlink" title="JVM å·¥å…·æ€»ç»“"></a><strong>JVM å·¥å…·æ€»ç»“</strong></h3><p>jsonsole</p><p>jvisualvm</p><p>visualGC</p><p>jmc</p><p>jps/jinfo</p><p>jstat</p><p>jmap</p><p>jstack</p><p>jcmd</p><p>jrunscript/jjs</p><h2 id="3-GC-çš„èƒŒæ™¯ä¸ä¸€èˆ¬åŸç†"><a href="#3-GC-çš„èƒŒæ™¯ä¸ä¸€èˆ¬åŸç†" class="headerlink" title="3.GC çš„èƒŒæ™¯ä¸ä¸€èˆ¬åŸç†"></a>3.GC çš„èƒŒæ™¯ä¸ä¸€èˆ¬åŸç†</h2><h3 id="GC-çš„èƒŒæ™¯ä¸ä¸€èˆ¬åŸç†"><a href="#GC-çš„èƒŒæ™¯ä¸ä¸€èˆ¬åŸç†" class="headerlink" title="GC çš„èƒŒæ™¯ä¸ä¸€èˆ¬åŸç†"></a><strong>GC çš„èƒŒæ™¯ä¸ä¸€èˆ¬åŸç†</strong></h3><p>ä¸ºä»€ä¹ˆä¼šæœ‰ GC</p><p>æœ¬è´¨ä¸Šæ˜¯å†…å­˜èµ„æºçš„æœ‰é™æ€§</p><p>å› æ­¤éœ€è¦å¤§å®¶å…±äº«ä½¿ç”¨ï¼Œæ‰‹å·¥ç”³è¯·ï¼Œæ‰‹åŠ¨é‡Šæ”¾ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬ä¸¾ä¸ªä¾‹å­</p><h3 id="GC-çš„èƒŒæ™¯ä¸ä¸€èˆ¬åŸç†-1"><a href="#GC-çš„èƒŒæ™¯ä¸ä¸€èˆ¬åŸç†-1" class="headerlink" title="GC çš„èƒŒæ™¯ä¸ä¸€èˆ¬åŸç†"></a><strong>GC çš„èƒŒæ™¯ä¸ä¸€èˆ¬åŸç†</strong></h3><p>![image-20210221222138290](/Users/cutie/Library/Application Support/typora-user-images/image-20210221222138290.png)</p><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221222153.png" alt="image-20210221222153440"></p><p>ä»“åº“ä¸å¼•ç”¨è®¡æ•°ï¼šè®¡æ•°ä¸º 0</p><p>ç®€å•ç²—æš´ï¼Œä¸€èˆ¬æœ‰æ•ˆ</p><p>å®é™…æƒ…å†µå¤æ‚ä¸€ç‚¹</p><p>ä»“åº“ä¸ä»“åº“ä¹‹é—´ä¹Ÿæœ‰å…³ç³»</p><p>å¯¼è‡´å½¢æˆä¸€ä¸ªç¯ï¼Œå¤§å®¶çš„è®¡æ•°æ°¸è¿œä¸ä¸º 0ï¼ˆè·Ÿçº¿ç¨‹ã€äº‹åŠ¡æ­»é”ä¸€ä¸ªåŸç†ï¼‰</p><p>è¿™äº›ä»“åº“éƒ½æ²¡æ³•å†ç”¨ï¼šå†…å­˜æ³„æ¼-&gt;å†…å­˜æº¢å‡º</p><p>æ€ä¹ˆæ”¹è¿›å‘¢ï¼Ÿå¼•ç”¨è®¡æ•°-&gt;å¼•ç”¨è·Ÿè¸ª</p><h3 id="GC-çš„èƒŒæ™¯ä¸ä¸€èˆ¬åŸç†-2"><a href="#GC-çš„èƒŒæ™¯ä¸ä¸€èˆ¬åŸç†-2" class="headerlink" title="GC çš„èƒŒæ™¯ä¸ä¸€èˆ¬åŸç†"></a><strong>GC çš„èƒŒæ™¯ä¸ä¸€èˆ¬åŸç†</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221222210.png" alt="image-20210221222210636"></p><p>æ ‡è®°æ¸…é™¤ç®—æ³•ï¼ˆMark and Sweepï¼‰</p><p>Markingï¼ˆæ ‡è®°ï¼‰: éå†æ‰€æœ‰çš„å¯è¾¾å¯¹è±¡ï¼Œå¹¶åœ¨æœ¬åœ°å†…å­˜(native)ä¸­åˆ†é—¨åˆ«ç±»è®°ä¸‹ã€‚</p><p>Sweepingï¼ˆæ¸…é™¤ï¼‰: è¿™ä¸€æ­¥ä¿è¯äº†ï¼Œä¸å¯è¾¾å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ï¼Œåœ¨ä¹‹åè¿›è¡Œå†…å­˜åˆ†é…æ—¶å¯ä»¥é‡ç”¨ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221222224.png" alt="image-20210221222224887"></p><p>å¹¶è¡Œ GC å’Œ CMS çš„åŸºæœ¬åŸç†ã€‚</p><p>ä¼˜åŠ¿ï¼šå¯ä»¥å¤„ç†å¾ªç¯ä¾èµ–ï¼Œåªæ‰«æéƒ¨åˆ†å¯¹è±¡</p><p>é™¤äº†æ¸…é™¤ï¼Œè¿˜è¦åšå‹ç¼©ã€‚</p><p>æ€ä¹ˆæ‰èƒ½æ ‡è®°å’Œæ¸…é™¤æ¸…æ¥šä¸Šç™¾ä¸‡å¯¹è±¡å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆå°±æ˜¯ STWï¼Œè®©å…¨ä¸–ç•Œåœæ­¢ä¸‹æ¥ã€‚</p><h3 id="GC-çš„èƒŒæ™¯ä¸ä¸€èˆ¬åŸç†-3"><a href="#GC-çš„èƒŒæ™¯ä¸ä¸€èˆ¬åŸç†-3" class="headerlink" title="GC çš„èƒŒæ™¯ä¸ä¸€èˆ¬åŸç†"></a><strong>GC çš„èƒŒæ™¯ä¸ä¸€èˆ¬åŸç†</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221223219.png" alt="image-20210221223219675"></p><p>åˆ†ä»£å‡è®¾ï¼šå¤§éƒ¨åˆ†æ–°ç”Ÿå¯¹è±¡å¾ˆå¿«æ— ç”¨ï¼›</p><p>å­˜æ´»è¾ƒé•¿æ—¶é—´çš„å¯¹è±¡ï¼Œå¯èƒ½å­˜æ´»æ›´é•¿æ—¶é—´ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221223239.png" alt="image-20210221223239475"></p><p>å†…å­˜æ± åˆ’åˆ†</p><p>ä¸åŒç±»å‹å¯¹è±¡ä¸åŒåŒºåŸŸï¼Œä¸åŒç­–ç•¥å¤„ç†ã€‚</p><h3 id="GC-çš„èƒŒæ™¯ä¸ä¸€èˆ¬åŸç†-4"><a href="#GC-çš„èƒŒæ™¯ä¸ä¸€èˆ¬åŸç†-4" class="headerlink" title="GC çš„èƒŒæ™¯ä¸ä¸€èˆ¬åŸç†"></a><strong>GC çš„èƒŒæ™¯ä¸ä¸€èˆ¬åŸç†</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221223307.png" alt="image-20210221223307061"></p><p>å¯¹è±¡åˆ†é…åœ¨æ–°ç”Ÿä»£çš„ Eden åŒºï¼Œæ ‡è®°é˜¶æ®µ Eden åŒºå­˜æ´»çš„å¯¹è±¡å°±ä¼šå¤åˆ¶åˆ°å­˜æ´»åŒºï¼›</p><p>æ³¨æ„ï¼šä¸ºä»€ä¹ˆæ˜¯å¤åˆ¶ï¼Œä¸æ˜¯ç§»åŠ¨ï¼Ÿï¼Ÿï¼Ÿå¤§å®¶æƒ³æƒ³</p><p>ä¸¤ä¸ªå­˜æ´»åŒº from å’Œ toï¼Œäº’æ¢è§’è‰²ã€‚å¯¹è±¡å­˜æ´»åˆ°ä¸€å®šå‘¨æœŸä¼šæå‡åˆ°è€å¹´ä»£ã€‚</p><p>ç”±å¦‚ä¸‹å‚æ•°æ§åˆ¶æå‡é˜ˆå€¼</p><p>XXï¼š+MaxTenuringThreshold=15</p><p>è€å¹´ä»£é»˜è®¤éƒ½æ˜¯å­˜æ´»å¯¹è±¡ï¼Œé‡‡ç”¨ç§»åŠ¨æ–¹å¼ï¼š</p><ol><li>æ ‡è®°æ‰€æœ‰é€šè¿‡ GC roots å¯è¾¾çš„å¯¹è±¡ï¼›</li><li>åˆ é™¤æ‰€æœ‰ä¸å¯è¾¾å¯¹è±¡ï¼›</li><li>æ•´ç†è€å¹´ä»£ç©ºé—´ä¸­çš„å†…å®¹ï¼Œæ–¹æ³•æ˜¯å°†æ‰€æœ‰çš„å­˜æ´»å¯¹è±¡å¤åˆ¶ï¼Œä»è€å¹´ä»£ç©ºé—´å¼€å§‹çš„åœ°æ–¹ä¾æ¬¡å­˜æ”¾ã€‚</li></ol><p>æŒä¹…ä»£/å…ƒæ•°æ®åŒº</p><p>1.8 ä¹‹å‰ -XX:MaxPermSize=256m</p><p>1.8 ä¹‹å -XX:MaxMetaspaceSize=256m</p><h3 id="GC-çš„èƒŒæ™¯ä¸ä¸€èˆ¬åŸç†-5"><a href="#GC-çš„èƒŒæ™¯ä¸ä¸€èˆ¬åŸç†-5" class="headerlink" title="GC çš„èƒŒæ™¯ä¸ä¸€èˆ¬åŸç†"></a><strong>GC çš„èƒŒæ™¯ä¸ä¸€èˆ¬åŸç†</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221223341.png" alt="image-20210221223340955"></p><p>å¯ä»¥ä½œä¸º GC Roots çš„å¯¹è±¡</p><ol><li>å½“å‰æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•é‡Œçš„å±€éƒ¨å˜é‡å’Œè¾“å…¥å‚æ•°</li><li>æ´»åŠ¨çº¿ç¨‹ï¼ˆActive threadsï¼‰</li><li>æ‰€æœ‰ç±»çš„é™æ€å­—æ®µï¼ˆstatic fieldï¼‰</li><li>JNI å¼•ç”¨</li></ol><p>æ­¤é˜¶æ®µæš‚åœçš„æ—¶é—´ï¼Œä¸å †å†…å­˜å¤§å°,å¯¹è±¡</p><p>çš„æ€»æ•°æ²¡æœ‰ç›´æ¥å…³ç³»ï¼Œè€Œæ˜¯ç”±å­˜æ´»å¯¹è±¡</p><p>ï¼ˆalive objectsï¼‰çš„æ•°é‡æ¥å†³å®šã€‚æ‰€ä»¥å¢</p><p>åŠ å †å†…å­˜çš„å¤§å°å¹¶ä¸ä¼šç›´æ¥å½±å“æ ‡è®°é˜¶æ®µ</p><p>å ç”¨çš„æ—¶é—´ã€‚</p><h3 id="GC-çš„èƒŒæ™¯ä¸ä¸€èˆ¬åŸç†-6"><a href="#GC-çš„èƒŒæ™¯ä¸ä¸€èˆ¬åŸç†-6" class="headerlink" title="GC çš„èƒŒæ™¯ä¸ä¸€èˆ¬åŸç†"></a><strong>GC çš„èƒŒæ™¯ä¸ä¸€èˆ¬åŸç†</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221223412.png" alt="image-20210221223412335"></p><p><strong>æ ‡è®°å¤åˆ¶ç®—æ³•(Mark-Copy)</strong></p><p><strong>æ ‡è®°æ¸…é™¤(Mark-Sweep)</strong></p><p><strong>æ ‡è®°æ¸…é™¤æ•´ç†ç®—æ³•(Mark-Sweep-Compact)</strong></p><p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/659cc6c9-9244-4bce-ad2b-c448ab9fa33b/Untitled.png" alt="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/659cc6c9-9244-4bce-ad2b-c448ab9fa33b/Untitled.png"></p><p><strong>æ€»ç»“ä¸€ä¸‹ï¼Œä¸‰è€…æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹</strong></p><h2 id="4-ä¸²è¡Œ-GC-å¹¶è¡Œ-GCï¼ˆSerial-GC-Parallel-GCï¼‰"><a href="#4-ä¸²è¡Œ-GC-å¹¶è¡Œ-GCï¼ˆSerial-GC-Parallel-GCï¼‰" class="headerlink" title="4.ä¸²è¡Œ GC/å¹¶è¡Œ GCï¼ˆSerial GC/Parallel GCï¼‰"></a>4.ä¸²è¡Œ GC/å¹¶è¡Œ GCï¼ˆSerial GC/Parallel GCï¼‰</h2><h3 id="ä¸²è¡Œ-GCï¼ˆSerial-GCï¼‰-ParNewGC"><a href="#ä¸²è¡Œ-GCï¼ˆSerial-GCï¼‰-ParNewGC" class="headerlink" title="ä¸²è¡Œ GCï¼ˆSerial GCï¼‰/ParNewGC"></a><strong>ä¸²è¡Œ GCï¼ˆSerial GCï¼‰/ParNewGC</strong></h3><p>XXï¼š+UseSerialGC é…ç½®ä¸²è¡Œ GC</p><p>ä¸²è¡Œ GC å¯¹å¹´è½»ä»£ä½¿ç”¨ mark-copyï¼ˆæ ‡è®°-å¤åˆ¶ï¼‰ ç®—æ³•ï¼Œå¯¹è€å¹´ä»£ä½¿ç”¨ mark-sweep-compactï¼ˆæ ‡è®°-æ¸…é™¤-æ•´ç†ï¼‰ç®—æ³•ã€‚</p><p>ä¸¤è€…éƒ½æ˜¯å•çº¿ç¨‹çš„åƒåœ¾æ”¶é›†å™¨ï¼Œä¸èƒ½è¿›è¡Œå¹¶è¡Œå¤„ç†ï¼Œæ‰€ä»¥éƒ½ä¼šè§¦å‘å…¨çº¿æš‚åœï¼ˆSTWï¼‰ï¼Œåœæ­¢æ‰€æœ‰çš„åº”ç”¨çº¿ç¨‹ã€‚</p><p>å› æ­¤è¿™ç§ GC ç®—æ³•ä¸èƒ½å……åˆ†åˆ©ç”¨å¤šæ ¸ CPUã€‚ä¸ç®¡æœ‰å¤šå°‘ CPU å†…æ ¸ï¼ŒJVM åœ¨åƒåœ¾æ”¶é›†æ—¶éƒ½åªèƒ½ä½¿ç”¨å•ä¸ªæ ¸å¿ƒã€‚</p><p>CPU åˆ©ç”¨ç‡é«˜ï¼Œæš‚åœæ—¶é—´é•¿ã€‚ç®€å•ç²—æš´ï¼Œå°±åƒè€å¼çš„ç”µè„‘ï¼ŒåŠ¨ä¸åŠ¨å°±å¡æ­»ã€‚è¯¥é€‰é¡¹åªé€‚åˆå‡ ç™¾ MB å †å†…å­˜çš„ JVMï¼Œè€Œä¸”æ˜¯å•æ ¸ CPU æ—¶æ¯”è¾ƒæœ‰ç”¨ã€‚</p><p>æƒ³æƒ³ whyï¼Ÿ</p><p>XXï¼š+USeParNewGC æ”¹è¿›ç‰ˆæœ¬çš„ Serial GCï¼Œå¯ä»¥é…åˆ CMS ä½¿ç”¨ã€‚</p><h3 id="å¹¶è¡Œ-GCï¼ˆParallel-GCï¼‰"><a href="#å¹¶è¡Œ-GCï¼ˆParallel-GCï¼‰" class="headerlink" title="å¹¶è¡Œ GCï¼ˆParallel GCï¼‰"></a><strong>å¹¶è¡Œ GCï¼ˆParallel GCï¼‰</strong></h3><p>XXï¼š+UseParallelGC</p><p>XXï¼š+UseParallelOldGC</p><p>XXï¼š+UseParallelGC -XX:+UseParallelOldGC</p><p>å¹´è½»ä»£å’Œè€å¹´ä»£çš„åƒåœ¾å›æ”¶éƒ½ä¼šè§¦å‘ STW äº‹ä»¶ã€‚</p><p>åœ¨å¹´è½»ä»£ä½¿ç”¨ æ ‡è®°-å¤åˆ¶ï¼ˆmark-copyï¼‰ç®—æ³•ï¼Œåœ¨è€å¹´ä»£ä½¿ç”¨ æ ‡è®°-æ¸…é™¤-æ•´ç†ï¼ˆmark-sweepcompactï¼‰ç®—æ³•ã€‚</p><p>XXï¼šParallelGCThreads=N æ¥æŒ‡å®š GC çº¿ç¨‹æ•°ï¼Œ å…¶é»˜è®¤å€¼ä¸º CPU æ ¸å¿ƒæ•°ã€‚å¹¶è¡Œåƒåœ¾æ”¶é›†å™¨é€‚ç”¨äºå¤šæ ¸æœåŠ¡å™¨ï¼Œä¸»è¦ç›®æ ‡æ˜¯å¢åŠ ååé‡ã€‚å› ä¸ºå¯¹ç³»ç»Ÿèµ„æºçš„æœ‰æ•ˆä½¿ç”¨ï¼Œèƒ½è¾¾åˆ°æ›´é«˜çš„ååé‡:</p><p>åœ¨ GC æœŸé—´ï¼Œæ‰€æœ‰ CPU å†…æ ¸éƒ½åœ¨å¹¶è¡Œæ¸…ç†åƒåœ¾ï¼Œæ‰€ä»¥æ€»æš‚åœæ—¶é—´æ›´çŸ­ï¼›</p><p>åœ¨ä¸¤æ¬¡ GC å‘¨æœŸçš„é—´éš”æœŸï¼Œæ²¡æœ‰ GC çº¿ç¨‹åœ¨è¿è¡Œï¼Œä¸ä¼šæ¶ˆè€—ä»»ä½•ç³»ç»Ÿèµ„æºã€‚</p><h3 id="æ¼”ç¤ºï¼šå¹¶è¡Œ-GCï¼Œå¸¸ç”¨å‚æ•°ä»¥åŠå…¶å†…å­˜åˆ†é…"><a href="#æ¼”ç¤ºï¼šå¹¶è¡Œ-GCï¼Œå¸¸ç”¨å‚æ•°ä»¥åŠå…¶å†…å­˜åˆ†é…" class="headerlink" title="æ¼”ç¤ºï¼šå¹¶è¡Œ GCï¼Œå¸¸ç”¨å‚æ•°ä»¥åŠå…¶å†…å­˜åˆ†é…"></a><strong>æ¼”ç¤ºï¼šå¹¶è¡Œ GCï¼Œå¸¸ç”¨å‚æ•°ä»¥åŠå…¶å†…å­˜åˆ†é…</strong></h3><h2 id="5-CMS-GC-G1-GC"><a href="#5-CMS-GC-G1-GC" class="headerlink" title="5.CMS GC/G1 GC"></a>5.CMS GC/G1 GC</h2><h3 id="CMS-GCï¼ˆMostly-Concurrent-Mark-and-Sweep-Garbage-Collectorï¼‰"><a href="#CMS-GCï¼ˆMostly-Concurrent-Mark-and-Sweep-Garbage-Collectorï¼‰" class="headerlink" title="CMS GCï¼ˆMostly Concurrent Mark and Sweep Garbage Collectorï¼‰"></a><strong>CMS GCï¼ˆMostly Concurrent Mark and Sweep Garbage Collectorï¼‰</strong></h3><p>XXï¼š+UseConcMarkSweepGC</p><p>å…¶å¯¹å¹´è½»ä»£é‡‡ç”¨å¹¶è¡Œ STW æ–¹å¼çš„ mark-copy (æ ‡è®°-å¤åˆ¶)ç®—æ³•ï¼Œå¯¹è€å¹´ä»£ä¸»è¦ä½¿ç”¨å¹¶å‘ marksweep (æ ‡è®°-æ¸…é™¤)ç®—æ³•ã€‚</p><p>CMS GC çš„è®¾è®¡ç›®æ ‡æ˜¯é¿å…åœ¨è€å¹´ä»£åƒåœ¾æ”¶é›†æ—¶å‡ºç°é•¿æ—¶é—´çš„å¡é¡¿ï¼Œä¸»è¦é€šè¿‡ä¸¤ç§æ‰‹æ®µæ¥è¾¾æˆæ­¤</p><p>ç›®æ ‡ï¼š</p><ol><li>ä¸å¯¹è€å¹´ä»£è¿›è¡Œæ•´ç†ï¼Œè€Œæ˜¯ä½¿ç”¨ç©ºé—²åˆ—è¡¨ï¼ˆfree-listsï¼‰æ¥ç®¡ç†å†…å­˜ç©ºé—´çš„å›æ”¶ã€‚</li><li>åœ¨ mark-and-sweep ï¼ˆæ ‡è®°-æ¸…é™¤ï¼‰ é˜¶æ®µçš„å¤§éƒ¨åˆ†å·¥ä½œå’Œåº”ç”¨çº¿ç¨‹ä¸€èµ·å¹¶å‘æ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è¿™äº›é˜¶æ®µå¹¶æ²¡æœ‰æ˜æ˜¾çš„åº”ç”¨çº¿ç¨‹æš‚åœã€‚ä½†å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå®ƒä»ç„¶å’Œåº”ç”¨çº¿ç¨‹äº‰æŠ¢CPU æ—¶é—´ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒCMS ä½¿ç”¨çš„å¹¶å‘çº¿ç¨‹æ•°ç­‰äº CPU æ ¸å¿ƒæ•°çš„ 1/4ã€‚å¦‚æœæœåŠ¡å™¨æ˜¯å¤šæ ¸ CPUï¼Œå¹¶ä¸”ä¸»è¦è°ƒä¼˜ç›®æ ‡æ˜¯é™ä½ GC åœé¡¿å¯¼è‡´çš„ç³»ç»Ÿå»¶è¿Ÿï¼Œé‚£ä¹ˆä½¿ç”¨ CMS æ˜¯ä¸ªå¾ˆæ˜æ™ºçš„é€‰æ‹©ã€‚è¿›è¡Œè€å¹´ä»£çš„å¹¶å‘å›æ”¶æ—¶ï¼Œå¯èƒ½ä¼šä¼´éšç€å¤šæ¬¡å¹´è½»ä»£çš„ minor GCã€‚æ€è€ƒï¼šå¹¶è¡Œ Parallel ä¸å¹¶å‘ Concurrent çš„åŒºåˆ«ï¼Ÿ</li></ol><h3 id="CMS-GCâ€“å…­ä¸ªé˜¶æ®µ-1ï¼ˆSTWï¼‰"><a href="#CMS-GCâ€“å…­ä¸ªé˜¶æ®µ-1ï¼ˆSTWï¼‰" class="headerlink" title="CMS GCâ€“å…­ä¸ªé˜¶æ®µ 1ï¼ˆSTWï¼‰"></a><strong>CMS GCâ€“å…­ä¸ªé˜¶æ®µ 1ï¼ˆSTWï¼‰</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221224228.png" alt="image-20210221224228081"></p><p>é˜¶æ®µ 1: Initial Markï¼ˆåˆå§‹æ ‡è®°ï¼‰</p><p>é˜¶æ®µ 2: Concurrent Markï¼ˆå¹¶å‘æ ‡è®°ï¼‰</p><p>é˜¶æ®µ 3: Concurrent Precleanï¼ˆå¹¶å‘é¢„æ¸…ç†ï¼‰</p><p>é˜¶æ®µ 4: Final Remarkï¼ˆæœ€ç»ˆæ ‡è®°ï¼‰</p><p>é˜¶æ®µ 5: Concurrent Sweepï¼ˆå¹¶å‘æ¸…é™¤ï¼‰</p><p>é˜¶æ®µ 6: Concurrent Resetï¼ˆå¹¶å‘é‡ç½®ï¼‰</p><p><strong>è¿™ä¸ªé˜¶æ®µä¼´éšç€ STW æš‚åœã€‚åˆå§‹æ ‡è®°çš„ç›®æ ‡æ˜¯æ ‡è®°æ‰€æœ‰</strong></p><p><strong>çš„æ ¹å¯¹è±¡ï¼ŒåŒ…æ‹¬æ ¹å¯¹è±¡ç›´æ¥å¼•ç”¨çš„å¯¹è±¡ï¼Œä»¥åŠè¢«å¹´è½»ä»£ä¸­</strong></p><p><strong>æ‰€æœ‰å­˜æ´»å¯¹è±¡æ‰€å¼•ç”¨çš„å¯¹è±¡ï¼ˆè€å¹´ä»£å•ç‹¬å›æ”¶ï¼‰ã€‚</strong></p><h3 id="CMS-GCâ€“å…­ä¸ªé˜¶æ®µ-2"><a href="#CMS-GCâ€“å…­ä¸ªé˜¶æ®µ-2" class="headerlink" title="CMS GCâ€“å…­ä¸ªé˜¶æ®µ 2"></a><strong>CMS GCâ€“å…­ä¸ªé˜¶æ®µ 2</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221224247.png" alt="image-20210221224247086"></p><p>é˜¶æ®µ 1: Initial Markï¼ˆåˆå§‹æ ‡è®°ï¼‰</p><p>é˜¶æ®µ 2: Concurrent Markï¼ˆå¹¶å‘æ ‡è®°ï¼‰</p><p>é˜¶æ®µ 3: Concurrent Precleanï¼ˆå¹¶å‘é¢„æ¸…ç†ï¼‰</p><p>é˜¶æ®µ 4: Final Remarkï¼ˆæœ€ç»ˆæ ‡è®°ï¼‰</p><p>é˜¶æ®µ 5: Concurrent Sweepï¼ˆå¹¶å‘æ¸…é™¤ï¼‰</p><p>é˜¶æ®µ 6: Concurrent Resetï¼ˆå¹¶å‘é‡ç½®ï¼‰</p><p><strong>åœ¨æ­¤é˜¶æ®µï¼ŒCMS GC éå†è€å¹´ä»£ï¼Œæ ‡è®°æ‰€æœ‰çš„å­˜æ´»å¯¹è±¡ï¼Œä»å‰ä¸€é˜¶æ®µ â€œInitial Markâ€ æ‰¾åˆ°çš„æ ¹å¯¹è±¡å¼€å§‹ç®—èµ·ã€‚ â€œå¹¶å‘æ ‡è®°â€é˜¶æ®µï¼Œå°±æ˜¯ä¸åº”ç”¨ç¨‹åºåŒæ—¶è¿è¡Œï¼Œä¸ç”¨æš‚åœçš„é˜¶æ®µã€‚</strong></p><h3 id="CMS-GCâ€“å…­ä¸ªé˜¶æ®µ-3"><a href="#CMS-GCâ€“å…­ä¸ªé˜¶æ®µ-3" class="headerlink" title="CMS GCâ€“å…­ä¸ªé˜¶æ®µ 3"></a><strong>CMS GCâ€“å…­ä¸ªé˜¶æ®µ 3</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221224305.png" alt="image-20210221224305487"></p><p>é˜¶æ®µ 1: Initial Markï¼ˆåˆå§‹æ ‡è®°ï¼‰</p><p>é˜¶æ®µ 2: Concurrent Markï¼ˆå¹¶å‘æ ‡è®°ï¼‰</p><p>é˜¶æ®µ 3: Concurrent Precleanï¼ˆå¹¶å‘é¢„æ¸…ç†ï¼‰</p><p>é˜¶æ®µ 4: Final Remarkï¼ˆæœ€ç»ˆæ ‡è®°ï¼‰</p><p>é˜¶æ®µ 5: Concurrent Sweepï¼ˆå¹¶å‘æ¸…é™¤ï¼‰</p><p>é˜¶æ®µ 6: Concurrent Resetï¼ˆå¹¶å‘é‡ç½®ï¼‰</p><p><strong>æ­¤é˜¶æ®µåŒæ ·æ˜¯ä¸åº”ç”¨çº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„ï¼Œä¸éœ€è¦åœæ­¢åº”ç”¨çº¿ç¨‹ã€‚ å› ä¸ºå‰ä¸€é˜¶æ®µã€å¹¶å‘æ ‡è®°ã€‘ä¸ç¨‹åºå¹¶å‘è¿è¡Œï¼Œå¯èƒ½æœ‰ä¸€äº›å¼•ç”¨å…³ç³»å·²ç»å‘ç”Ÿäº†æ”¹å˜ã€‚å¦‚æœåœ¨å¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­å¼•ç”¨å…³ç³»å‘ç”Ÿäº†å˜åŒ–ï¼ŒJVM ä¼šé€šè¿‡â€œCardï¼ˆå¡ç‰‡ï¼‰â€çš„æ–¹å¼å°†å‘ç”Ÿäº†æ”¹å˜çš„åŒºåŸŸæ ‡è®°ä¸ºâ€œè„â€åŒºï¼Œè¿™å°±æ˜¯æ‰€è°“çš„ å¡ç‰‡æ ‡è®°ï¼ˆCard Markingï¼‰ã€‚</strong></p><h3 id="CMS-GCâ€“å…­ä¸ªé˜¶æ®µ-4ï¼ˆSTWï¼‰"><a href="#CMS-GCâ€“å…­ä¸ªé˜¶æ®µ-4ï¼ˆSTWï¼‰" class="headerlink" title="CMS GCâ€“å…­ä¸ªé˜¶æ®µ 4ï¼ˆSTWï¼‰"></a><strong>CMS GCâ€“å…­ä¸ªé˜¶æ®µ 4ï¼ˆSTWï¼‰</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221224359.png" alt="image-20210221224359868"></p><p>é˜¶æ®µ 1: Initial Markï¼ˆåˆå§‹æ ‡è®°ï¼‰</p><p>é˜¶æ®µ 2: Concurrent Markï¼ˆå¹¶å‘æ ‡è®°ï¼‰</p><p>é˜¶æ®µ 3: Concurrent Precleanï¼ˆå¹¶å‘é¢„æ¸…ç†ï¼‰</p><p>é˜¶æ®µ 4: Final Remarkï¼ˆæœ€ç»ˆæ ‡è®°ï¼‰</p><p>é˜¶æ®µ 5: Concurrent Sweepï¼ˆå¹¶å‘æ¸…é™¤ï¼‰</p><p>é˜¶æ®µ 6: Concurrent Resetï¼ˆå¹¶å‘é‡ç½®ï¼‰</p><p><strong>æœ€ç»ˆæ ‡è®°é˜¶æ®µæ˜¯æ­¤æ¬¡ GC äº‹ä»¶ä¸­çš„ç¬¬äºŒæ¬¡ï¼ˆä¹Ÿæ˜¯æœ€åä¸€æ¬¡ï¼‰STW åœé¡¿ã€‚æœ¬é˜¶æ®µçš„ç›®æ ‡æ˜¯å®Œæˆè€å¹´ä»£ä¸­æ‰€æœ‰å­˜æ´»å¯¹è±¡çš„æ ‡è®°. å› ä¸ºä¹‹å‰çš„é¢„æ¸…ç†é˜¶æ®µæ˜¯å¹¶å‘æ‰§è¡Œçš„ï¼Œæœ‰å¯èƒ½ GC çº¿ç¨‹è·Ÿä¸ä¸Šåº”ç”¨ç¨‹åºçš„ä¿®æ”¹é€Ÿåº¦ã€‚æ‰€ä»¥éœ€è¦ä¸€æ¬¡STW æš‚åœæ¥å¤„ç†å„ç§å¤æ‚çš„æƒ…å†µã€‚é€šå¸¸ CMS ä¼šå°è¯•åœ¨å¹´è½»ä»£å°½å¯èƒ½ç©ºçš„æƒ…å†µä¸‹æ‰§è¡Œ FinalRemark é˜¶æ®µï¼Œä»¥å…è¿ç»­è§¦å‘å¤šæ¬¡ STW äº‹ä»¶ã€‚</strong>æœ€ç»ˆæ ‡è®°</p><h3 id="CMS-GCâ€“å…­ä¸ªé˜¶æ®µ-5"><a href="#CMS-GCâ€“å…­ä¸ªé˜¶æ®µ-5" class="headerlink" title="CMS GCâ€“å…­ä¸ªé˜¶æ®µ 5"></a><strong>CMS GCâ€“å…­ä¸ªé˜¶æ®µ 5</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221224416.png" alt="image-20210221224416548"></p><p>é˜¶æ®µ 1: Initial Markï¼ˆåˆå§‹æ ‡è®°ï¼‰</p><p>é˜¶æ®µ 2: Concurrent Markï¼ˆå¹¶å‘æ ‡è®°ï¼‰</p><p>é˜¶æ®µ 3: Concurrent Precleanï¼ˆå¹¶å‘é¢„æ¸…ç†ï¼‰</p><p>é˜¶æ®µ 4: Final Remarkï¼ˆæœ€ç»ˆæ ‡è®°ï¼‰</p><p>é˜¶æ®µ 5: Concurrent Sweepï¼ˆå¹¶å‘æ¸…é™¤ï¼‰</p><p>é˜¶æ®µ 6: Concurrent Resetï¼ˆå¹¶å‘é‡ç½®ï¼‰</p><p><strong>æ­¤é˜¶æ®µä¸åº”ç”¨ç¨‹åºå¹¶å‘æ‰§è¡Œï¼Œä¸éœ€è¦ STW åœé¡¿ã€‚JVM åœ¨æ­¤é˜¶æ®µåˆ é™¤ä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼Œå¹¶å›æ”¶ä»–ä»¬å ç”¨çš„å†…å­˜ç©ºé—´ã€‚</strong></p><h3 id="CMS-GCâ€“å…­ä¸ªé˜¶æ®µ-6"><a href="#CMS-GCâ€“å…­ä¸ªé˜¶æ®µ-6" class="headerlink" title="CMS GCâ€“å…­ä¸ªé˜¶æ®µ 6"></a><strong>CMS GCâ€“å…­ä¸ªé˜¶æ®µ 6</strong></h3><p>é˜¶æ®µ 1: Initial Markï¼ˆåˆå§‹æ ‡è®°ï¼‰</p><p>é˜¶æ®µ 2: Concurrent Markï¼ˆå¹¶å‘æ ‡è®°ï¼‰</p><p>é˜¶æ®µ 3: Concurrent Precleanï¼ˆå¹¶å‘é¢„æ¸…ç†ï¼‰</p><p>é˜¶æ®µ 4: Final Remarkï¼ˆæœ€ç»ˆæ ‡è®°ï¼‰</p><p>é˜¶æ®µ 5: Concurrent Sweepï¼ˆå¹¶å‘æ¸…é™¤ï¼‰</p><p>é˜¶æ®µ 6: Concurrent Resetï¼ˆå¹¶å‘é‡ç½®ï¼‰</p><p><strong>æ­¤é˜¶æ®µä¸åº”ç”¨ç¨‹åºå¹¶å‘æ‰§è¡Œï¼Œé‡ç½® CMS ç®—æ³•ç›¸å…³çš„å†…éƒ¨æ•°æ®ï¼Œä¸ºä¸‹ä¸€æ¬¡ GC å¾ªç¯åšå‡†å¤‡ã€‚</strong></p><p><strong>CMS åƒåœ¾æ”¶é›†å™¨åœ¨å‡å°‘åœé¡¿æ—¶é—´ä¸Šåšäº†å¾ˆå¤šå¤æ‚è€Œæœ‰ç”¨çš„å·¥ä½œï¼Œç”¨äºåƒåœ¾å›æ”¶çš„å¹¶å‘çº¿ç¨‹æ‰§è¡Œçš„åŒæ—¶ï¼Œå¹¶ä¸éœ€è¦æš‚åœåº”ç”¨çº¿ç¨‹ã€‚ å½“ç„¶ï¼ŒCMS ä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ï¼Œå…¶ä¸­æœ€å¤§çš„é—®é¢˜å°±æ˜¯è€å¹´ä»£å†…å­˜ç¢ç‰‡é—®é¢˜ï¼ˆå› ä¸ºä¸å‹ç¼©ï¼‰ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ GC ä¼šé€ æˆä¸å¯é¢„æµ‹çš„æš‚åœæ—¶é—´ï¼Œç‰¹åˆ«æ˜¯å †</strong></p><p><strong>å†…å­˜è¾ƒå¤§çš„æƒ…å†µä¸‹ã€‚</strong></p><p><strong>æ¼”ç¤ºï¼šCMS GCï¼Œå¸¸ç”¨å‚æ•°ä»¥åŠå…¶å†…å­˜åˆ†é…ï¼ˆæ³¨æ„è·Ÿ ParallelGC æœ‰ä»€ä¹ˆå·®å¼‚ï¼‰</strong></p><h3 id="G1-GC"><a href="#G1-GC" class="headerlink" title="G1 GC"></a><strong>G1 GC</strong></h3><p>![image-20210221224900621](/Users/cutie/Library/Application Support/typora-user-images/image-20210221224900621.png)</p><p>G1 çš„å…¨ç§°æ˜¯ Garbage-Firstï¼Œæ„ä¸ºåƒåœ¾ä¼˜å…ˆï¼Œå“ªä¸€å—çš„åƒåœ¾æœ€å¤šå°±ä¼˜å…ˆæ¸…ç†å®ƒã€‚</p><p>G1 GC æœ€ä¸»è¦çš„è®¾è®¡ç›®æ ‡æ˜¯ï¼šå°† STW åœé¡¿çš„æ—¶é—´å’Œåˆ†å¸ƒï¼Œå˜æˆå¯é¢„æœŸä¸”å¯é…ç½®çš„ã€‚</p><p>äº‹å®ä¸Šï¼ŒG1 GC æ˜¯ä¸€æ¬¾è½¯å®æ—¶åƒåœ¾æ”¶é›†å™¨ï¼Œå¯ä»¥ä¸ºå…¶è®¾ç½®æŸé¡¹ç‰¹å®šçš„æ€§èƒ½æŒ‡æ ‡ã€‚ä¸ºäº†è¾¾æˆå¯é¢„æœŸåœé¡¿æ—¶é—´çš„æŒ‡æ ‡ï¼ŒG1 GC æœ‰ä¸€äº›ç‹¬ç‰¹çš„å®ç°ã€‚é¦–å…ˆï¼Œå †ä¸å†åˆ†æˆå¹´è½»ä»£å’Œè€å¹´ä»£ï¼Œè€Œæ˜¯åˆ’åˆ†ä¸ºå¤šä¸ªï¼ˆé€šå¸¸æ˜¯ 2048 ä¸ªï¼‰å¯ä»¥å­˜æ”¾å¯¹è±¡çš„ å°å—å †åŒºåŸŸ(smaller heap regions)ã€‚æ¯ä¸ªå°å—ï¼Œå¯èƒ½ä¸€ä¼šè¢«å®šä¹‰æˆ Eden åŒºï¼Œä¸€ä¼šè¢«æŒ‡å®šä¸º SurvivoråŒºæˆ–è€…Old åŒºã€‚åœ¨é€»è¾‘ä¸Šï¼Œæ‰€æœ‰çš„ Eden åŒºå’Œ SurvivoråŒºåˆèµ·æ¥å°±æ˜¯å¹´è½»ä»£ï¼Œæ‰€æœ‰çš„ Old åŒºæ‹¼åœ¨ä¸€èµ·é‚£å°±æ˜¯è€å¹´ä»£</p><p>XXï¼š+UseG1GC -XX:MaxGCPauseMillis=50</p><h3 id="G1-GC-1"><a href="#G1-GC-1" class="headerlink" title="G1 GC"></a><strong>G1 GC</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221224930.png" alt="image-20210221224929948"></p><p>è¿™æ ·åˆ’åˆ†ä¹‹åï¼Œä½¿å¾— G1 ä¸å¿…æ¯æ¬¡éƒ½å»æ”¶é›†æ•´</p><p>ä¸ªå †ç©ºé—´ï¼Œè€Œæ˜¯ä»¥å¢é‡çš„æ–¹å¼æ¥è¿›è¡Œå¤„ç†: æ¯</p><p>æ¬¡åªå¤„ç†ä¸€éƒ¨åˆ†å†…å­˜å—ï¼Œç§°ä¸ºæ­¤æ¬¡ GC çš„å›æ”¶</p><p>é›†(collection set)ã€‚æ¯æ¬¡ GC æš‚åœéƒ½ä¼šæ”¶é›†æ‰€</p><p>æœ‰å¹´è½»ä»£çš„å†…å­˜å—ï¼Œä½†ä¸€èˆ¬åªåŒ…å«éƒ¨åˆ†è€å¹´ä»£</p><p>çš„å†…å­˜å—ã€‚</p><p>G1 çš„å¦ä¸€é¡¹åˆ›æ–°æ˜¯ï¼Œåœ¨å¹¶å‘é˜¶æ®µä¼°ç®—æ¯ä¸ªå°</p><p>å †å—å­˜æ´»å¯¹è±¡çš„æ€»æ•°ã€‚æ„å»ºå›æ”¶é›†çš„åŸåˆ™æ˜¯ï¼š</p><p>åƒåœ¾æœ€å¤šçš„å°å—ä¼šè¢«ä¼˜å…ˆæ”¶é›†ã€‚è¿™ä¹Ÿæ˜¯ G1 å</p><p>ç§°çš„ç”±æ¥ã€‚</p><h3 id="G1-GCâ€“é…ç½®å‚æ•°"><a href="#G1-GCâ€“é…ç½®å‚æ•°" class="headerlink" title="G1 GCâ€“é…ç½®å‚æ•°"></a><strong>G1 GCâ€“é…ç½®å‚æ•°</strong></h3><p>XXï¼š+UseG1GCï¼šå¯ç”¨ G1 GCï¼›</p><p>XXï¼šG1NewSizePercentï¼šåˆå§‹å¹´è½»ä»£å æ•´ä¸ª Java Heap çš„å¤§å°ï¼Œé»˜è®¤å€¼ä¸º 5%ï¼›</p><p>XXï¼šG1MaxNewSizePercentï¼šæœ€å¤§å¹´è½»ä»£å æ•´ä¸ª Java Heap çš„å¤§å°ï¼Œé»˜è®¤å€¼ä¸º 60%ï¼›</p><p>XXï¼šG1HeapRegionSizeï¼šè®¾ç½®æ¯ä¸ª Region çš„å¤§å°ï¼Œå•ä½ MBï¼Œéœ€è¦ä¸º 1ï¼Œ2ï¼Œ4ï¼Œ8ï¼Œ16ï¼Œ32 ä¸­çš„æŸä¸ªå€¼ï¼Œé»˜è®¤æ˜¯å †å†…å­˜çš„ 1/2000ã€‚å¦‚æœè¿™ä¸ªå€¼è®¾ç½®æ¯”è¾ƒå¤§ï¼Œé‚£ä¹ˆå¤§å¯¹è±¡å°±å¯ä»¥è¿›å…¥ Region äº†ã€‚</p><p>XXï¼šConcGCThreadsï¼šä¸ Java åº”ç”¨ä¸€èµ·æ‰§è¡Œçš„ GC çº¿ç¨‹æ•°é‡ï¼Œé»˜è®¤æ˜¯ Java çº¿ç¨‹çš„ 1/4ï¼Œå‡å°‘è¿™ä¸ªå‚æ•°çš„æ•°å€¼å¯èƒ½ä¼šæå‡å¹¶è¡Œå›æ”¶çš„æ•ˆç‡ï¼Œæé«˜ç³»ç»Ÿå†…éƒ¨ååé‡ã€‚å¦‚æœè¿™ä¸ªæ•°å€¼è¿‡ä½ï¼Œå‚ä¸å›æ”¶åƒåœ¾çš„çº¿ç¨‹ä¸è¶³ï¼Œä¹Ÿä¼šå¯¼è‡´å¹¶è¡Œå›æ”¶æœºåˆ¶è€—æ—¶åŠ é•¿ã€‚</p><p>XXï¼š+InitiatingHeapOccupancyPercentï¼ˆç®€ç§° IHOPï¼‰ï¼šG1 å†…éƒ¨å¹¶è¡Œå›æ”¶å¾ªç¯å¯åŠ¨çš„é˜ˆå€¼ï¼Œé»˜è®¤ä¸º Java Heap çš„ 45%ã€‚è¿™ä¸ªå¯ä»¥ç†è§£ä¸ºè€å¹´ä»£ä½¿ç”¨å¤§äºç­‰äº 45% çš„æ—¶å€™ï¼ŒJVM ä¼šå¯åŠ¨åƒåœ¾å›æ”¶ã€‚è¿™ä¸ªå€¼éå¸¸é‡è¦ï¼Œå®ƒå†³å®šäº†åœ¨ä»€ä¹ˆæ—¶é—´å¯åŠ¨è€å¹´ä»£çš„å¹¶è¡Œå›æ”¶ã€‚</p><p>XXï¼šG1HeapWastePercentï¼šG1åœæ­¢å›æ”¶çš„æœ€å°å†…å­˜å¤§å°ï¼Œé»˜è®¤æ˜¯å †å¤§å°çš„ 5%ã€‚GC ä¼šæ”¶é›†æ‰€æœ‰çš„ Region ä¸­çš„å¯¹è±¡ï¼Œä½†æ˜¯å¦‚æœä¸‹é™åˆ°äº† 5%ï¼Œå°±ä¼šåœä¸‹æ¥ä¸å†æ”¶é›†äº†ã€‚å°±æ˜¯è¯´ï¼Œä¸å¿…æ¯æ¬¡å›æ”¶å°±æŠŠæ‰€æœ‰çš„åƒåœ¾éƒ½å¤„ç†å®Œï¼Œå¯ä»¥é—ç•™å°‘é‡çš„ä¸‹æ¬¡å¤„ç†ï¼Œè¿™æ ·ä¹Ÿé™ä½äº†å•æ¬¡æ¶ˆè€—çš„æ—¶é—´ã€‚</p><p>XXï¼šG1MixedGCCountTargetï¼šè®¾ç½®å¹¶è¡Œå¾ªç¯ä¹‹åéœ€è¦æœ‰å¤šå°‘ä¸ªæ··åˆ GC å¯åŠ¨ï¼Œé»˜è®¤å€¼æ˜¯ 8 ä¸ªã€‚è€å¹´ä»£ Regions çš„å›æ”¶æ—¶é—´é€šå¸¸æ¯”å¹´è½»ä»£çš„æ”¶é›†æ—¶é—´è¦é•¿ä¸€äº›ã€‚æ‰€ä»¥å¦‚æœæ··åˆæ”¶é›†å™¨æ¯”è¾ƒå¤šï¼Œå¯ä»¥å…è®¸ G1 å»¶é•¿è€å¹´ä»£çš„æ”¶é›†æ—¶é—´ã€‚</p><h3 id="G1-GCâ€“é…ç½®å‚æ•°-1"><a href="#G1-GCâ€“é…ç½®å‚æ•°-1" class="headerlink" title="G1 GCâ€“é…ç½®å‚æ•°"></a><strong>G1 GCâ€“é…ç½®å‚æ•°</strong></h3><p>XXï¼š+G1PrintRegionLivenessInfoï¼šè¿™ä¸ªå‚æ•°éœ€è¦å’Œ -XX:+UnlockDiagnosticVMOptions é…åˆå¯åŠ¨ï¼Œæ‰“å° JVM çš„è°ƒè¯•ä¿¡æ¯ï¼Œæ¯ä¸ª Region é‡Œçš„å¯¹è±¡å­˜æ´»ä¿¡æ¯ã€‚</p><p>XXï¼šG1ReservePercentï¼šG1 ä¸ºäº†ä¿ç•™ä¸€äº›ç©ºé—´ç”¨äºå¹´ä»£ä¹‹é—´çš„æå‡ï¼Œé»˜è®¤å€¼æ˜¯å †ç©ºé—´çš„ 10%ã€‚å› ä¸ºå¤§é‡æ‰§è¡Œå›æ”¶çš„åœ°æ–¹åœ¨å¹´è½»ä»£ï¼ˆå­˜æ´»æ—¶é—´è¾ƒçŸ­ï¼‰ï¼Œæ‰€ä»¥å¦‚æœä½ çš„åº”ç”¨é‡Œé¢æœ‰æ¯”è¾ƒå¤§çš„å †å†…å­˜ç©ºé—´ã€æ¯”è¾ƒå¤šçš„å¤§å¯¹è±¡å­˜æ´»ï¼Œè¿™é‡Œéœ€è¦ä¿ç•™ä¸€äº›å†…å­˜ã€‚</p><p>XXï¼š+G1SummarizeRSetStatsï¼šè¿™ä¹Ÿæ˜¯ä¸€ä¸ª VM çš„è°ƒè¯•ä¿¡æ¯ã€‚å¦‚æœå¯ç”¨ï¼Œä¼šåœ¨ VM é€€å‡ºçš„æ—¶å€™æ‰“å°å‡º Rsets çš„è¯¦ç»†æ€»ç»“ä¿¡æ¯ã€‚å¦‚æœå¯ç”¨ -XX:G1SummaryRSetStatsPeriod å‚æ•°ï¼Œå°±ä¼šé˜¶æ®µæ€§åœ°æ‰“å° Rsets ä¿¡æ¯ã€‚</p><p>XXï¼š+G1TraceConcRefinementï¼šè¿™ä¸ªä¹Ÿæ˜¯ä¸€ä¸ª VM çš„è°ƒè¯•ä¿¡æ¯ï¼Œå¦‚æœå¯ç”¨ï¼Œå¹¶è¡Œå›æ”¶é˜¶æ®µçš„æ—¥å¿—å°±ä¼šè¢«è¯¦ç»†æ‰“å°å‡ºæ¥ã€‚</p><p>XXï¼š+GCTimeRatioï¼šè¿™ä¸ªå‚æ•°å°±æ˜¯è®¡ç®—èŠ±åœ¨ Java åº”ç”¨çº¿ç¨‹ä¸Šå’ŒèŠ±åœ¨ GC çº¿ç¨‹ä¸Šçš„æ—¶é—´æ¯”ç‡ï¼Œé»˜è®¤æ˜¯ 9ï¼Œè·Ÿæ–°ç”Ÿä»£å†…å­˜çš„åˆ†é…æ¯”ä¾‹ä¸€è‡´ã€‚è¿™ä¸ªå‚æ•°ä¸»è¦çš„ç›®çš„æ˜¯è®©ç”¨æˆ·å¯ä»¥æ§åˆ¶èŠ±åœ¨åº”ç”¨ä¸Šçš„æ—¶é—´ï¼ŒG1 çš„è®¡ç®—å…¬å¼æ˜¯ 100/ï¼ˆ1+GCTimeRatioï¼‰ã€‚è¿™æ ·å¦‚æœå‚æ•°è®¾ç½®ä¸º 9ï¼Œåˆ™æœ€å¤š 10% çš„æ—¶é—´ä¼šèŠ±åœ¨ GC å·¥ä½œä¸Šé¢ã€‚Parallel GC çš„é»˜è®¤å€¼æ˜¯ 99ï¼Œè¡¨ç¤º 1% çš„æ—¶é—´è¢«ç”¨åœ¨ GC ä¸Šé¢ï¼Œè¿™æ˜¯å› ä¸º Parallel GC è´¯ç©¿æ•´ä¸ª GCï¼Œè€Œ G1 åˆ™æ ¹æ® Region æ¥è¿›è¡Œåˆ’åˆ†ï¼Œä¸éœ€è¦å…¨å±€æ€§æ‰«ææ•´ä¸ªå†…å­˜å †ã€‚</p><p>XXï¼š+UseStringDeduplicationï¼šæ‰‹åŠ¨å¼€å¯ Java String å¯¹è±¡çš„å»é‡å·¥ä½œï¼Œè¿™ä¸ªæ˜¯ JDK8u20 ç‰ˆæœ¬ä¹‹åæ–°å¢çš„å‚æ•°ï¼Œä¸»è¦ç”¨äºç›¸åŒ String é¿å…é‡å¤ç”³è¯·å†…å­˜ï¼ŒèŠ‚çº¦ Region çš„ä½¿ç”¨ã€‚</p><p>XXï¼šMaxGCPauseMillsï¼šé¢„æœŸ G1 æ¯æ¬¡æ‰§è¡Œ GC æ“ä½œçš„æš‚åœæ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ï¼Œé»˜è®¤å€¼æ˜¯ 200 æ¯«ç§’ï¼ŒG1 ä¼šå°½é‡ä¿è¯æ§åˆ¶åœ¨è¿™ä¸ªèŒƒå›´å†…ã€‚</p><h3 id="G1-GC-çš„å¤„ç†æ­¥éª¤-1"><a href="#G1-GC-çš„å¤„ç†æ­¥éª¤-1" class="headerlink" title="G1 GC çš„å¤„ç†æ­¥éª¤ 1"></a><strong>G1 GC çš„å¤„ç†æ­¥éª¤ 1</strong></h3><p>1ã€å¹´è½»ä»£æ¨¡å¼è½¬ç§»æš‚åœï¼ˆEvacuation Pauseï¼‰</p><p>G1 GC ä¼šé€šè¿‡å‰é¢ä¸€æ®µæ—¶é—´çš„è¿è¡Œæƒ…å†µæ¥ä¸æ–­çš„è°ƒæ•´è‡ªå·±çš„å›æ”¶ç­–ç•¥å’Œè¡Œä¸ºï¼Œä»¥æ­¤æ¥æ¯”è¾ƒç¨³å®šåœ°æ§åˆ¶æš‚åœæ—¶é—´ã€‚åœ¨åº”ç”¨ç¨‹åºåˆšå¯åŠ¨æ—¶ï¼ŒG1 è¿˜æ²¡æœ‰é‡‡é›†åˆ°ä»€ä¹ˆè¶³å¤Ÿçš„ä¿¡æ¯ï¼Œè¿™æ—¶å€™å°±å¤„äºåˆå§‹çš„ fullyyoung æ¨¡å¼ã€‚å½“å¹´è½»ä»£ç©ºé—´ç”¨æ»¡åï¼Œåº”ç”¨çº¿ç¨‹ä¼šè¢«æš‚åœï¼Œå¹´è½»ä»£å†…å­˜å—ä¸­çš„å­˜æ´»å¯¹è±¡è¢«æ‹·è´åˆ°å­˜æ´»åŒºã€‚å¦‚æœè¿˜æ²¡æœ‰å­˜æ´»åŒºï¼Œåˆ™ä»»æ„é€‰æ‹©ä¸€éƒ¨åˆ†ç©ºé—²çš„å†…å­˜å—ä½œä¸ºå­˜æ´»åŒºã€‚æ‹·è´çš„è¿‡ç¨‹ç§°ä¸ºè½¬ç§»ï¼ˆEvacuation)ï¼Œè¿™å’Œå‰é¢ä»‹ç»çš„å…¶ä»–å¹´è½»ä»£æ”¶é›†å™¨æ˜¯ä¸€æ ·çš„å·¥ä½œåŸç†ã€‚</p><h3 id="G1-GC-çš„å¤„ç†æ­¥éª¤-2"><a href="#G1-GC-çš„å¤„ç†æ­¥éª¤-2" class="headerlink" title="G1 GC çš„å¤„ç†æ­¥éª¤ 2"></a><strong>G1 GC çš„å¤„ç†æ­¥éª¤ 2</strong></h3><p>2ã€å¹¶å‘æ ‡è®°ï¼ˆConcurrent Markingï¼‰</p><p>åŒæ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼ŒG1 GC çš„å¾ˆå¤šæ¦‚å¿µå»ºç«‹åœ¨ CMS çš„åŸºç¡€ä¸Šï¼Œæ‰€ä»¥ä¸‹é¢çš„å†…å®¹éœ€è¦å¯¹ CMS æœ‰ä¸€å®šçš„</p><p>ç†è§£ã€‚</p><p>G1 å¹¶å‘æ ‡è®°çš„è¿‡ç¨‹ä¸ CMS åŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„ã€‚G1 çš„å¹¶å‘æ ‡è®°é€šè¿‡ Snapshot-At-The-Beginningï¼ˆèµ·å§‹å¿«ç…§ï¼‰çš„æ–¹å¼ï¼Œåœ¨æ ‡è®°é˜¶æ®µå¼€å§‹æ—¶è®°ä¸‹æ‰€æœ‰çš„å­˜æ´»å¯¹è±¡ã€‚å³ä½¿åœ¨æ ‡è®°çš„åŒæ—¶åˆæœ‰ä¸€äº›å˜æˆäº†åƒåœ¾ã€‚é€šè¿‡å¯¹è±¡çš„å­˜æ´»ä¿¡æ¯ï¼Œå¯ä»¥æ„å»ºå‡ºæ¯ä¸ªå°å †å—çš„å­˜æ´»çŠ¶æ€ï¼Œä»¥ä¾¿å›æ”¶é›†èƒ½é«˜æ•ˆåœ°è¿›è¡Œé€‰æ‹©ã€‚è¿™äº›ä¿¡æ¯åœ¨æ¥ä¸‹æ¥çš„é˜¶æ®µä¼šç”¨æ¥æ‰§è¡Œè€å¹´ä»£åŒºåŸŸçš„åƒåœ¾æ”¶é›†ã€‚</p><p>æœ‰ä¸¤ç§æƒ…å†µæ˜¯å¯ä»¥å®Œå…¨å¹¶å‘æ‰§è¡Œçš„ï¼š</p><p>ä¸€ã€å¦‚æœåœ¨æ ‡è®°é˜¶æ®µç¡®å®šæŸä¸ªå°å †å—ä¸­æ²¡æœ‰å­˜æ´»å¯¹è±¡ï¼ŒåªåŒ…å«åƒåœ¾ï¼›</p><p>äºŒã€åœ¨ STW è½¬ç§»æš‚åœæœŸé—´ï¼ŒåŒæ—¶åŒ…å«åƒåœ¾å’Œå­˜æ´»å¯¹è±¡çš„è€å¹´ä»£å°å †å—ã€‚</p><p>å½“å †å†…å­˜çš„æ€»ä½“ä½¿ç”¨æ¯”ä¾‹è¾¾åˆ°ä¸€å®šæ•°å€¼ï¼Œå°±ä¼šè§¦å‘å¹¶å‘æ ‡è®°ã€‚è¿™ä¸ªé»˜è®¤æ¯”ä¾‹æ˜¯ 45%ï¼Œä½†ä¹Ÿå¯ä»¥é€šè¿‡ JVMå‚æ•° InitiatingHeapOccupancyPercent æ¥è®¾ç½®ã€‚å’Œ CMS ä¸€æ ·ï¼ŒG1 çš„å¹¶å‘æ ‡è®°ä¹Ÿæ˜¯ç”±å¤šä¸ªé˜¶æ®µç»„æˆï¼Œå…¶ä¸­ä¸€äº›é˜¶æ®µæ˜¯å®Œå…¨å¹¶å‘çš„ï¼Œè¿˜æœ‰ä¸€äº›é˜¶æ®µåˆ™ä¼šæš‚åœåº”ç”¨çº¿ç¨‹ã€‚</p><h3 id="G1-GC-çš„å¤„ç†æ­¥éª¤-2-1"><a href="#G1-GC-çš„å¤„ç†æ­¥éª¤-2-1" class="headerlink" title="G1 GC çš„å¤„ç†æ­¥éª¤ 2"></a><strong>G1 GC çš„å¤„ç†æ­¥éª¤ 2</strong></h3><p><strong>é˜¶æ®µ 1: Initial Markï¼ˆåˆå§‹æ ‡è®°ï¼‰</strong></p><p>æ­¤é˜¶æ®µæ ‡è®°æ‰€æœ‰ä» GC æ ¹å¯¹è±¡ç›´æ¥å¯è¾¾çš„å¯¹è±¡ã€‚</p><p><strong>é˜¶æ®µ 2: Root Region Scanï¼ˆRootåŒºæ‰«æï¼‰</strong></p><p>æ­¤é˜¶æ®µæ ‡è®°æ‰€æœ‰ä» â€œæ ¹åŒºåŸŸâ€ å¯è¾¾çš„å­˜æ´»å¯¹è±¡ã€‚æ ¹åŒºåŸŸåŒ…æ‹¬ï¼šéç©ºçš„åŒºåŸŸï¼Œä»¥åŠåœ¨æ ‡è®°è¿‡ç¨‹ä¸­ä¸å¾—ä¸æ”¶é›†çš„åŒºåŸŸã€‚</p><p><strong>é˜¶æ®µ 3: Concurrent Markï¼ˆå¹¶å‘æ ‡è®°ï¼‰</strong></p><p>æ­¤é˜¶æ®µå’Œ CMS çš„å¹¶å‘æ ‡è®°é˜¶æ®µéå¸¸ç±»ä¼¼ï¼šåªéå†å¯¹è±¡å›¾ï¼Œå¹¶åœ¨ä¸€ä¸ªç‰¹æ®Šçš„ä½å›¾ä¸­æ ‡è®°èƒ½è®¿é—®åˆ°çš„å¯¹è±¡ã€‚</p><p><strong>é˜¶æ®µ 4: Remarkï¼ˆå†æ¬¡æ ‡è®°ï¼‰</strong></p><p>å’Œ CMS ç±»ä¼¼ï¼Œè¿™æ˜¯ä¸€æ¬¡ STW åœé¡¿(å› ä¸ºä¸æ˜¯å¹¶å‘çš„é˜¶æ®µ)ï¼Œä»¥å®Œæˆæ ‡è®°è¿‡ç¨‹ã€‚ G1 æ”¶é›†å™¨ä¼šçŸ­æš‚åœ°åœæ­¢åº”ç”¨çº¿ç¨‹ï¼Œåœæ­¢å¹¶å‘æ›´æ–°ä¿¡æ¯çš„å†™å…¥ï¼Œå¤„ç†å…¶ä¸­çš„å°‘é‡ä¿¡æ¯ï¼Œå¹¶æ ‡è®°æ‰€æœ‰åœ¨å¹¶å‘æ ‡è®°å¼€å§‹æ—¶æœªè¢«æ ‡è®°çš„å­˜æ´»å¯¹è±¡ã€‚</p><p><strong>é˜¶æ®µ 5: Cleanupï¼ˆæ¸…ç†ï¼‰</strong></p><p>æœ€åè¿™ä¸ªæ¸…ç†é˜¶æ®µä¸ºå³å°†åˆ°æ¥çš„è½¬ç§»é˜¶æ®µåšå‡†å¤‡ï¼Œç»Ÿè®¡å°å †å—ä¸­æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡ï¼Œå¹¶å°†å°å †å—è¿›è¡Œæ’åºï¼Œä»¥æå‡GC çš„æ•ˆç‡ï¼Œç»´æŠ¤å¹¶å‘æ ‡è®°çš„å†…éƒ¨çŠ¶æ€ã€‚ æ‰€æœ‰ä¸åŒ…å«å­˜æ´»å¯¹è±¡çš„å°å †å—åœ¨æ­¤é˜¶æ®µéƒ½è¢«å›æ”¶äº†ã€‚æœ‰ä¸€éƒ¨åˆ†ä»»åŠ¡æ˜¯å¹¶å‘çš„ï¼šä¾‹å¦‚ç©ºå †åŒºçš„å›æ”¶ï¼Œè¿˜æœ‰å¤§éƒ¨åˆ†çš„å­˜æ´»ç‡è®¡ç®—ã€‚æ­¤é˜¶æ®µä¹Ÿéœ€è¦ä¸€ä¸ªçŸ­æš‚çš„ STW æš‚åœã€‚</p><h3 id="G1-GC-çš„å¤„ç†æ­¥éª¤-3"><a href="#G1-GC-çš„å¤„ç†æ­¥éª¤-3" class="headerlink" title="G1 GC çš„å¤„ç†æ­¥éª¤ 3"></a><strong>G1 GC çš„å¤„ç†æ­¥éª¤ 3</strong></h3><p>3ã€è½¬ç§»æš‚åœ: æ··åˆæ¨¡å¼ï¼ˆEvacuation Pause (mixed)ï¼‰</p><p>å¹¶å‘æ ‡è®°å®Œæˆä¹‹åï¼ŒG1å°†æ‰§è¡Œä¸€æ¬¡æ··åˆæ”¶é›†ï¼ˆmixed collectionï¼‰ï¼Œå°±æ˜¯ä¸åªæ¸…ç†å¹´è½»ä»£ï¼Œè¿˜å°†ä¸€éƒ¨åˆ†è€å¹´ä»£åŒºåŸŸä¹ŸåŠ å…¥åˆ° å›æ”¶é›† ä¸­ã€‚æ··åˆæ¨¡å¼çš„è½¬ç§»æš‚åœä¸ä¸€å®šç´§è·Ÿå¹¶å‘æ ‡è®°é˜¶æ®µã€‚æœ‰å¾ˆå¤šè§„åˆ™å’Œå†å²æ•°æ®ä¼šå½±å“æ··åˆæ¨¡å¼çš„å¯åŠ¨æ—¶æœºã€‚æ¯”å¦‚ï¼Œå‡è‹¥åœ¨è€å¹´ä»£ä¸­å¯ä»¥å¹¶å‘åœ°è…¾å‡ºå¾ˆå¤šçš„å°å †å—ï¼Œå°±æ²¡æœ‰å¿…è¦å¯åŠ¨æ··åˆæ¨¡å¼ã€‚</p><p>å› æ­¤ï¼Œåœ¨å¹¶å‘æ ‡è®°ä¸æ··åˆè½¬ç§»æš‚åœä¹‹é—´ï¼Œå¾ˆå¯èƒ½ä¼šå­˜åœ¨å¤šæ¬¡ young æ¨¡å¼çš„è½¬ç§»æš‚åœã€‚å…·ä½“æ·»åŠ åˆ°å›æ”¶é›†çš„è€å¹´ä»£å°å †å—çš„å¤§å°åŠé¡ºåºï¼Œä¹Ÿæ˜¯åŸºäºè®¸å¤šè§„åˆ™æ¥åˆ¤å®šçš„ã€‚å…¶ä¸­åŒ…æ‹¬æŒ‡å®šçš„è½¯å®æ—¶æ€§èƒ½æŒ‡æ ‡ï¼Œå­˜æ´»æ€§ï¼Œä»¥åŠåœ¨å¹¶å‘æ ‡è®°æœŸé—´æ”¶é›†çš„ GC æ•ˆç‡ç­‰æ•°æ®ï¼Œå¤–åŠ ä¸€äº›å¯é…ç½®çš„ JVM é€‰é¡¹ã€‚æ··åˆæ”¶é›†çš„è¿‡ç¨‹ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šå’Œå‰é¢çš„ fully-young gc æ˜¯ä¸€æ ·çš„ã€‚</p><h3 id="G1-GC-çš„æ³¨æ„äº‹é¡¹"><a href="#G1-GC-çš„æ³¨æ„äº‹é¡¹" class="headerlink" title="G1 GC çš„æ³¨æ„äº‹é¡¹"></a><strong>G1 GC çš„æ³¨æ„äº‹é¡¹</strong></h3><p>ç‰¹åˆ«éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒæŸäº›æƒ…å†µä¸‹ G1 è§¦å‘äº† Full GCï¼Œè¿™æ—¶ G1 ä¼šé€€åŒ–ä½¿ç”¨ Serial æ”¶é›†å™¨æ¥å®Œæˆåƒåœ¾çš„æ¸…ç†å·¥ä½œï¼Œå®ƒä»…ä»…ä½¿ç”¨å•çº¿ç¨‹æ¥å®Œæˆ GC å·¥ä½œï¼ŒGC æš‚åœæ—¶é—´å°†è¾¾åˆ°ç§’çº§åˆ«çš„ã€‚</p><p>1.å¹¶å‘æ¨¡å¼å¤±è´¥</p><p>G1 å¯åŠ¨æ ‡è®°å‘¨æœŸï¼Œä½†åœ¨ Mix GC ä¹‹å‰ï¼Œè€å¹´ä»£å°±è¢«å¡«æ»¡ï¼Œè¿™æ—¶å€™ G1 ä¼šæ”¾å¼ƒæ ‡è®°å‘¨æœŸã€‚è§£å†³åŠæ³•ï¼šå¢åŠ å †å¤§å°ï¼Œæˆ–è€…è°ƒæ•´å‘¨æœŸï¼ˆä¾‹å¦‚å¢åŠ çº¿ç¨‹æ•°-XXï¼šConcGCThreads ç­‰ï¼‰ã€‚</p><p>2.æ™‹å‡å¤±è´¥</p><p>æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ä¾›å­˜æ´»å¯¹è±¡æˆ–æ™‹å‡å¯¹è±¡ä½¿ç”¨ï¼Œç”±æ­¤è§¦å‘äº† Full GC(to-space exhausted/to-space overflowï¼‰ã€‚</p><p><strong>è§£å†³åŠæ³•ï¼š</strong></p><p>a) å¢åŠ  â€“XXï¼šG1ReservePercent é€‰é¡¹çš„å€¼ï¼ˆå¹¶ç›¸åº”å¢åŠ æ€»çš„å †å¤§å°ï¼‰å¢åŠ é¢„ç•™å†…å­˜é‡ã€‚</p><p>b) é€šè¿‡å‡å°‘ â€“XXï¼šInitiatingHeapOccupancyPercent æå‰å¯åŠ¨æ ‡è®°å‘¨æœŸã€‚</p><p>c) ä¹Ÿå¯ä»¥é€šè¿‡å¢åŠ  â€“XXï¼šConcGCThreads é€‰é¡¹çš„å€¼æ¥å¢åŠ å¹¶è¡Œæ ‡è®°çº¿ç¨‹çš„æ•°ç›®ã€‚</p><p>3.å·¨å‹å¯¹è±¡åˆ†é…å¤±è´¥</p><p>å½“å·¨å‹å¯¹è±¡æ‰¾ä¸åˆ°åˆé€‚çš„ç©ºé—´è¿›è¡Œåˆ†é…æ—¶ï¼Œå°±ä¼šå¯åŠ¨ Full GCï¼Œæ¥é‡Šæ”¾ç©ºé—´ã€‚</p><p>è§£å†³åŠæ³•ï¼šå¢åŠ å†…å­˜æˆ–è€…å¢å¤§ -XXï¼šG1HeapRegionSize</p><h3 id="æ¼”ç¤ºï¼šG1-GCï¼Œå¸¸ç”¨å‚æ•°ä»¥åŠå…¶å†…å­˜åˆ†é…ï¼ˆæ³¨æ„è·Ÿ-CMS-ParallelGC-æœ‰ä»€ä¹ˆå·®å¼‚ï¼‰"><a href="#æ¼”ç¤ºï¼šG1-GCï¼Œå¸¸ç”¨å‚æ•°ä»¥åŠå…¶å†…å­˜åˆ†é…ï¼ˆæ³¨æ„è·Ÿ-CMS-ParallelGC-æœ‰ä»€ä¹ˆå·®å¼‚ï¼‰" class="headerlink" title="æ¼”ç¤ºï¼šG1 GCï¼Œå¸¸ç”¨å‚æ•°ä»¥åŠå…¶å†…å­˜åˆ†é…ï¼ˆæ³¨æ„è·Ÿ CMS/ParallelGC æœ‰ä»€ä¹ˆå·®å¼‚ï¼‰"></a><strong>æ¼”ç¤ºï¼šG1 GCï¼Œå¸¸ç”¨å‚æ•°ä»¥åŠå…¶å†…å­˜åˆ†é…ï¼ˆæ³¨æ„è·Ÿ CMS/ParallelGC æœ‰ä»€ä¹ˆå·®å¼‚ï¼‰</strong></h3><h3 id="å„ä¸ª-GC-å¯¹æ¯”"><a href="#å„ä¸ª-GC-å¯¹æ¯”" class="headerlink" title="å„ä¸ª GC å¯¹æ¯”"></a><strong>å„ä¸ª GC å¯¹æ¯”</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221225324.png" alt="image-20210221225324280"></p><h3 id="å¸¸ç”¨çš„-GC-ç»„åˆï¼ˆé‡ç‚¹ï¼‰"><a href="#å¸¸ç”¨çš„-GC-ç»„åˆï¼ˆé‡ç‚¹ï¼‰" class="headerlink" title="å¸¸ç”¨çš„ GC ç»„åˆï¼ˆé‡ç‚¹ï¼‰"></a><strong>å¸¸ç”¨çš„ GC ç»„åˆï¼ˆé‡ç‚¹ï¼‰</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221225336.png" alt="image-20210221225336005"></p><p>å¸¸ç”¨çš„ç»„åˆä¸ºï¼š</p><p>ï¼ˆ1ï¼‰Serial+Serial Old å®ç°å•çº¿ç¨‹çš„ä½å»¶è¿Ÿ</p><p>åƒåœ¾å›æ”¶æœºåˆ¶ï¼›</p><p>ï¼ˆ2ï¼‰ParNew+CMSï¼Œå®ç°å¤šçº¿ç¨‹çš„ä½å»¶è¿Ÿåƒ</p><p>åœ¾å›æ”¶æœºåˆ¶ï¼›</p><p>ï¼ˆ3ï¼‰Parallel Scavengeå’ŒParallel</p><p>Scavenge Oldï¼Œå®ç°å¤šçº¿ç¨‹çš„é«˜ååé‡åƒåœ¾</p><p>å›æ”¶æœºåˆ¶ï¼›</p><h3 id="GC-å¦‚ä½•é€‰æ‹©"><a href="#GC-å¦‚ä½•é€‰æ‹©" class="headerlink" title="GC å¦‚ä½•é€‰æ‹©"></a><strong>GC å¦‚ä½•é€‰æ‹©</strong></h3><p>é€‰æ‹©æ­£ç¡®çš„ GC ç®—æ³•ï¼Œå”¯ä¸€å¯è¡Œçš„æ–¹å¼å°±æ˜¯å»å°è¯•ï¼Œä¸€èˆ¬æ€§çš„æŒ‡å¯¼åŸåˆ™ï¼š</p><ol><li>å¦‚æœç³»ç»Ÿè€ƒè™‘ååä¼˜å…ˆï¼ŒCPU èµ„æºéƒ½ç”¨æ¥æœ€å¤§ç¨‹åº¦å¤„ç†ä¸šåŠ¡ï¼Œç”¨ Parallel GCï¼›</li><li>å¦‚æœç³»ç»Ÿè€ƒè™‘ä½å»¶è¿Ÿæœ‰é™ï¼Œæ¯æ¬¡ GC æ—¶é—´å°½é‡çŸ­ï¼Œç”¨ CMS GCï¼›</li><li>å¦‚æœç³»ç»Ÿå†…å­˜å †è¾ƒå¤§ï¼ŒåŒæ—¶å¸Œæœ›æ•´ä½“æ¥çœ‹å¹³å‡ GC æ—¶é—´å¯æ§ï¼Œä½¿ç”¨ G1 GCã€‚</li></ol><p>å¯¹äºå†…å­˜å¤§å°çš„è€ƒé‡ï¼š</p><ol><li>ä¸€èˆ¬ 4G ä»¥ä¸Šï¼Œç®—æ˜¯æ¯”è¾ƒå¤§ï¼Œç”¨ G1 çš„æ€§ä»·æ¯”è¾ƒé«˜ã€‚</li><li>ä¸€èˆ¬è¶…è¿‡ 8Gï¼Œæ¯”å¦‚ 16G-64G å†…å­˜ï¼Œéå¸¸æ¨èä½¿ç”¨ G1 GCã€‚</li></ol><p>æœ€åè®¨è®ºä¸€ä¸ªå¾ˆå¤šå¼€å‘è€…ç»å¸¸å¿½è§†çš„é—®é¢˜ï¼Œä¹Ÿæ˜¯é¢è¯•å¤§å‚å¸¸é—®çš„é—®é¢˜ï¼šJDK8 çš„é»˜è®¤ GC æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>JDK9ï¼ŒJDK10ï¼ŒJDK11â€¦ç­‰ç­‰é»˜è®¤çš„æ˜¯ GC æ˜¯ä»€ä¹ˆï¼Ÿ</p><h2 id="6-ZGC-Shenandoah-GC"><a href="#6-ZGC-Shenandoah-GC" class="headerlink" title="6. ZGC/Shenandoah GC"></a>6. ZGC/Shenandoah GC</h2><h3 id="ZGC-ä»‹ç»"><a href="#ZGC-ä»‹ç»" class="headerlink" title="ZGC ä»‹ç»"></a><strong>ZGC ä»‹ç»</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221225402.png" alt="image-20210221225402246"></p><p>XXï¼š+UnlockExperimentalVMOptions -XX:+UseZGC -Xmx16g</p><p>ZGC æœ€ä¸»è¦çš„ç‰¹ç‚¹åŒ…æ‹¬:</p><ol><li>GC æœ€å¤§åœé¡¿æ—¶é—´ä¸è¶…è¿‡ 10ms</li><li>å †å†…å­˜æ”¯æŒèŒƒå›´å¹¿ï¼Œå°è‡³å‡ ç™¾ MB çš„å †ç©ºé—´ï¼Œå¤§è‡³ 4TB çš„è¶…å¤§å †</li></ol><p>å†…å­˜ï¼ˆJDK13 å‡è‡³ 16TBï¼‰</p><ol><li>ä¸ G1 ç›¸æ¯”ï¼Œåº”ç”¨ååé‡ä¸‹é™ä¸è¶…è¿‡ 15%</li><li>å½“å‰åªæ”¯æŒ Linux/x64 ä½å¹³å°ï¼ŒJDK15 åæ”¯æŒ MacOS å’Œ</li></ol><p>Windows ç³»ç»Ÿ</p><h3 id="ShennandoahGC-ä»‹ç»"><a href="#ShennandoahGC-ä»‹ç»" class="headerlink" title="ShennandoahGC ä»‹ç»"></a><strong>ShennandoahGC ä»‹ç»</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221225434.png" alt="image-20210221225434426"></p><p>XXï¼š+UnlockExperimentalVMOptions -</p><p>XX:+UseShenandoahGC -Xmx16g</p><p>Shenandoah GC ç«‹é¡¹æ¯” ZGC æ›´æ—©ï¼Œè®¾è®¡ä¸ºGC çº¿ç¨‹ä¸åº”ç”¨çº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„æ–¹å¼ï¼Œé€šè¿‡å®ç°åƒåœ¾å›æ”¶è¿‡ç¨‹çš„å¹¶å‘å¤„ç†ï¼Œæ”¹å–„åœé¡¿æ—¶é—´ï¼Œä½¿å¾— GC æ‰§è¡Œçº¿ç¨‹èƒ½å¤Ÿåœ¨ä¸šåŠ¡å¤„ç†çº¿ç¨‹è¿è¡Œè¿‡ç¨‹ä¸­è¿›è¡Œå †å‹ç¼©ã€æ ‡è®°å’Œæ•´ç†ï¼Œä»è€Œæ¶ˆé™¤äº†ç»å¤§éƒ¨åˆ†çš„æš‚åœæ—¶é—´ã€‚</p><p>Shenandoah å›¢é˜Ÿå¯¹å¤–å®£ç§° ShenandoahGC çš„æš‚åœæ—¶é—´ä¸å †å¤§å°æ— å…³ï¼Œæ— è®ºæ˜¯ 200MB è¿˜æ˜¯ 200 GBçš„å †å†…å­˜ï¼Œéƒ½å¯ä»¥ä¿éšœå…·æœ‰å¾ˆä½çš„æš‚åœæ—¶é—´ï¼ˆæ³¨æ„:å¹¶ä¸åƒ ZGC é‚£æ ·ä¿è¯æš‚åœæ—¶é—´åœ¨ 10ms ä»¥å†…ï¼‰ã€‚</p><h3 id="ShennandoahGC-ä¸å…¶ä»–-GC-çš„-STW-æ¯”è¾ƒGC-æ€»ç»“"><a href="#ShennandoahGC-ä¸å…¶ä»–-GC-çš„-STW-æ¯”è¾ƒGC-æ€»ç»“" class="headerlink" title="ShennandoahGC ä¸å…¶ä»– GC çš„ STW æ¯”è¾ƒGC æ€»ç»“"></a><strong>ShennandoahGC ä¸å…¶ä»– GC çš„ STW æ¯”è¾ƒGC æ€»ç»“</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210221225454.png" alt="image-20210221225454704"></p><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¸€å…±äº†è§£äº† Java ç›®å‰æ”¯æŒçš„æ‰€æœ‰ GC ç®—æ³•ï¼Œä¸€å…±æœ‰ 7 ç±»:</p><ol><li>ä¸²è¡Œ GCï¼ˆSerial GCï¼‰: å•çº¿ç¨‹æ‰§è¡Œï¼Œåº”ç”¨éœ€è¦æš‚åœï¼›</li><li>å¹¶è¡Œ GCï¼ˆParNewã€Parallel Scavengeã€Parallel Oldï¼‰: å¤šçº¿ç¨‹å¹¶è¡Œåœ°æ‰§è¡Œåƒåœ¾å›æ”¶ï¼Œ</li></ol><p>å…³æ³¨ä¸é«˜ååï¼›</p><ol><li>CMSï¼ˆConcurrent Mark-Sweepï¼‰: å¤šçº¿ç¨‹å¹¶å‘æ ‡è®°å’Œæ¸…é™¤ï¼Œå…³æ³¨ä¸é™ä½å»¶è¿Ÿï¼›</li><li>G1ï¼ˆG Firstï¼‰: é€šè¿‡åˆ’åˆ†å¤šä¸ªå†…å­˜åŒºåŸŸåšå¢é‡æ•´ç†å’Œå›æ”¶ï¼Œè¿›ä¸€æ­¥é™ä½å»¶è¿Ÿï¼›</li><li>ZGCï¼ˆZ Garbage Collectorï¼‰: é€šè¿‡ç€è‰²æŒ‡é’ˆå’Œè¯»å±éšœï¼Œå®ç°å‡ ä¹å…¨éƒ¨çš„å¹¶å‘æ‰§è¡Œï¼Œå‡ æ¯«</li></ol><p>ç§’çº§åˆ«çš„å»¶è¿Ÿï¼Œçº¿æ€§å¯æ‰©å±•ï¼›</p><ol><li>Epsilon: å®éªŒæ€§çš„ GCï¼Œä¾›æ€§èƒ½åˆ†æä½¿ç”¨ï¼›</li><li>Shenandoah: G1 çš„æ”¹è¿›ç‰ˆæœ¬ï¼Œè·Ÿ ZGC ç±»ä¼¼ã€‚</li></ol><h3 id="GC-æ€»ç»“"><a href="#GC-æ€»ç»“" class="headerlink" title="GC æ€»ç»“"></a><strong>GC æ€»ç»“</strong></h3><p>å¯ä»¥çœ‹å‡º GC ç®—æ³•å’Œå®ç°çš„æ¼”è¿›è·¯çº¿:</p><ol><li>ä¸²è¡Œ -&gt; å¹¶è¡Œ: é‡å¤åˆ©ç”¨å¤šæ ¸ CPU çš„ä¼˜åŠ¿ï¼Œå¤§å¹…é™ä½ GC æš‚åœæ—¶é—´ï¼Œæå‡ååé‡ã€‚</li><li>å¹¶è¡Œ -&gt; å¹¶å‘ï¼š ä¸åªå¼€å¤šä¸ª GC çº¿ç¨‹å¹¶è¡Œå›æ”¶ï¼Œè¿˜å°†GCæ“ä½œæ‹†åˆ†ä¸ºå¤šä¸ªæ­¥éª¤ï¼Œè®©å¾ˆå¤šç¹é‡çš„ä»»åŠ¡å’Œåº”ç”¨çº¿ç¨‹ä¸€èµ·å¹¶å‘æ‰§è¡Œï¼Œå‡å°‘äº†å•æ¬¡ GC æš‚åœæŒç»­çš„æ—¶é—´ï¼Œè¿™èƒ½æœ‰æ•ˆé™ä½ä¸šåŠ¡ç³»ç»Ÿçš„å»¶è¿Ÿã€‚</li><li>CMS -&gt; G1ï¼š G1 å¯ä»¥è¯´æ˜¯åœ¨ CMS åŸºç¡€ä¸Šè¿›è¡Œè¿­ä»£å’Œä¼˜åŒ–å¼€å‘å‡ºæ¥çš„ï¼Œåˆ’åˆ†ä¸ºå¤šä¸ªå°å †å—è¿›è¡Œå¢é‡å›æ”¶ï¼Œè¿™æ ·å°±æ›´è¿›ä¸€æ­¥åœ°é™ä½äº†å•æ¬¡ GC æš‚åœçš„æ—¶é—´</li><li>G1 -&gt; ZGC:ï¼šZGC å·ç§°æ— åœé¡¿åƒåœ¾æ”¶é›†å™¨ï¼Œè¿™åˆæ˜¯ä¸€æ¬¡æå¤§çš„æ”¹è¿›ã€‚ZGC å’Œ G1 æœ‰ä¸€äº›ç›¸ä¼¼çš„åœ°æ–¹ï¼Œä½†æ˜¯åº•å±‚çš„ç®—æ³•å’Œæ€æƒ³åˆæœ‰äº†å…¨æ–°çš„çªç ´ã€‚</li></ol><p>è„±ç¦»åœºæ™¯è°ˆæ€§èƒ½éƒ½æ˜¯è€æµæ°“â€ã€‚</p><p>ç›®å‰ç»å¤§éƒ¨åˆ† Java åº”ç”¨ç³»ç»Ÿï¼Œå †å†…å­˜å¹¶ä¸å¤§æ¯”å¦‚ 2G-4G ä»¥å†…ï¼Œè€Œä¸”å¯¹ 10ms è¿™ç§ä½å»¶è¿Ÿçš„ GC æš‚åœä¸æ•æ„Ÿï¼Œä¹Ÿå°±æ˜¯è¯´å¤„ç†ä¸€ä¸ªä¸šåŠ¡æ­¥éª¤ï¼Œå¤§æ¦‚å‡ ç™¾æ¯«ç§’éƒ½æ˜¯å¯ä»¥æ¥å—çš„ï¼ŒGC æš‚åœ 100ms è¿˜æ˜¯ 10ms æ²¡å¤šå¤§åŒºåˆ«ã€‚å¦ä¸€æ–¹é¢ï¼Œç³»ç»Ÿçš„ååé‡åè€Œå¾€å¾€æ˜¯æˆ‘ä»¬è¿½æ±‚çš„é‡ç‚¹ï¼Œè¿™æ—¶å€™å°±éœ€è¦è€ƒè™‘é‡‡ç”¨å¹¶è¡Œ GCã€‚å¦‚æœå †å†…å­˜å†å¤§ä¸€äº›ï¼Œå¯ä»¥è€ƒè™‘ G1 GCã€‚å¦‚æœå†…å­˜éå¸¸å¤§ï¼ˆæ¯”å¦‚è¶…è¿‡ 16Gï¼Œç”šè‡³æ˜¯ 64Gã€128Gï¼‰ï¼Œæˆ–è€…æ˜¯å¯¹å»¶è¿Ÿéå¸¸æ•æ„Ÿï¼ˆæ¯”å¦‚é«˜é¢‘é‡åŒ–äº¤æ˜“ç³»ç»Ÿï¼‰ï¼Œå°±éœ€è¦è€ƒè™‘ä½¿ç”¨æœ¬èŠ‚æåˆ°çš„æ–° GCï¼ˆZGC/Shenandoahï¼‰ã€‚</p><h2 id="7-æ€»ç»“å›é¡¾ä¸ä½œä¸šå®è·µ"><a href="#7-æ€»ç»“å›é¡¾ä¸ä½œä¸šå®è·µ" class="headerlink" title="7.æ€»ç»“å›é¡¾ä¸ä½œä¸šå®è·µ"></a>7.æ€»ç»“å›é¡¾ä¸ä½œä¸šå®è·µ</h2><h2 id="ç¬¬-2-è¯¾æ€»ç»“å›é¡¾"><a href="#ç¬¬-2-è¯¾æ€»ç»“å›é¡¾" class="headerlink" title="ç¬¬ 2 è¯¾æ€»ç»“å›é¡¾"></a><strong>ç¬¬ 2 è¯¾æ€»ç»“å›é¡¾</strong></h2><p>å·¥å…·æœ‰å“ªäº›ï¼Ÿ</p><p>GC æœ‰å“ªäº›ï¼Ÿ</p><p>éƒ½æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ</p><h2 id="ç¬¬-2-èŠ‚è¯¾ä½œä¸šå®è·µ"><a href="#ç¬¬-2-èŠ‚è¯¾ä½œä¸šå®è·µ" class="headerlink" title="ç¬¬ 2 èŠ‚è¯¾ä½œä¸šå®è·µ"></a><strong>ç¬¬ 2 èŠ‚è¯¾ä½œä¸šå®è·µ</strong></h2><p>1ã€æœ¬æœºä½¿ç”¨ G1 GC å¯åŠ¨ä¸€ä¸ªç¨‹åºï¼Œä»¿ç…§è¯¾ä¸Šæ¡ˆä¾‹åˆ†æä¸€ä¸‹ JVM æƒ…å†µ</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æå®¢æ—¶é—´ </tag>
            
            <tag> ç§¦é‡‘å« </tag>
            
            <tag> æå®¢å¤§å­¦ </tag>
            
            <tag> Java è¿›é˜¶è®­ç»ƒè¥ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java1æœŸç¬¬ä¸€è¯¾è¡¥å……ç¬”è®°</title>
      <link href="2021/02/19/java%E8%BF%9B%E9%98%B6%E8%AE%AD%E7%BB%83%E8%90%A5/Java1%E6%9C%9F%E7%AC%AC%E4%B8%80%E8%AF%BE%E8%A1%A5%E5%85%85%E7%AC%94%E8%AE%B0/"/>
      <url>2021/02/19/java%E8%BF%9B%E9%98%B6%E8%AE%AD%E7%BB%83%E8%90%A5/Java1%E6%9C%9F%E7%AC%AC%E4%B8%80%E8%AF%BE%E8%A1%A5%E5%85%85%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><p>å­¦ä¹ ç†è®ºè¯´ï¼Œä»…ä»…å¬è®²åªèƒ½è·å¾—çŸ¥è¯†çš„5-10%ï¼Œåªæœ‰ç»è¿‡å®è·µå’Œæ€è€ƒï¼Œæ‰èƒ½å˜æˆä½ çš„ç»éªŒã€‚</p><p>1ï¼‰ä¸€å®šè¦çœ‹é¢„ä¹ ææ–™ï¼Œé‚£æ˜¯æˆ‘å’Œé“é”šè€å¸ˆçš„jvmä¹¦ç¨¿çš„ä¸€éƒ¨åˆ†ï¼Œå¾ˆè¯¦ç»†ã€‚</p><p>2ï¼‰è¯¾ä¸Šçš„ä¸¤ä¸ªå°æ—¶æ˜¯å¸®å¤§å®¶ç»„ç»‡èµ·æŠ€æœ¯ä½“ç³»ï¼Œå¸¦å¤§å®¶æ“ä½œæ¼”ç¤ºã€‚</p><p>3ï¼‰è¯¾ååŠ¨æ‰‹å®è·µï¼ŒæŒ‰è¯¾ä¸Šçš„æ¼”ç»ƒè‡ªå·±æ˜¯å®éªŒï¼Œæœ€åå®Œæˆå¿…åšä½œä¸šã€‚</p><h2 id="1ã€å­—èŠ‚ç "><a href="#1ã€å­—èŠ‚ç " class="headerlink" title="1ã€å­—èŠ‚ç "></a>1ã€å­—èŠ‚ç </h2><p>å­—èŠ‚ç çš„æœ¬è´¨æ˜¯javaä»£ç ç¼–è¯‘åçš„ï¼Œç»™jvmè™šæ‹Ÿæœºè¿è¡Œçš„æ“ä½œæŒ‡ä»¤ã€‚</p><h3 id="å­¦ä¹ ç›®æ ‡"><a href="#å­¦ä¹ ç›®æ ‡" class="headerlink" title="å­¦ä¹ ç›®æ ‡"></a>å­¦ä¹ ç›®æ ‡</h3><p>å­—èŠ‚ç ä¸éœ€è¦å…¨éƒ¨æŒæ¡ï¼Œå¤§å®¶æ˜ç™½åŸç†å°±å¥½ï¼Œé¢è¯•ä¸€èˆ¬é—®çš„ä¹Ÿä¸ä¼šå¤ªå¤šã€‚</p><p>æ¯”å¦‚ 0: new #2</p><p>è¡¨ç¤ºçš„æ˜¯æœ¬å—ä»£ç çš„ç¬¬ä¸€ä¸ªæŒ‡ä»¤æ˜¯new ä¸€ä¸ªå¸¸é‡æ± é‡Œçš„ç¬¬äºŒä¸ªå¸¸é‡ä»£è¡¨çš„ç±»å‹çš„å®ä¾‹ã€‚</p><p>å…¶ä¸­newçš„æ“ä½œç äºŒè¿›åˆ¶æ˜¯bbï¼Œæ“ä½œæ•°æ˜¯2ï¼Œé‚£ä¹ˆç”¨äºŒè¿›åˆ¶è¡¨ç¤ºè¿™æ¡æŒ‡ä»¤å°±æ˜¯3ä¸ªå­—èŠ‚ï¼šbb 00 02ï¼Œè¡¥ä¸Šä¸€ä¸ª00æ˜¯å› ä¸ºnewåé¢è·Ÿä¸¤ä¸ªæ“ä½œæ•°ã€‚ï¼ˆå¤§å®¶æƒ³æƒ³ä¸ºä»€ä¹ˆéœ€è¦2ä¸ªæ“ä½œæ•°ï¼Ÿ ï¼‰</p><h3 id="å­¦ä»¥è‡´ç”¨"><a href="#å­¦ä»¥è‡´ç”¨" class="headerlink" title="å­¦ä»¥è‡´ç”¨"></a>å­¦ä»¥è‡´ç”¨</h3><p>äº†è§£å­—èŠ‚ç æœ‰ä¸¤ä¸ªç”¨é€”ï¼š</p><p>1ï¼‰èƒ½å¤Ÿäº†è§£åº•å±‚jvmæ‰§è¡Œçš„æ˜¯ä»€ä¹ˆï¼Œå¯ä»¥ç”¨æ¥åˆ†æä¸åŒä»£ç æ˜¯å¦æ˜¯ç­‰ä»·çš„ï¼Œå¦‚æœä¸ç­‰ä»·å“ªä¸ªæ–¹å¼æ›´å¥½ã€‚</p><p>æ¯”å¦‚forå¾ªç¯é‡Œç”¨i++è¿˜æ˜¯for(i:æ•°ç»„) ã€‚é€šè¿‡è¯¾ä¸Šçš„æ¼”ç¤ºï¼Œæˆ‘ä»¬çŸ¥é“ä»–ä»¬æ˜¯ç­‰ä»·çš„ã€‚ï¼ˆå¤§å®¶æƒ³æƒ³ï¼Œå¦‚æœfor : é‡Œä¸æ˜¯æ•°ç»„ï¼Œè€Œæ˜¯listï¼Œå­—èŠ‚ç ä¼šæ€ä¹ˆæ ·ï¼Ÿï¼‰</p><p>æ¯”å¦‚String a = â€œaâ€ + â€œbâ€; String c = a + â€œcâ€; é€šè¿‡å­—èŠ‚ç åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“ï¼š</p><p>ç¼–è¯‘åâ€aâ€ + â€œbâ€ç›´æ¥å˜æˆäº†â€œabâ€ï¼Œç›¸å½“äº a =â€œabâ€ï¼›</p><p>å­—ç¬¦ä¸²Stringä½œä¸ºä¸€ä¸ªç±»ï¼Œæ˜¯ä¸èƒ½åš+æ“ä½œçš„ï¼Œæ‰€ä»¥åœ¨å­—èŠ‚ç å±‚é¢ï¼Œéƒ½è½¬æ¢æˆäº†StringBuilderçš„appendæ“ä½œï¼Œä¸Šé¢çš„ä»£ç ç›¸å½“äºString c = new StringBuilder().append(â€œabâ€).append(â€œcâ€).toString(); </p><p>2ï¼‰åé¢å­¦ä¹ AOPçš„æ—¶å€™ï¼Œæœ‰ä¸€å¤§å—æ˜¯å­—èŠ‚ç æ“ä½œå’Œå¢å¼ºï¼Œè¿™é‡Œçš„å†…å®¹æ˜¯é‚£ä¸€éƒ¨åˆ†çš„åŸºç¡€ã€‚</p><h2 id="2ã€ç±»åŠ è½½å™¨ï¼ˆâ˜†é‡ç‚¹ï¼‰"><a href="#2ã€ç±»åŠ è½½å™¨ï¼ˆâ˜†é‡ç‚¹ï¼‰" class="headerlink" title="2ã€ç±»åŠ è½½å™¨ï¼ˆâ˜†é‡ç‚¹ï¼‰"></a>2ã€ç±»åŠ è½½å™¨ï¼ˆâ˜†é‡ç‚¹ï¼‰</h2><p>ç±»åŠ è½½å™¨è´Ÿè´£æŠŠå­—èŠ‚ç æ–‡ä»¶æˆ–å­—èŠ‚ç çš„byte[]è½¬æ¢æˆä¸ºjvmä¸­çš„ç±»ã€‚</p><h3 id="å­¦ä¹ ç›®æ ‡-1"><a href="#å­¦ä¹ ç›®æ ‡-1" class="headerlink" title="å­¦ä¹ ç›®æ ‡"></a>å­¦ä¹ ç›®æ ‡</h3><p>ç†è§£ç±»åŠ è½½å™¨çš„åŸç†å’Œä½œç”¨ï¼ŒåŠ è½½æ—¶æœºï¼Œä¸‰ç±»ç±»åŠ è½½å™¨ã€‚</p><p>ä¸‰ä¸ªç‰¹æ€§ï¼šåŒäº²å§”æ‰˜ï¼ŒåŠ è½½ä¾èµ–ï¼Œç±»å‹ç¼“å­˜ã€‚</p><p>çŸ¥é“å¦‚ä½•ç»™é¡¹ç›®ç¨‹åºæ·»åŠ ä¾èµ–çš„jaræˆ–è·¯å¾„ã€‚</p><p>äº†è§£URLClassLoaderçš„ä½œç”¨å’Œè·Ÿæ‰©å±•ç±»åŠ è½½å™¨ã€åº”ç”¨ç±»åŠ è½½å™¨çš„å…³ç³»ã€‚</p><p>å­¦ä¼šè‡ªå®šä¹‰ç®€å•çš„classloaderã€‚</p><h3 id="å­¦ä»¥è‡´ç”¨-1"><a href="#å­¦ä»¥è‡´ç”¨-1" class="headerlink" title="å­¦ä»¥è‡´ç”¨"></a>å­¦ä»¥è‡´ç”¨</h3><p>æ³¨æ„ï¼šJDK9é‡Œæ‰©å±•ç±»åŠ è½½å™¨å’Œåº”ç”¨ç±»åŠ è½½å™¨ï¼Œä¸å†ç»§æ‰¿URLClassLoaderã€‚</p><p>ä½†æ˜¯å¯ä»¥è¿™äº›ä¸»åŠ¨åŠ è½½ï¼š Class.forName(â€œxxxâ€, new URLClassloader(â€œddddâ€));</p><p>äº†è§£ç±»åŠ è½½å™¨æœ‰å‡ ä¸ªç”¨é€”ï¼š</p><p>1ï¼‰èƒ½å¤Ÿæ¸…æ¥šçŸ¥é“å­—èŠ‚ç æ˜¯å¦‚ä½•åŠ è½½çš„ï¼›</p><p>2ï¼‰èƒ½å¤Ÿåˆ†æç¨‹åºåŠ è½½äº†é‚£äº›jaræˆ–è·¯å¾„ï¼Œä»è€Œæ’æŸ¥æ‰¾ä¸åˆ°ç±»çš„é”™è¯¯é—®é¢˜ï¼›å¦‚æœé‡åˆ°äº†æ‰¾ä¸åˆ°æ–¹æ³•æˆ–æ–¹æ³•å‚æ•°ä¸åŒ¹é…çš„é”™è¯¯é—®é¢˜ï¼Œè¯´æ˜åŠ è½½äº†é”™è¯¯ç‰ˆæœ¬çš„jarï¼Œä¹Ÿå¯ä»¥ç”¨ç›¸åŒæ–¹æ³•æ’æŸ¥ï¼›</p><p>3ï¼‰å¯ä»¥å®ç°è‡ªå®šä¹‰classloaderï¼ŒåšåŠ å¯†ã€æ··æ·†ç­‰ï¼Œä¿æŠ¤æˆ‘ä»¬çš„jaråŒ…ä¸è¢«åç¼–è¯‘å’Œç ´è§£ï¼›å®é™…ä¸Šé€šè¿‡è‡ªå®šä¹‰classloaderï¼Œæˆ‘ä»¬åœ¨ç±»åŠ è½½åˆ°jvmçš„æ—¶å€™å¯ä»¥åšä¸€äº›é¢å¤–çš„å¤„ç†ï¼ˆæƒ³æƒ³æ˜¯ä¸æ˜¯è·ŸAOPæœ‰ç‚¹åƒï¼Ÿï¼‰ï¼›</p><p>4ï¼‰æ—©æœŸå®ç°åŠ¨æ€åŠ è½½ï¼Œæ¨¡å—åŒ–éƒ½æ˜¯åŸºäºè‡ªå®šä¹‰classloaderçš„ï¼Œå¦‚æœæˆ‘ä»¬å®ç°ä¸¤ä¸ªè‡ªå®šä¹‰classloaderï¼Œæ¯”å¦‚Aå’ŒBï¼Œä»–ä»¬æ²¡æœ‰å…³ç³»ï¼Œä¸”å„è‡ªåŠ è½½äº†ä¸€ä¸ªå«Helloçš„ç±»ï¼Œè¿™ä¸¤ä¸ªHelloçš„ç±»å‹æ˜¯ä¸åŒçš„ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°ä¸åŒç‰ˆæœ¬çš„ç±»éš”ç¦»ï¼ˆå¦‚æœä»£ç å†™çš„ä¸æ°å½“ï¼Œä¹Ÿå¯èƒ½ä¼šå‡ºç°æ‰€è°“Açš„ä¸€ä¸ªHelloç±»çš„å®ä¾‹ï¼Œè¿è¡Œæ—¶åšç±»å‹è½¬æ¢æ— æ³•è½¬æ¢æˆBçš„Helloç±»å‹çš„é”™è¯¯ï¼‰ï¼›</p><p>5ï¼‰ä½œä¸šå¿…åšé¢˜ä¸æ­¤ç›¸å…³ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šjdkä»£ç é‡Œå†™æ­»äº†ï¼Œä¸å…è®¸è‡ªå®šä¹‰classloaderåŠ è½½ä»¥java.å¼€å¤´åŒ…åçš„ç±»ã€‚</p><h2 id="3ã€Javaå†…å­˜æ¨¡å‹ï¼ˆâ˜†é‡ç‚¹ï¼‰"><a href="#3ã€Javaå†…å­˜æ¨¡å‹ï¼ˆâ˜†é‡ç‚¹ï¼‰" class="headerlink" title="3ã€Javaå†…å­˜æ¨¡å‹ï¼ˆâ˜†é‡ç‚¹ï¼‰"></a>3ã€Javaå†…å­˜æ¨¡å‹ï¼ˆâ˜†é‡ç‚¹ï¼‰</h2><p>ç±»è¢«åŠ è½½åˆ°JVMä¸­ï¼Œä»£ç è¿è¡Œæ—¶éƒ½éœ€è¦ä½¿ç”¨å†…å­˜ï¼Œæ‰€ä»¥Javaå†…å­˜æ¨¡å‹å°±æ˜¯ç”¨æ¥è§„å®šJVMå†…éƒ¨çš„å†…å­˜ç»“æ„ã€‚</p><h3 id="å­¦ä¹ ç›®æ ‡-2"><a href="#å­¦ä¹ ç›®æ ‡-2" class="headerlink" title="å­¦ä¹ ç›®æ ‡"></a>å­¦ä¹ ç›®æ ‡</h3><p>äº†è§£æ ˆã€å †ã€éå †ã€å †å¤–ç­‰å†…å­˜ï¼Œä»¥åŠå®ƒä»¬çš„å…³ç³»å’ŒåŒºåˆ«ã€‚</p><p>äº†è§£æ ˆçš„ç»“æ„ï¼Œå¯ä»¥è·Ÿå‰é¢å­—èŠ‚ç æ‰§è¡Œå¯¹åº”èµ·æ¥ã€‚</p><p>äº†è§£å †çš„ç»“æ„ï¼Œæ–°ç”Ÿä»£young genï¼Œè€å¹´ä»£old genï¼Œæ–°ç”Ÿä»£åˆåŒ…æ‹¬edenå’Œs0ã€s1</p><p>äº†è§£éå †å’Œå †å¤–æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„ã€‚</p><h3 id="å­¦ä»¥è‡´ç”¨-2"><a href="#å­¦ä»¥è‡´ç”¨-2" class="headerlink" title="å­¦ä»¥è‡´ç”¨"></a>å­¦ä»¥è‡´ç”¨</h3><p>äº†è§£å†…å­˜æ¨¡å‹æœ‰å‡ ä¸ªç”¨é€”ï¼š</p><p>1ï¼‰è¿™ä¸€å—æ˜¯ä¸‹ä¸€èŠ‚è¯¾è®²çš„GCçš„åŸºç¡€ï¼Œä¹Ÿæ˜¯ç¬¬ä¸‰ä¸ªæ¨¡å—è®²å¹¶å‘ç¼–ç¨‹çš„åŸºç¡€ï¼Œè¿™ä¸€å—ç†Ÿæ‚‰äº†æœ‰åˆ©äºå­¦ä¹ GCå’Œå¹¶å‘ï¼›</p><p>2ï¼‰é¢è¯•ç»å¸¸ä¼šè¢«é—®åˆ°è¿™ä¸ªé—®é¢˜ï¼›</p><p>3ï¼‰ä½œä¸šå¿…åšé¢˜ä¸è¿™ä¸€å—æœ‰ç›´æ¥å…³ç³»ï¼Œå¤šåŠ¨æ‰‹ç”»ä¸€ç”»ï¼Œæœ‰åŠ©äºé¢è¯•æ—¶èƒ½æ¯”è¾ƒå¥½çš„è®²æ¸…æ¥šã€‚</p><h2 id="4ã€å‘½ä»¤è¡Œå‚æ•°"><a href="#4ã€å‘½ä»¤è¡Œå‚æ•°" class="headerlink" title="4ã€å‘½ä»¤è¡Œå‚æ•°"></a>4ã€å‘½ä»¤è¡Œå‚æ•°</h2><p>JVMä½œä¸ºä¸€ä¸ªé€šç”¨çš„è™šæ‹Ÿè®¡ç®—æœºï¼Œæ˜¯é€šè¿‡javaå‘½ä»¤æ¥å¯åŠ¨çš„ï¼Œä¸ºäº†è®©JVMèƒ½å¤Ÿé€‚åº”ä¸åŒçš„éœ€æ±‚ç¯å¢ƒï¼Œæ‰€ä»¥éœ€è¦é…ç½®ä¸åŒçš„å‚æ•°ä½¿JVMæ›´å¥½çš„å·¥ä½œï¼Œè¿™å°±æ˜¯javaå‘½ä»¤æ‰§è¡Œçš„å‘½ä»¤è¡Œå‚æ•°ã€‚</p><h3 id="å­¦ä¹ ç›®æ ‡-3"><a href="#å­¦ä¹ ç›®æ ‡-3" class="headerlink" title="å­¦ä¹ ç›®æ ‡"></a>å­¦ä¹ ç›®æ ‡</h3><p>å¸¸ç”¨çš„å‘½ä»¤è¡Œå‚æ•°æœ‰å“ªäº›ï¼Ÿ</p><p>æ ‡å‡†å‚æ•° -server</p><p>éæ ‡å‡†å‚æ•° -Xmxï¼Œ-XXï¼šxxxx=yyyy</p><p>ç³»ç»Ÿå±æ€§-Dxxx=yyy</p><h3 id="å­¦ä»¥è‡´ç”¨-3"><a href="#å­¦ä»¥è‡´ç”¨-3" class="headerlink" title="å­¦ä»¥è‡´ç”¨"></a>å­¦ä»¥è‡´ç”¨</h3><p>jvmå†…å­˜é…ç½®ç»éªŒï¼šxmx ~ ä¸è¦è¶…è¿‡ç³»ç»Ÿå¯ç”¨å†…å­˜çš„60-80%</p><p>ä¾‹å¦‚ ç³»ç»Ÿæœ‰4gå¯ç”¨å†…å­˜ -&gt; 4g*0.6<del>0.8 -&gt; å¯ä»¥è®¾ç½®xmxä¸º2.4</del>3.2g</p><p>javaå‚æ•°ç›®å‰æœ‰1000å¤šä¸ªï¼Œå…¶ä¸­GCç›¸å…³çš„å ä¸€å¤§åŠã€‚å…·ä½“å‚æ•°ç›¸å…³çš„ä¸€äº›é—®é¢˜ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾ç»§ç»­è®²ã€‚</p><h2 id="5ã€è¯¾å ‚ç­”ç–‘"><a href="#5ã€è¯¾å ‚ç­”ç–‘" class="headerlink" title="5ã€è¯¾å ‚ç­”ç–‘"></a>5ã€è¯¾å ‚ç­”ç–‘</h2><p>å…¶ä»–çš„é—®é¢˜æ•´ç†ä¸å›ç­”ï¼š</p><p><a href="https://shimo.im/docs/rcxYt6PtQgkkyd8h">https://shimo.im/docs/rcxYt6PtQgkkyd8h</a></p><h2 id="6ã€å…¶ä»–èµ„æ–™"><a href="#6ã€å…¶ä»–èµ„æ–™" class="headerlink" title="6ã€å…¶ä»–èµ„æ–™"></a>6ã€å…¶ä»–èµ„æ–™</h2><p>å®˜æ–¹å¯¹JDK/JREã€classloaderå’Œä¸€äº›å·¥å…·çš„è¯´æ˜ï¼š<a href="https://docs.oracle.com/javase/8/docs/technotes/tools/windows/toc.html">https://docs.oracle.com/javase/8/docs/technotes/tools/windows/toc.html</a></p><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210219092358.png!thumbnail" alt="img"></p><p>ä¸Šå›¾æ¥æºäºï¼š<a href="https://docs.oracle.com/javase/8/docs/">https://docs.oracle.com/javase/8/docs/</a></p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æå®¢æ—¶é—´ </tag>
            
            <tag> ç§¦é‡‘å« </tag>
            
            <tag> æå®¢å¤§å­¦ </tag>
            
            <tag> Java è¿›é˜¶è®­ç»ƒè¥ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Week01-01 JVM æ ¸å¿ƒæŠ€æœ¯--åŸºç¡€çŸ¥è¯†</title>
      <link href="2021/02/18/java%E8%BF%9B%E9%98%B6%E8%AE%AD%E7%BB%83%E8%90%A5/Week01-01-JVM-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
      <url>2021/02/18/java%E8%BF%9B%E9%98%B6%E8%AE%AD%E7%BB%83%E8%90%A5/Week01-01-JVM-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/</url>
      
        <content type="html"><![CDATA[<h1 id="ç¬¬1è¯¾-JVM-æ ¸å¿ƒæŠ€æœ¯â€“åŸºç¡€çŸ¥è¯†"><a href="#ç¬¬1è¯¾-JVM-æ ¸å¿ƒæŠ€æœ¯â€“åŸºç¡€çŸ¥è¯†" class="headerlink" title="ç¬¬1è¯¾  JVM æ ¸å¿ƒæŠ€æœ¯â€“åŸºç¡€çŸ¥è¯†"></a>ç¬¬1è¯¾  JVM æ ¸å¿ƒæŠ€æœ¯â€“åŸºç¡€çŸ¥è¯†</h1><p><strong>ç›®å½•</strong></p><ol><li>JVM åŸºç¡€çŸ¥è¯†ï¼šä¸ç§¯è·¬æ­¥ï¼Œæ— ä»¥è‡³åƒé‡Œ</li><li>Java å­—èŠ‚ç æŠ€æœ¯ï¼šä¸ç§¯ç»†æµï¼Œæ— ä»¥æˆæ±Ÿæ²³</li><li>JVM ç±»åŠ è½½å™¨*ï¼šå±±ä¸è¾åœŸï¼Œæ•…èƒ½æˆå…¶é«˜</li><li>JVM å†…å­˜æ¨¡å‹*ï¼šæµ·ä¸è¾æ°´ï¼Œæ•…èƒ½æˆå…¶æ·±</li><li>JVM å¯åŠ¨å‚æ•°ï¼šåšè§‚è€Œçº¦å–ã€åšç§¯è€Œè–„å‘</li><li>ç¬¬1è¯¾æ€»ç»“å›é¡¾ä¸ä½œä¸šå®è·µ</li></ol><h2 id="1-JVM-æ ¸å¿ƒæŠ€æœ¯â€“åŸºç¡€çŸ¥è¯†"><a href="#1-JVM-æ ¸å¿ƒæŠ€æœ¯â€“åŸºç¡€çŸ¥è¯†" class="headerlink" title="1. JVM æ ¸å¿ƒæŠ€æœ¯â€“åŸºç¡€çŸ¥è¯†"></a>1. JVM æ ¸å¿ƒæŠ€æœ¯â€“åŸºç¡€çŸ¥è¯†</h2><h3 id="ç¼–ç¨‹è¯­è¨€"><a href="#ç¼–ç¨‹è¯­è¨€" class="headerlink" title="ç¼–ç¨‹è¯­è¨€"></a><strong>ç¼–ç¨‹è¯­è¨€</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210218232956.png" alt="image-20210218232956278"></p><p>é¢å‘è¿‡ç¨‹ã€é¢å‘å¯¹è±¡ã€é¢å‘å‡½æ•°</p><p>é™æ€ç±»å‹ã€åŠ¨æ€ç±»å‹</p><p>ç¼–è¯‘æ‰§è¡Œã€è§£é‡Šæ‰§è¡Œ</p><p>æœ‰è™šæ‹Ÿæœºã€æ— è™šæ‹Ÿæœº</p><p>æœ‰ GCã€æ—  GC</p><p>Java æ˜¯ä¸€ç§é¢å‘å¯¹è±¡ã€é™æ€ç±»å‹ã€ç¼–è¯‘æ‰§è¡Œï¼Œ</p><p>æœ‰ VM/GC å’Œè¿è¡Œæ—¶ã€è·¨å¹³å°çš„é«˜çº§è¯­è¨€ã€‚</p><h3 id="ç¼–ç¨‹è¯­è¨€è·¨å¹³å°"><a href="#ç¼–ç¨‹è¯­è¨€è·¨å¹³å°" class="headerlink" title="ç¼–ç¨‹è¯­è¨€è·¨å¹³å°"></a><strong>ç¼–ç¨‹è¯­è¨€è·¨å¹³å°</strong></h3><p><strong>æºä»£ç è·¨å¹³å°</strong></p><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210218233210.png" alt="image-20210218233210633"></p><p><strong>äºŒè¿›åˆ¶è·¨å¹³å°</strong></p><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210218233411.png" alt="image-20210218233411294"></p><p><strong>Javaã€C++ã€Rust çš„åŒºåˆ«</strong></p><p><strong>C/C++</strong> å®Œå…¨ç›¸ä¿¡è€Œä¸”æƒ¯ç€ç¨‹åºå‘˜ï¼Œè®©å¤§å®¶è‡ªè¡Œç®¡ç†å†…å­˜ï¼Œå¯ä»¥ç¼–å†™å¾ˆè‡ªç”±çš„ä»£ç ï¼Œä½†ä¸€ä¸å°å¿ƒå°±ä¼šé€ æˆå†…å­˜æ³„æ¼ç­‰é—®é¢˜ï¼Œå¯¼è‡´ç¨‹åºå´©æºƒã€‚</p><p><strong>Java/Golang</strong> å®Œå…¨ä¸ç›¸ä¿¡ç¨‹åºå‘˜ï¼Œä½†ä¹Ÿæƒ¯ç€ç¨‹åºå‘˜ã€‚æ‰€æœ‰çš„å†…å­˜ç”Ÿå‘½å‘¨æœŸéƒ½ç”± JVM è¿è¡Œæ—¶ç»Ÿä¸€ç®¡ç†ã€‚ åœ¨ç»å¤§éƒ¨åˆ†åœºæ™¯ä¸‹ï¼Œä½ å¯ä»¥éå¸¸è‡ªç”±çš„å†™ä»£ç ï¼Œè€Œä¸”ä¸ç”¨å…³å¿ƒå†…å­˜åˆ°åº•æ˜¯ä»€ä¹ˆæƒ…å†µã€‚ å†…å­˜ä½¿ç”¨æœ‰é—®é¢˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ JVM æ¥è¿›è¡Œä¿¡æ¯ç›¸å…³çš„åˆ†æè¯Šæ–­å’Œè°ƒæ•´ã€‚ è¿™ä¹Ÿæ˜¯æœ¬è¯¾ç¨‹çš„ç›®æ ‡ã€‚</p><p><strong>Rust</strong> è¯­è¨€é€‰æ‹©æ—¢ä¸ç›¸ä¿¡ç¨‹åºå‘˜ï¼Œä¹Ÿä¸æƒ¯ç€ç¨‹åºå‘˜ã€‚ è®©ä½ åœ¨å†™ä»£ç çš„æ—¶å€™ï¼Œå¿…é¡»æ¸…æ¥šæ˜ç™½çš„ç”¨ Rust çš„è§„åˆ™ç®¡ç†å¥½ä½ çš„å˜é‡ï¼Œå¥½è®©æœºå™¨èƒ½æ˜ç™½é«˜æ•ˆåœ°åˆ†æå’Œç®¡ç†å†…å­˜ã€‚ ä½†æ˜¯è¿™æ ·ä¼šå¯¼è‡´ä»£ç ä¸åˆ©äºäººçš„ç†è§£ï¼Œå†™ä»£ç å¾ˆä¸è‡ªç”±ï¼Œå­¦ä¹ æˆæœ¬ä¹Ÿå¾ˆé«˜ã€‚</p><h3 id="å­—èŠ‚ç ã€ç±»åŠ è½½å™¨ã€è™šæ‹Ÿæœº"><a href="#å­—èŠ‚ç ã€ç±»åŠ è½½å™¨ã€è™šæ‹Ÿæœº" class="headerlink" title="å­—èŠ‚ç ã€ç±»åŠ è½½å™¨ã€è™šæ‹Ÿæœº"></a><strong>å­—èŠ‚ç ã€ç±»åŠ è½½å™¨ã€è™šæ‹Ÿæœº</strong></h3><p>![image-20210218233626837](/Users/cutie/Library/Application Support/typora-user-images/image-20210218233626837.png)</p><h2 id="2-Java-å­—èŠ‚ç æŠ€æœ¯"><a href="#2-Java-å­—èŠ‚ç æŠ€æœ¯" class="headerlink" title="2. Java å­—èŠ‚ç æŠ€æœ¯"></a>2. Java å­—èŠ‚ç æŠ€æœ¯</h2><h3 id="ä»€ä¹ˆæ˜¯å­—èŠ‚ç ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å­—èŠ‚ç ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å­—èŠ‚ç ï¼Ÿ"></a><strong>ä»€ä¹ˆæ˜¯å­—èŠ‚ç ï¼Ÿ</strong></h3><p>Java bytecode ç”±å•å­—èŠ‚ï¼ˆbyteï¼‰çš„æŒ‡ä»¤ç»„æˆï¼Œç†è®ºä¸Šæœ€å¤šæ”¯æŒ 256 ä¸ªæ“ä½œç ï¼ˆopcodeï¼‰ã€‚</p><p>å®é™…ä¸Š Java åªä½¿ç”¨äº†200å·¦å³çš„æ“ä½œç ï¼Œ è¿˜æœ‰ä¸€äº›æ“ä½œç åˆ™ä¿ç•™ç»™è°ƒè¯•æ“ä½œã€‚</p><p>æ ¹æ®æŒ‡ä»¤çš„æ€§è´¨ï¼Œä¸»è¦åˆ†ä¸ºå››ä¸ªå¤§ç±»ï¼š</p><ol><li>æ ˆæ“ä½œæŒ‡ä»¤ï¼ŒåŒ…æ‹¬ä¸å±€éƒ¨å˜é‡äº¤äº’çš„æŒ‡ä»¤</li><li>ç¨‹åºæµç¨‹æ§åˆ¶æŒ‡ä»¤</li><li>å¯¹è±¡æ“ä½œæŒ‡ä»¤ï¼ŒåŒ…æ‹¬æ–¹æ³•è°ƒç”¨æŒ‡ä»¤</li><li>ç®—æœ¯è¿ç®—ä»¥åŠç±»å‹è½¬æ¢æŒ‡ä»¤</li></ol><p>1ï¼Œjavaçš„æ‰€æœ‰çš„æ“ä½œéƒ½å‘ç”Ÿåœ¨æ ˆä¸Šï¼›æ˜¯ç”¨æ¥çœŸæ­£åšè®¡ç®—çš„</p><p>2ï¼Œ3ï¼Œ4éƒ½è·Ÿjavaè¯­æ³•ç›¸å…³çš„</p><h3 id="ç”Ÿæˆå­—èŠ‚ç "><a href="#ç”Ÿæˆå­—èŠ‚ç " class="headerlink" title="ç”Ÿæˆå­—èŠ‚ç "></a><strong>ç”Ÿæˆå­—èŠ‚ç </strong></h3><p>å‡å¦‚æœ‰ä¸€ä¸ªæœ€ç®€å•çš„ç±»ï¼Œæºä»£ç å¦‚ä¸‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210218234107.png" alt="image-20210218234107349"></p><p>ç¼–è¯‘ï¼šjavac demo/jvm0104/HelloByteCode.java</p><p>æŸ¥çœ‹å­—èŠ‚ç ï¼šjavap -c demo.jvm0104.HelloByteCode</p><h3 id="æœ€ç®€å•çš„å­—èŠ‚ç "><a href="#æœ€ç®€å•çš„å­—èŠ‚ç " class="headerlink" title="æœ€ç®€å•çš„å­—èŠ‚ç "></a><strong>æœ€ç®€å•çš„å­—èŠ‚ç </strong></h3><p>ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210218234121.png" alt="image-20210218234120981"></p><p>ä¸Šå›¾ä½¿ç”¨åŠ©è®°ç¬¦çš„æ–¹å¼å±•ç¤ºå‡ºæ¥çš„</p><p>aload_0 æ˜¯åŠ©è®°ç¬¦ï¼Œæ˜¯å­—èŠ‚ç é‡Œé¢çš„æ“ä½œç ã€‚æ ˆï¼Œæœ¬åœ°å˜é‡è¡¨ã€‚</p><p>è¿è¡Œæ—¶å€™ï¼Œå˜é‡æŒªåˆ°æ ˆä¸Šï¼Œè¿è¡Œç»“æŸåï¼Œæ”¾å›æœ¬åœ°å˜é‡è¡¨ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210218234217.png" alt="image-20210218234217321"></p><h3 id="å¤æ‚ç‚¹çš„ä¾‹å­"><a href="#å¤æ‚ç‚¹çš„ä¾‹å­" class="headerlink" title="å¤æ‚ç‚¹çš„ä¾‹å­"></a><strong>å¤æ‚ç‚¹çš„ä¾‹å­</strong></h3><p>è¿›ä¸€æ­¥ï¼šjavap -c -verbose demo.jvm0104.HelloByteCode</p><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210218234244.png" alt="image-20210218234244088"></p><p>52.0é»˜è®¤è¡¨ç¤ºjava8çš„ç‰ˆæœ¬ï¼Œæ¯ä¸Šä¸€ä¸ªå¤§ç‰ˆæœ¬ï¼Œéƒ½ä¼šåŠ 1</p><p>flagsè¡¨ç¤ºç±»æ˜¯publicè¿˜æ˜¯épublic</p><p>Constant poolï¼Œå¸¸é‡æ± </p><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210218234303.png" alt="image-20210218234303117"></p><h3 id="å­—èŠ‚ç çš„è¿è¡Œæ—¶ç»“æ„"><a href="#å­—èŠ‚ç çš„è¿è¡Œæ—¶ç»“æ„" class="headerlink" title="å­—èŠ‚ç çš„è¿è¡Œæ—¶ç»“æ„"></a><strong>å­—èŠ‚ç çš„è¿è¡Œæ—¶ç»“æ„</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210218234343.png" alt="image-20210218234343475"></p><p>JVM æ˜¯ä¸€å°åŸºäºæ ˆçš„è®¡ç®—æœºå™¨ã€‚</p><p>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç‹¬å±äºè‡ªå·±çš„çº¿ç¨‹æ ˆï¼ˆJVM Stackï¼‰ï¼Œç”¨äºå­˜å‚¨æ ˆå¸§ï¼ˆFrameï¼‰ã€‚</p><p>æ¯ä¸€æ¬¡æ–¹æ³•è°ƒç”¨ï¼ŒJVM éƒ½ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ ˆå¸§ã€‚</p><p>æ ˆå¸§ç”±æ“ä½œæ•°æ ˆï¼Œ å±€éƒ¨å˜é‡æ•°ç»„ä»¥åŠä¸€ä¸ª Class å¼•ç”¨ç»„æˆã€‚</p><p>Class å¼•ç”¨ æŒ‡å‘å½“å‰æ–¹æ³•åœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­å¯¹åº”çš„ Classã€‚</p><h3 id="ä»åŠ©è®°ç¬¦åˆ°äºŒè¿›åˆ¶"><a href="#ä»åŠ©è®°ç¬¦åˆ°äºŒè¿›åˆ¶" class="headerlink" title="ä»åŠ©è®°ç¬¦åˆ°äºŒè¿›åˆ¶"></a><strong>ä»åŠ©è®°ç¬¦åˆ°äºŒè¿›åˆ¶</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210218234358.png" alt="image-20210218234358007"></p><h3 id="å››åˆ™è¿è¡Œçš„ä¾‹å­"><a href="#å››åˆ™è¿è¡Œçš„ä¾‹å­" class="headerlink" title="å››åˆ™è¿è¡Œçš„ä¾‹å­"></a><strong>å››åˆ™è¿è¡Œçš„ä¾‹å­</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210218234411.png" alt="image-20210218234411785"></p><h3 id="æ•°å€¼å¤„ç†ä¸æœ¬åœ°å˜é‡è¡¨"><a href="#æ•°å€¼å¤„ç†ä¸æœ¬åœ°å˜é‡è¡¨" class="headerlink" title="æ•°å€¼å¤„ç†ä¸æœ¬åœ°å˜é‡è¡¨"></a><strong>æ•°å€¼å¤„ç†ä¸æœ¬åœ°å˜é‡è¡¨</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210218234433.png" alt="image-20210218234433598"></p><p>i intï¼Œ load åŠ è½½åˆ°æ ˆï¼Œstore æ”¾å›ï¼Œconstå¸¸é‡ï¼Œ dstore doubleç±»å‹çš„å­˜å‚¨</p><p>i2d integerè½¬æ¢ä¸ºdouble</p><h3 id="ç®—æ•°æ“ä½œä¸ç±»å‹è½¬æ¢"><a href="#ç®—æ•°æ“ä½œä¸ç±»å‹è½¬æ¢" class="headerlink" title="ç®—æ•°æ“ä½œä¸ç±»å‹è½¬æ¢"></a><strong>ç®—æ•°æ“ä½œä¸ç±»å‹è½¬æ¢</strong></h3><p>ç®—æ•°æ“ä½œä¸ç±»å‹è½¬æ¢</p><p>![image-20210218234443510](/Users/cutie/Library/Application Support/typora-user-images/image-20210218234443510.png)</p><p>byteï¼Œboolean ç”¨intï¼Œæ˜¯æœ€å°å•ä½ï¼Œ32ä½</p><p>intï¼ˆ32ä½ï¼‰å’Œlongï¼ˆ64ä½ï¼‰æ˜¯å¦æ˜¯åŸå­æ€§çš„ï¼Ÿ32ä½æœºå™¨å¤„ç†longéœ€è¦å¤„ç†2æ¬¡ï¼Œ64ä½åªè¦å¤„ç†ä¸€æ¬¡ï¼Œä¸»æµçš„éƒ½æ˜¯åŸå­æ“ä½œ</p><h3 id="ä¸€ä¸ªå®Œæ•´çš„å¾ªç¯æ§åˆ¶"><a href="#ä¸€ä¸ªå®Œæ•´çš„å¾ªç¯æ§åˆ¶" class="headerlink" title="ä¸€ä¸ªå®Œæ•´çš„å¾ªç¯æ§åˆ¶"></a><strong>ä¸€ä¸ªå®Œæ•´çš„å¾ªç¯æ§åˆ¶</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210218234507.png" alt="image-20210218234507284"></p><p>if_icmpge æ¯”è¾ƒå¤§å°ï¼Œå¦‚æœä¸ç¬¦åˆçš„è¯è·³è½¬åˆ°43ï¼Œiinc intç±»å‹çš„è‡ªå¢åŠ 1ï¼Œgoto è·‘åˆ°ç¬¬18ä¸ªæ ‡å·ï¼Œ</p><h3 id="æ–¹æ³•è°ƒç”¨çš„æŒ‡ä»¤"><a href="#æ–¹æ³•è°ƒç”¨çš„æŒ‡ä»¤" class="headerlink" title="æ–¹æ³•è°ƒç”¨çš„æŒ‡ä»¤"></a><strong>æ–¹æ³•è°ƒç”¨çš„æŒ‡ä»¤</strong></h3><p>æ–¹æ³•è°ƒç”¨çš„æŒ‡ä»¤ï¼š</p><p>invokestaticï¼Œé¡¾åæ€ä¹‰ï¼Œè¿™ä¸ªæŒ‡ä»¤ç”¨äºè°ƒç”¨æŸä¸ªç±»çš„é™æ€æ–¹æ³•ï¼Œè¿™æ˜¯æ–¹æ³•è°ƒç”¨æŒ‡ä»¤ä¸­æœ€å¿«çš„ä¸€ä¸ªã€‚</p><p>invokespecial, ç”¨æ¥è°ƒç”¨æ„é€ å‡½æ•°ï¼Œä½†ä¹Ÿå¯ä»¥ç”¨äºè°ƒç”¨åŒä¸€ä¸ªç±»ä¸­çš„ private æ–¹æ³•, ä»¥åŠå¯è§çš„è¶…ç±»æ–¹æ³•ã€‚</p><p>invokevirtualï¼Œå¦‚æœæ˜¯å…·ä½“ç±»å‹çš„ç›®æ ‡å¯¹è±¡ï¼Œinvokevirtual ç”¨äºè°ƒç”¨å…¬å…±ï¼Œå—ä¿æŠ¤å’Œpackage çº§çš„ç§æœ‰æ–¹æ³•ã€‚</p><p>invokeinterfaceï¼Œå½“é€šè¿‡æ¥å£å¼•ç”¨æ¥è°ƒç”¨æ–¹æ³•æ—¶ï¼Œå°†ä¼šç¼–è¯‘ä¸º invokeinterface æŒ‡ä»¤ã€‚</p><p>invokedynamicï¼ŒJDK7 æ–°å¢åŠ çš„æŒ‡ä»¤ï¼Œæ˜¯å®ç°â€œåŠ¨æ€ç±»å‹è¯­è¨€â€ï¼ˆDynamically TypedLanguageï¼‰æ”¯æŒè€Œè¿›è¡Œçš„å‡çº§æ”¹è¿›ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ JDK8 ä»¥åæ”¯æŒ lambda è¡¨è¾¾å¼çš„å®ç°åŸºç¡€ã€‚</p><p><strong>ä¸€ä¸ªåŠ¨æ€ä¾‹å­</strong></p><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210218234718.png" alt="image-20210218234718062"></p><h2 id="3-JVM-ç±»åŠ è½½å™¨"><a href="#3-JVM-ç±»åŠ è½½å™¨" class="headerlink" title="3. JVM ç±»åŠ è½½å™¨"></a>3. JVM ç±»åŠ è½½å™¨</h2><h3 id="ç±»çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#ç±»çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç±»çš„ç”Ÿå‘½å‘¨æœŸ"></a><strong>ç±»çš„ç”Ÿå‘½å‘¨æœŸ</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210218234745.png" alt="image-20210218234745547"></p><ol><li>åŠ è½½ï¼ˆLoadingï¼‰ï¼šæ‰¾ Class æ–‡ä»¶</li><li>éªŒè¯ï¼ˆVerificationï¼‰ï¼šéªŒè¯æ ¼å¼ã€ä¾èµ–</li><li>å‡†å¤‡ï¼ˆPreparationï¼‰ï¼šé™æ€å­—æ®µã€æ–¹æ³•è¡¨</li><li>è§£æï¼ˆResolutionï¼‰ï¼šç¬¦å·è§£æä¸ºå¼•ç”¨</li><li>åˆå§‹åŒ–ï¼ˆInitializationï¼‰ï¼šæ„é€ å™¨ã€é™æ€å˜é‡èµ‹å€¼ã€é™æ€ä»£ç å—</li><li>ä½¿ç”¨ï¼ˆUsingï¼‰</li><li>å¸è½½ï¼ˆUnloadingï¼‰</li></ol><h3 id="ç±»çš„åŠ è½½æ—¶æœº"><a href="#ç±»çš„åŠ è½½æ—¶æœº" class="headerlink" title="ç±»çš„åŠ è½½æ—¶æœº"></a><strong>ç±»çš„åŠ è½½æ—¶æœº</strong></h3><ol><li>å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œåˆå§‹åŒ–ç”¨æˆ·æŒ‡å®šçš„ä¸»ç±»ï¼Œå°±æ˜¯å¯åŠ¨æ‰§è¡Œçš„ main æ–¹æ³•æ‰€åœ¨çš„ç±»ï¼›</li><li>å½“é‡åˆ°ç”¨ä»¥æ–°å»ºç›®æ ‡ç±»å®ä¾‹çš„ new æŒ‡ä»¤æ—¶ï¼Œåˆå§‹åŒ– new æŒ‡ä»¤çš„ç›®æ ‡ç±»ï¼Œå°±æ˜¯ newä¸€ä¸ªç±»çš„æ—¶å€™è¦åˆå§‹åŒ–ï¼›</li><li>å½“é‡åˆ°è°ƒç”¨é™æ€æ–¹æ³•çš„æŒ‡ä»¤æ—¶ï¼Œåˆå§‹åŒ–è¯¥é™æ€æ–¹æ³•æ‰€åœ¨çš„ç±»ï¼›</li><li>å½“é‡åˆ°è®¿é—®é™æ€å­—æ®µçš„æŒ‡ä»¤æ—¶ï¼Œåˆå§‹åŒ–è¯¥é™æ€å­—æ®µæ‰€åœ¨çš„ç±»ï¼›</li><li>å­ç±»çš„åˆå§‹åŒ–ä¼šè§¦å‘çˆ¶ç±»çš„åˆå§‹åŒ–ï¼›</li><li>å¦‚æœä¸€ä¸ªæ¥å£å®šä¹‰äº† default æ–¹æ³•ï¼Œé‚£ä¹ˆç›´æ¥å®ç°æˆ–è€…é—´æ¥å®ç°è¯¥æ¥å£çš„ç±»çš„åˆå§‹åŒ–ï¼Œä¼šè§¦å‘è¯¥æ¥å£çš„åˆå§‹åŒ–ï¼›</li><li>ä½¿ç”¨åå°„ API å¯¹æŸä¸ªç±»è¿›è¡Œåå°„è°ƒç”¨æ—¶ï¼Œåˆå§‹åŒ–è¿™ä¸ªç±»ï¼Œå…¶å®è·Ÿå‰é¢ä¸€æ ·ï¼Œåå°„è°ƒç”¨è¦ä¹ˆæ˜¯å·²ç»æœ‰å®ä¾‹äº†ï¼Œè¦ä¹ˆæ˜¯é™æ€æ–¹æ³•ï¼Œéƒ½éœ€è¦åˆå§‹åŒ–ï¼›</li><li>å½“åˆæ¬¡è°ƒç”¨ MethodHandle å®ä¾‹æ—¶ï¼Œåˆå§‹åŒ–è¯¥ MethodHandle æŒ‡å‘çš„æ–¹æ³•æ‰€åœ¨çš„ç±»ã€‚</li></ol><p>1ä¸»ç±»ï¼Œ2newï¼Œ3ï¼Œ4é™æ€è°ƒç”¨ï¼Œ5çˆ¶ç±»ï¼Œ6defaultï¼Œ7ï¼Œ8åå°„ </p><h3 id="ä¸ä¼šåˆå§‹åŒ–ï¼ˆå¯èƒ½ä¼šåŠ è½½ï¼‰"><a href="#ä¸ä¼šåˆå§‹åŒ–ï¼ˆå¯èƒ½ä¼šåŠ è½½ï¼‰" class="headerlink" title="ä¸ä¼šåˆå§‹åŒ–ï¼ˆå¯èƒ½ä¼šåŠ è½½ï¼‰"></a><strong>ä¸ä¼šåˆå§‹åŒ–ï¼ˆå¯èƒ½ä¼šåŠ è½½ï¼‰</strong></h3><ol><li>é€šè¿‡å­ç±»å¼•ç”¨çˆ¶ç±»çš„é™æ€å­—æ®µï¼Œåªä¼šè§¦å‘çˆ¶ç±»çš„åˆå§‹åŒ–ï¼Œè€Œä¸ä¼šè§¦å‘å­ç±»çš„åˆå§‹åŒ–ã€‚</li><li>å®šä¹‰å¯¹è±¡æ•°ç»„ï¼Œä¸ä¼šè§¦å‘è¯¥ç±»çš„åˆå§‹åŒ–ã€‚</li><li>å¸¸é‡åœ¨ç¼–è¯‘æœŸé—´ä¼šå­˜å…¥è°ƒç”¨ç±»çš„å¸¸é‡æ± ä¸­ï¼Œæœ¬è´¨ä¸Šå¹¶æ²¡æœ‰ç›´æ¥å¼•ç”¨å®šä¹‰å¸¸é‡çš„ç±»ï¼Œä¸ä¼šè§¦å‘å®šä¹‰å¸¸é‡æ‰€åœ¨çš„ç±»ã€‚</li><li>é€šè¿‡ç±»åè·å– Class å¯¹è±¡ï¼Œä¸ä¼šè§¦å‘ç±»çš„åˆå§‹åŒ–ï¼ŒHello.class ä¸ä¼šè®© Hello ç±»åˆå§‹åŒ–ã€‚</li><li>é€šè¿‡ Class.forName åŠ è½½æŒ‡å®šç±»æ—¶ï¼Œå¦‚æœæŒ‡å®šå‚æ•° initialize ä¸º false æ—¶ï¼Œä¹Ÿä¸ä¼šè§¦å‘ç±»åˆå§‹åŒ–ï¼Œå…¶å®è¿™ä¸ªå‚æ•°æ˜¯å‘Šè¯‰è™šæ‹Ÿæœºï¼Œæ˜¯å¦è¦å¯¹ç±»è¿›è¡Œåˆå§‹åŒ–ã€‚Class.forNameï¼ˆâ€œjvm.Helloâ€ï¼‰é»˜è®¤ä¼šåŠ è½½ Hello ç±»ã€‚</li><li>é€šè¿‡ ClassLoader é»˜è®¤çš„ loadClass æ–¹æ³•ï¼Œä¹Ÿä¸ä¼šè§¦å‘åˆå§‹åŒ–åŠ¨ä½œï¼ˆåŠ è½½äº†ï¼Œä½†æ˜¯ä¸åˆå§‹åŒ–ï¼‰ã€‚</li></ol><h3 id="ä¸‰ç±»åŠ è½½å™¨"><a href="#ä¸‰ç±»åŠ è½½å™¨" class="headerlink" title="ä¸‰ç±»åŠ è½½å™¨"></a><strong>ä¸‰ç±»åŠ è½½å™¨</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210218234847.png" alt="image-20210218234847003"></p><p>ä¸‰ç±»åŠ è½½å™¨ï¼š</p><ol><li>å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrapClassLoaderï¼‰</li><li>æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtClassLoaderï¼‰</li><li>åº”ç”¨ç±»åŠ è½½å™¨ï¼ˆAppClassLoaderï¼‰</li></ol><p>åŠ è½½å™¨ç‰¹ç‚¹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210218234857.png" alt="image-20210218234857042"></p><p>é¿å…ç±»è¢«é‡å¤åŠ è½½</p><ol><li>åŒäº²å§”æ‰˜ï¼šä¸šåŠ¡ç±»åŠ è½½å™¨ï¼Œéœ€è¦ç”¨ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œçˆ¶ç±»åŠ è½½å™¨é‡Œé¢æ˜¯å¦è¯¥ç±»å·²ç»è¢«åŠ è½½äº†ï¼Œå¦‚æœæ²¡æœ‰ï¼Œä»ç¥–çˆ¶åŠ è½½å™¨ä¸­æ‰¾æ˜¯å¦å·²ç»åŠ è½½äº†ï¼Œå¦‚æœæ‰¾åˆ°äº†å°±ç»™åº”ç”¨åŠ è½½å™¨ä½¿ç”¨</li><li>è´Ÿè´£ä¾èµ–ï¼š</li><li>ç¼“å­˜åŠ è½½ï¼šç±»åŠ è½½äº†å°±ç¼“å­˜èµ·æ¥ï¼Œå¯¹æ¯ä¸ªç±»åŠ è½½å™¨æ¥è¯´ï¼ŒåŒä¸€ä¸ªç±»å‹çš„ç±»åªä¼šè¢«åŠ è½½ä¸€æ¬¡</li></ol><p>jdk9ä¹‹å‰ExtClassLoaderå’ŒAppClassLoaderçš„çˆ¶ç±»éƒ½æ˜¯URLClassLoader</p><h3 id="æ˜¾ç¤ºå½“å‰ClassLoader-åŠ è½½äº†å“ªäº›-Jarï¼Ÿ"><a href="#æ˜¾ç¤ºå½“å‰ClassLoader-åŠ è½½äº†å“ªäº›-Jarï¼Ÿ" class="headerlink" title="æ˜¾ç¤ºå½“å‰ClassLoader åŠ è½½äº†å“ªäº› Jarï¼Ÿ"></a><strong>æ˜¾ç¤ºå½“å‰ClassLoader åŠ è½½äº†å“ªäº› Jarï¼Ÿ</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210218234951.png" alt="image-20210218234951527"></p><h3 id="è‡ªå®šä¹‰-ClassLoader"><a href="#è‡ªå®šä¹‰-ClassLoader" class="headerlink" title="è‡ªå®šä¹‰ ClassLoader"></a><strong>è‡ªå®šä¹‰ ClassLoader</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210218235043.png" alt="image-20210218235043536"></p><h3 id="æ·»åŠ å¼•ç”¨ç±»çš„å‡ ç§æ–¹å¼"><a href="#æ·»åŠ å¼•ç”¨ç±»çš„å‡ ç§æ–¹å¼" class="headerlink" title="æ·»åŠ å¼•ç”¨ç±»çš„å‡ ç§æ–¹å¼"></a><strong>æ·»åŠ å¼•ç”¨ç±»çš„å‡ ç§æ–¹å¼</strong></h3><p>1ã€æ”¾åˆ° JDK çš„ lib/ext ä¸‹ï¼Œæˆ–è€…-Djava.ext.dirs</p><p>2ã€ java â€“cp/classpath æˆ–è€… class æ–‡ä»¶æ”¾åˆ°å½“å‰è·¯å¾„</p><p>3ã€è‡ªå®šä¹‰ ClassLoader åŠ è½½</p><p>4ã€æ‹¿åˆ°å½“å‰æ‰§è¡Œç±»çš„ ClassLoaderï¼Œåå°„è°ƒç”¨ addUrl æ–¹æ³•æ·»åŠ  Jar æˆ–è·¯å¾„(JDK9 æ— æ•ˆ)ã€‚ï¼ˆJDK9ä¹‹ååªè¦ä¸€è¡Œï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210218235342.png" alt="image-20210218235342159"></p><h2 id="4-JVM-å†…å­˜æ¨¡å‹"><a href="#4-JVM-å†…å­˜æ¨¡å‹" class="headerlink" title="4.JVM å†…å­˜æ¨¡å‹"></a>4.JVM å†…å­˜æ¨¡å‹</h2><h3 id="JVM-å†…å­˜ç»“æ„"><a href="#JVM-å†…å­˜ç»“æ„" class="headerlink" title="JVM å†…å­˜ç»“æ„"></a><strong>JVM å†…å­˜ç»“æ„</strong></h3><p>![image-20210218235435915](/Users/cutie/Library/Application Support/typora-user-images/image-20210218235435915.png)</p><p>æ¯ä¸ªçº¿ç¨‹éƒ½åªèƒ½è®¿é—®è‡ªå·±çš„çº¿ç¨‹æ ˆã€‚</p><p>æ¯ä¸ªçº¿ç¨‹éƒ½ä¸èƒ½è®¿é—®ï¼ˆçœ‹ä¸è§ï¼‰å…¶ä»–çº¿ç¨‹çš„å±€éƒ¨å˜é‡ã€‚</p><p>æ‰€æœ‰åŸç”Ÿç±»å‹çš„å±€éƒ¨å˜é‡éƒ½å­˜å‚¨åœ¨çº¿ç¨‹æ ˆä¸­ï¼Œå› æ­¤å¯¹å…¶ä»–çº¿ç¨‹æ˜¯ä¸å¯è§çš„ã€‚</p><p>çº¿ç¨‹å¯ä»¥å°†ä¸€ä¸ªåŸç”Ÿå˜é‡å€¼çš„å‰¯æœ¬ä¼ ç»™å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œä½†ä¸èƒ½å…±äº«åŸç”Ÿå±€éƒ¨å˜é‡æœ¬èº«ã€‚</p><p>å †å†…å­˜ä¸­åŒ…å«äº† Java ä»£ç ä¸­åˆ›å»ºçš„æ‰€æœ‰å¯¹è±¡ï¼Œä¸ç®¡æ˜¯å“ªä¸ªçº¿ç¨‹åˆ›å»ºçš„ã€‚ å…¶ä¸­ä¹Ÿæ¶µç›–äº†åŒ…è£…ç±»å‹ï¼ˆä¾‹å¦‚ Byteï¼ŒIntegerï¼ŒLong ç­‰ï¼‰ã€‚</p><p>ä¸ç®¡æ˜¯åˆ›å»ºä¸€ä¸ªå¯¹è±¡å¹¶å°†å…¶èµ‹å€¼ç»™å±€éƒ¨å˜é‡ï¼Œ è¿˜æ˜¯èµ‹å€¼ç»™å¦ä¸€ä¸ªå¯¹è±¡çš„æˆå‘˜å˜é‡ï¼Œ åˆ›å»ºçš„å¯¹è±¡éƒ½ä¼šè¢«ä¿å­˜åˆ°å †å†…å­˜ä¸­ã€‚</p><p><strong>JVM å†…å­˜ç»“æ„</strong></p><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210218235503.png" alt="image-20210218235503518"></p><p>å¦‚æœæ˜¯åŸç”Ÿæ•°æ®ç±»å‹çš„å±€éƒ¨å˜é‡ï¼Œé‚£ä¹ˆå®ƒçš„å†…å®¹å°±å…¨éƒ¨ä¿ç•™åœ¨çº¿ç¨‹æ ˆä¸Šã€‚</p><p>å¦‚æœæ˜¯å¯¹è±¡å¼•ç”¨ï¼Œåˆ™æ ˆä¸­çš„å±€éƒ¨å˜é‡æ§½ä½ä¸­ä¿å­˜ç€å¯¹è±¡çš„å¼•ç”¨åœ°å€ï¼Œè€Œå®é™…çš„å¯¹è±¡å†…å®¹ä¿å­˜åœ¨å †ä¸­ã€‚</p><p>å¯¹è±¡çš„æˆå‘˜å˜é‡ä¸å¯¹è±¡æœ¬èº«ä¸€èµ·å­˜å‚¨åœ¨å †ä¸Š, ä¸ç®¡æˆå‘˜å˜é‡çš„ç±»å‹æ˜¯åŸç”Ÿæ•°å€¼ï¼Œè¿˜æ˜¯å¯¹è±¡å¼•ç”¨ã€‚ç±»çš„é™æ€å˜é‡åˆ™å’Œç±»å®šä¹‰ä¸€æ ·éƒ½ä¿å­˜åœ¨å †ä¸­ã€‚</p><p><strong>JVM å†…å­˜ç»“æ„</strong></p><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210218235528.png" alt="image-20210218235528760"></p><p>æ€»ç»“ä¸€ä¸‹ï¼šæ–¹æ³•ä¸­ä½¿ç”¨çš„åŸç”Ÿæ•°æ®ç±»å‹å’Œå¯¹è±¡å¼•ç”¨åœ°å€åœ¨æ ˆä¸Šå­˜å‚¨ï¼›å¯¹è±¡ã€å¯¹è±¡æˆå‘˜ä¸ç±»å®šä¹‰ã€é™æ€å˜é‡åœ¨å †ä¸Šã€‚</p><p>å †å†…å­˜åˆç§°ä¸ºâ€œå…±äº«å †â€ï¼Œå †ä¸­çš„æ‰€æœ‰å¯¹è±¡ï¼Œå¯ä»¥è¢«æ‰€æœ‰çº¿ç¨‹è®¿é—®, åªè¦ä»–ä»¬èƒ½æ‹¿åˆ°å¯¹è±¡çš„å¼•ç”¨åœ°å€ã€‚å¦‚æœä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®æŸä¸ªå¯¹è±¡æ—¶ï¼Œä¹Ÿå°±å¯ä»¥è®¿é—®è¯¥å¯¹è±¡çš„æˆå‘˜å˜é‡ã€‚</p><p>å¦‚æœä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨æŸä¸ªå¯¹è±¡çš„åŒä¸€æ–¹æ³•ï¼Œåˆ™å®ƒä»¬éƒ½å¯ä»¥è®¿é—®åˆ°è¿™ä¸ªå¯¹è±¡çš„æˆå‘˜å˜é‡ï¼Œä½†æ¯ä¸ªçº¿ç¨‹çš„å±€éƒ¨å˜é‡å‰¯æœ¬æ˜¯ç‹¬ç«‹çš„ã€‚</p><h3 id="JVM-å†…å­˜æ•´ä½“ç»“æ„"><a href="#JVM-å†…å­˜æ•´ä½“ç»“æ„" class="headerlink" title="JVM å†…å­˜æ•´ä½“ç»“æ„"></a><strong>JVM å†…å­˜æ•´ä½“ç»“æ„</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210218235541.png" alt="image-20210218235541105"></p><p>æ¯å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼ŒJVM å°±ä¼šåœ¨æ ˆç©ºé—´æ ˆåˆ†é…å¯¹åº”çš„ çº¿ç¨‹æ ˆ, æ¯”å¦‚ 1MB çš„ç©ºé—´ï¼ˆ-Xss1mï¼‰ã€‚</p><p>çº¿ç¨‹æ ˆä¹Ÿå«åš Java æ–¹æ³•æ ˆã€‚ å¦‚æœä½¿ç”¨äº†JNI æ–¹æ³•ï¼Œåˆ™ä¼šåˆ†é…ä¸€ä¸ªå•ç‹¬çš„æœ¬åœ°æ–¹æ³•æ ˆ(Native Stack)ã€‚</p><p>çº¿ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸€èˆ¬ä¼šæœ‰å¤šä¸ªæ–¹æ³•ç»„æˆè°ƒç”¨æ ˆï¼ˆStack Traceï¼‰, æ¯”å¦‚ A è°ƒç”¨ Bï¼ŒBè°ƒç”¨ Cã€‚ã€‚ã€‚æ¯æ‰§è¡Œåˆ°ä¸€ä¸ªæ–¹æ³•ï¼Œå°±ä¼šåˆ›å»ºå¯¹åº”çš„ æ ˆå¸§ï¼ˆFrameï¼‰ã€‚</p><h3 id="JVM-æ ˆå†…å­˜ç»“æ„"><a href="#JVM-æ ˆå†…å­˜ç»“æ„" class="headerlink" title="JVM æ ˆå†…å­˜ç»“æ„"></a><strong>JVM æ ˆå†…å­˜ç»“æ„</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210218235553.png" alt="image-20210218235553092"></p><p>æ ˆå¸§æ˜¯ä¸€ä¸ªé€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œå…·ä½“çš„å¤§å°åœ¨ä¸€ä¸ªæ–¹æ³•ç¼–å†™å®ŒæˆååŸºæœ¬ä¸Šå°±èƒ½ç¡®å®šã€‚</p><p>æ¯”å¦‚è¿”å›å€¼ éœ€è¦æœ‰ä¸€ä¸ªç©ºé—´å­˜æ”¾å§ï¼Œæ¯ä¸ªå±€éƒ¨å˜é‡éƒ½éœ€è¦å¯¹åº”çš„åœ°å€ç©ºé—´ï¼Œæ­¤å¤–è¿˜æœ‰ç»™æŒ‡ä»¤ä½¿ç”¨çš„ æ“ä½œæ•°æ ˆï¼Œä»¥åŠ class æŒ‡é’ˆï¼ˆæ ‡è¯†è¿™ä¸ªæ ˆå¸§å¯¹åº”çš„æ˜¯å“ªä¸ªç±»çš„æ–¹æ³•,æŒ‡å‘éå †é‡Œé¢çš„ Class å¯¹è±¡ï¼‰ã€‚</p><h3 id="JVM-å †å†…å­˜ç»“æ„"><a href="#JVM-å †å†…å­˜ç»“æ„" class="headerlink" title="JVM å †å†…å­˜ç»“æ„"></a><strong>JVM å †å†…å­˜ç»“æ„</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210218235608.png" alt="image-20210218235608903"></p><p>å †å†…å­˜æ˜¯æ‰€æœ‰çº¿ç¨‹å…±ç”¨çš„å†…å­˜ç©ºé—´ï¼ŒJVM å°†Heap å†…å­˜åˆ†ä¸ºå¹´è½»ä»£ï¼ˆYoung generationï¼‰å’Œè€å¹´ä»£ï¼ˆOld generation, ä¹Ÿå« Tenuredï¼‰ä¸¤éƒ¨åˆ†ã€‚</p><p>å¹´è½»ä»£è¿˜åˆ’åˆ†ä¸º 3 ä¸ªå†…å­˜æ± ï¼Œæ–°ç”Ÿä»£ï¼ˆEdenspaceï¼‰å’Œå­˜æ´»åŒºï¼ˆSurvivor spaceï¼‰, åœ¨å¤§éƒ¨åˆ†GC ç®—æ³•ä¸­æœ‰ 2 ä¸ªå­˜æ´»åŒºï¼ˆS0, S1ï¼‰ï¼Œåœ¨æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°çš„ä»»ä½•æ—¶åˆ»ï¼ŒS0 å’Œ S1 æ€»æœ‰ä¸€ä¸ªæ˜¯ç©ºçš„,ä½†ä¸€èˆ¬è¾ƒå°ï¼Œä¹Ÿä¸æµªè´¹å¤šå°‘ç©ºé—´ã€‚</p><p>Non-Heap æœ¬è´¨ä¸Šè¿˜æ˜¯ Heapï¼Œåªæ˜¯ä¸€èˆ¬ä¸å½’ GCç®¡ç†ï¼Œé‡Œé¢åˆ’åˆ†ä¸º 3 ä¸ªå†…å­˜æ± ã€‚Metaspace, ä»¥å‰å«æŒä¹…ä»£ï¼ˆæ°¸ä¹…ä»£, Permanentgenerationï¼‰, Java8 æ¢äº†ä¸ªåå­—å« Metaspace.</p><p>CCS, Compressed Class Space, å­˜æ”¾ class ä¿¡æ¯çš„ï¼Œå’Œ Metaspace æœ‰äº¤å‰ã€‚</p><p>Code Cache, å­˜æ”¾ JIT ç¼–è¯‘å™¨ç¼–è¯‘åçš„æœ¬åœ°æœºå™¨ä»£ç ã€‚</p><h3 id="CPU-ä¸å†…å­˜è¡Œä¸º"><a href="#CPU-ä¸å†…å­˜è¡Œä¸º" class="headerlink" title="CPU ä¸å†…å­˜è¡Œä¸º"></a><strong>CPU ä¸å†…å­˜è¡Œä¸º</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210218235702.png" alt="image-20210218235620082"></p><p>CPU ä¹±åºæ‰§è¡Œ</p><p>volatile å…³é”®å­—</p><p>åŸå­æ€§æ“ä½œ</p><p>å†…å­˜å±éšœ</p><h3 id="å°ç»“ï¼šä»€ä¹ˆæ˜¯-JMM"><a href="#å°ç»“ï¼šä»€ä¹ˆæ˜¯-JMM" class="headerlink" title="å°ç»“ï¼šä»€ä¹ˆæ˜¯ JMM?"></a><strong>å°ç»“ï¼šä»€ä¹ˆæ˜¯ JMM?</strong></h3><p>æ‰€æœ‰çš„å¯¹è±¡(åŒ…æ‹¬å†…éƒ¨çš„å®ä¾‹æˆå‘˜å˜é‡)ï¼Œstatic å˜é‡ï¼Œä»¥åŠæ•°ç»„ï¼Œéƒ½å¿…é¡»å­˜æ”¾åˆ°å †å†…å­˜ä¸­ã€‚</p><p>å±€éƒ¨å˜é‡ï¼Œæ–¹æ³•çš„å½¢å‚/å…¥å‚ï¼Œå¼‚å¸¸å¤„ç†è¯­å¥çš„å…¥å‚ä¸å…è®¸åœ¨çº¿ç¨‹ä¹‹é—´å…±äº«ï¼Œæ‰€ä»¥ä¸å—å†…å­˜æ¨¡å‹çš„å½±å“ã€‚</p><p>å¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹ä¸€ä¸ªå˜é‡è®¿é—®æ—¶ã€è¯»å–/å†™å…¥ã€‘ï¼Œè¿™æ—¶å€™åªè¦æœ‰æŸä¸ªçº¿ç¨‹æ‰§è¡Œçš„æ˜¯å†™æ“ä½œï¼Œé‚£ä¹ˆè¿™ç§ç°è±¡å°±ç§°ä¹‹ä¸ºâ€œå†²çªâ€ã€‚</p><p>å¯ä»¥è¢«å…¶ä»–çº¿ç¨‹å½±å“æˆ–æ„ŸçŸ¥çš„æ“ä½œï¼Œç§°ä¸ºçº¿ç¨‹é—´çš„äº¤äº’è¡Œä¸ºï¼Œ å¯åˆ†ä¸ºï¼š è¯»å–ã€å†™å…¥ã€åŒæ­¥æ“ä½œã€å¤–éƒ¨æ“ä½œç­‰ç­‰ã€‚ å…¶ä¸­åŒæ­¥æ“ä½œåŒ…æ‹¬ï¼šå¯¹ volatile å˜é‡çš„è¯»å†™ï¼Œå¯¹ç®¡ç¨‹ï¼ˆmonitorï¼‰çš„é”å®šä¸è§£é”ï¼Œçº¿ç¨‹çš„èµ·å§‹æ“ä½œä¸ç»“å°¾æ“ä½œï¼Œçº¿ç¨‹å¯åŠ¨å’Œç»“æŸç­‰ç­‰ã€‚ å¤–éƒ¨æ“ä½œåˆ™æ˜¯æŒ‡å¯¹çº¿ç¨‹æ‰§è¡Œç¯å¢ƒä¹‹å¤–çš„æ“ä½œï¼Œæ¯”å¦‚åœæ­¢å…¶ä»–çº¿ç¨‹ç­‰ç­‰ã€‚</p><p>JMM è§„èŒƒçš„æ˜¯çº¿ç¨‹é—´çš„äº¤äº’æ“ä½œï¼Œè€Œä¸ç®¡çº¿ç¨‹å†…éƒ¨å¯¹å±€éƒ¨å˜é‡è¿›è¡Œçš„æ“ä½œã€‚</p><p>JMM è§„èŒƒå¯¹åº”çš„æ˜¯â€œ[JSR-133. JavaMemory Model and ThreadSpecification]â€ï¼Œã€ŠJava è¯­è¨€è§„èŒƒã€‹çš„ [$17.4. Memory Modelç« èŠ‚]</p><p>JMM è§„èŒƒæ˜ç¡®å®šä¹‰äº†ä¸åŒçš„çº¿ç¨‹ä¹‹é—´ï¼Œé€šè¿‡å“ªäº›æ–¹å¼ï¼Œåœ¨ä»€ä¹ˆæ—¶å€™å¯ä»¥çœ‹è§å…¶ä»–çº¿ç¨‹ä¿å­˜åˆ°å…±äº«å˜é‡ä¸­çš„å€¼ï¼›ä»¥åŠåœ¨å¿…è¦æ—¶ï¼Œå¦‚ä½•å¯¹å…±äº«å˜é‡çš„è®¿é—®è¿›è¡ŒåŒæ­¥ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯å±è”½å„ç§ç¡¬ä»¶å¹³å°å’Œæ“ä½œç³»ç»Ÿä¹‹é—´çš„å†…å­˜è®¿é—®å·®å¼‚ï¼Œå®ç°äº† Java å¹¶å‘ç¨‹åºçœŸæ­£çš„è·¨å¹³å°ã€‚</p><h2 id="5-JVM-å¯åŠ¨å‚æ•°"><a href="#5-JVM-å¯åŠ¨å‚æ•°" class="headerlink" title="5.JVM å¯åŠ¨å‚æ•°"></a>5.JVM å¯åŠ¨å‚æ•°</h2><h3 id="JVM-å¯åŠ¨å‚æ•°"><a href="#JVM-å¯åŠ¨å‚æ•°" class="headerlink" title="JVM å¯åŠ¨å‚æ•°"></a><strong>JVM å¯åŠ¨å‚æ•°</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210218235702.png" alt="image-20210218235702045"></p><p><strong>JVM å¯åŠ¨å‚æ•°</strong></p><p>![image-20210218235740388](/Users/cutie/Library/Application Support/typora-user-images/image-20210218235740388.png)</p><p>-server</p><p>-Dfile.encoding=UTF-8</p><p>-Xmx8g</p><p>-XX:+UseG1GC</p><p>-XX:MaxPermSize=256m</p><p>ä»¥-å¼€å¤´ä¸ºæ ‡å‡†å‚æ•°ï¼Œæ‰€æœ‰çš„ JVM éƒ½è¦å®ç°è¿™äº›å‚æ•°ï¼Œå¹¶ä¸”å‘åå…¼å®¹ã€‚</p><p>-D è®¾ç½®ç³»ç»Ÿå±æ€§ã€‚</p><p>ä»¥ -X å¼€å¤´ä¸ºéæ ‡å‡†å‚æ•°ï¼Œ åŸºæœ¬éƒ½æ˜¯ä¼ ç»™ JVM çš„ï¼Œé»˜è®¤ JVM å®ç°è¿™äº›å‚æ•°çš„åŠŸèƒ½ï¼Œä½†æ˜¯å¹¶ä¸ä¿è¯æ‰€æœ‰ JVM å®ç°éƒ½æ»¡è¶³ï¼Œä¸”ä¸ä¿è¯å‘åå…¼å®¹ã€‚ å¯ä»¥ä½¿ç”¨ java -X å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰ JVM æ”¯æŒçš„éæ ‡å‡†å‚æ•°ã€‚</p><p>ä»¥ â€“XXï¼šå¼€å¤´ä¸ºéç¨³å®šå‚æ•°, ä¸“é—¨ç”¨äºæ§åˆ¶ JVMçš„è¡Œä¸ºï¼Œè·Ÿå…·ä½“çš„ JVM å®ç°æœ‰å…³ï¼Œéšæ—¶å¯èƒ½ä¼šåœ¨ä¸‹ä¸ªç‰ˆæœ¬å–æ¶ˆã€‚</p><p>XXï¼š+-Flags å½¢å¼, +- æ˜¯å¯¹å¸ƒå°”å€¼è¿›è¡Œå¼€å…³ã€‚</p><p>XXï¼škey=value å½¢å¼, æŒ‡å®šæŸä¸ªé€‰é¡¹çš„å€¼ã€‚</p><p><strong>JVM å¯åŠ¨å‚æ•°</strong></p><ol><li>ç³»ç»Ÿå±æ€§å‚æ•°</li><li>è¿è¡Œæ¨¡å¼å‚æ•°</li><li>å †å†…å­˜è®¾ç½®å‚æ•°</li><li>GC è®¾ç½®å‚æ•°</li><li>åˆ†æè¯Šæ–­å‚æ•°</li><li>JavaAgent å‚æ•°</li></ol><h3 id="JVM-å¯åŠ¨å‚æ•°-ç³»ç»Ÿå±æ€§"><a href="#JVM-å¯åŠ¨å‚æ•°-ç³»ç»Ÿå±æ€§" class="headerlink" title="JVM å¯åŠ¨å‚æ•°-ç³»ç»Ÿå±æ€§"></a><strong>JVM å¯åŠ¨å‚æ•°-ç³»ç»Ÿå±æ€§</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/cutieagain/images@main/20210218235809.png" alt="image-20210218235809898"></p><p>-Dfile.encoding=UTF-8</p><p>-Duser.timezone=GMT+08</p><p>-Dmaven.test.skip=true</p><p>-Dio.netty.eventLoopThreads=8</p><p>System.setProperty(â€œaâ€,â€A100â€);</p><p>String a=System.getProperty(â€œaâ€);</p><p><strong>Linuxä¸Šè¿˜å¯ä»¥é€šè¿‡: a=A100 java XXXJVM</strong></p><h3 id="å¯åŠ¨å‚æ•°-è¿è¡Œæ¨¡å¼"><a href="#å¯åŠ¨å‚æ•°-è¿è¡Œæ¨¡å¼" class="headerlink" title="å¯åŠ¨å‚æ•°-è¿è¡Œæ¨¡å¼"></a><strong>å¯åŠ¨å‚æ•°-è¿è¡Œæ¨¡å¼</strong></h3><ol><li>-serverï¼šè®¾ç½® JVM ä½¿ç”¨ server æ¨¡å¼ï¼Œç‰¹ç‚¹æ˜¯å¯åŠ¨é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œä½†è¿è¡Œæ—¶æ€§èƒ½å’Œå†…å­˜ç®¡ç†æ•ˆç‡å¾ˆé«˜ï¼Œé€‚ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚åœ¨å…·æœ‰ 64 ä½èƒ½åŠ›çš„ JDK ç¯å¢ƒä¸‹å°†é»˜è®¤å¯ç”¨è¯¥æ¨¡å¼ï¼Œè€Œå¿½ç•¥ -client å‚æ•°ã€‚</li><li>-client ï¼šJDK1.7 ä¹‹å‰åœ¨32ä½çš„ x86 æœºå™¨ä¸Šçš„é»˜è®¤å€¼æ˜¯ -client é€‰é¡¹ã€‚è®¾ç½® JVM ä½¿ç”¨ client æ¨¡å¼ï¼Œç‰¹ç‚¹æ˜¯å¯åŠ¨é€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œä½†è¿è¡Œæ—¶æ€§èƒ½å’Œå†…å­˜ç®¡ç†æ•ˆç‡ä¸é«˜ï¼Œé€šå¸¸ç”¨äºå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºæˆ–è€… PC åº”ç”¨å¼€å‘å’Œè°ƒè¯•ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬çŸ¥é“ JVM åŠ è½½å­—èŠ‚ç åï¼Œå¯ä»¥è§£é‡Šæ‰§è¡Œï¼Œä¹Ÿå¯ä»¥ç¼–è¯‘æˆæœ¬åœ°ä»£ç å†æ‰§è¡Œï¼Œæ‰€ä»¥å¯ä»¥é…ç½® JVM å¯¹å­—èŠ‚ç çš„å¤„ç†æ¨¡å¼ï¼š</li><li>-Xintï¼šåœ¨è§£é‡Šæ¨¡å¼ï¼ˆinterpreted modeï¼‰ä¸‹è¿è¡Œï¼Œ-Xint æ ‡è®°ä¼šå¼ºåˆ¶ JVM è§£é‡Šæ‰§è¡Œæ‰€æœ‰çš„å­—èŠ‚ç ï¼Œè¿™å½“ç„¶ä¼šé™ä½è¿è¡Œé€Ÿåº¦ï¼Œé€šå¸¸ä½10å€æˆ–æ›´å¤šã€‚</li><li>-Xcompï¼š-Xcomp å‚æ•°ä¸-Xint æ­£å¥½ç›¸åï¼ŒJVM åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶ä¼šæŠŠæ‰€æœ‰çš„å­—èŠ‚ç ç¼–è¯‘æˆæœ¬åœ°ä»£ç ï¼Œä»è€Œå¸¦æ¥æœ€å¤§ç¨‹åº¦çš„ä¼˜åŒ–ã€‚ã€æ³¨æ„é¢„çƒ­ã€‘</li><li>-Xmixedï¼š-Xmixed æ˜¯æ··åˆæ¨¡å¼ï¼Œå°†è§£é‡Šæ¨¡å¼å’Œç¼–è¯‘æ¨¡å¼è¿›è¡Œæ··åˆä½¿ç”¨ï¼Œæœ‰ JVM è‡ªå·±å†³å®šï¼Œè¿™æ˜¯ JVM çš„é»˜è®¤æ¨¡å¼ï¼Œä¹Ÿæ˜¯æ¨èæ¨¡å¼ã€‚ æˆ‘ä»¬ä½¿ç”¨ java -version å¯ä»¥çœ‹åˆ° mixed mode ç­‰ä¿¡æ¯ã€‚</li></ol><p><strong>JVM å¯åŠ¨å‚æ•°-å †å†…å­˜</strong></p><p>![image-20210218235833782](/Users/cutie/Library/Application Support/typora-user-images/image-20210218235833782.png)</p><p>-Xmx, æŒ‡å®šæœ€å¤§å †å†…å­˜ã€‚ å¦‚ -Xmx4g. è¿™åªæ˜¯é™åˆ¶äº† Heap éƒ¨åˆ†çš„æœ€å¤§å€¼ä¸º4gã€‚è¿™ä¸ªå†…å­˜ä¸åŒ…æ‹¬æ ˆå†…å­˜ï¼Œä¹Ÿä¸åŒ…æ‹¬å †å¤–ä½¿ç”¨çš„å†…å­˜ã€‚</p><p>-Xms, æŒ‡å®šå †å†…å­˜ç©ºé—´çš„åˆå§‹å¤§å°ã€‚ å¦‚ -Xms4gã€‚ è€Œä¸”æŒ‡å®šçš„å†…å­˜å¤§å°ï¼Œå¹¶ä¸æ˜¯æ“ä½œç³»ç»Ÿå®é™…åˆ†é…çš„åˆå§‹å€¼ï¼Œè€Œæ˜¯GCå…ˆè§„åˆ’å¥½ï¼Œç”¨åˆ°æ‰åˆ†é…ã€‚ ä¸“ç”¨æœåŠ¡å™¨ä¸Šéœ€è¦ä¿æŒ â€“Xms å’Œ â€“Xmx ä¸€è‡´ï¼Œå¦åˆ™åº”ç”¨åˆšå¯åŠ¨å¯èƒ½å°±æœ‰å¥½å‡ ä¸ª FullGCã€‚å½“ä¸¤è€…é…ç½®ä¸ä¸€è‡´æ—¶ï¼Œå †å†…å­˜æ‰©å®¹å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½æŠ–åŠ¨ã€‚</p><p>-Xmn, ç­‰ä»·äº -XX:NewSizeï¼Œä½¿ç”¨ G1 åƒåœ¾æ”¶é›†å™¨ ä¸åº”è¯¥ è®¾ç½®è¯¥é€‰é¡¹ï¼Œåœ¨å…¶ä»–çš„æŸäº›ä¸šåŠ¡åœºæ™¯ä¸‹å¯ä»¥è®¾ç½®ã€‚å®˜æ–¹å»ºè®®è®¾ç½®ä¸º -Xmx çš„ 1/2 ~ 1/4.</p><p>-XXï¼šMaxPermSize=size, è¿™æ˜¯ JDK1.7 ä¹‹å‰ä½¿ç”¨çš„ã€‚Java8 é»˜è®¤å…è®¸çš„Metaç©ºé—´æ— é™å¤§ï¼Œæ­¤å‚æ•°æ— æ•ˆã€‚</p><p>-XXï¼šMaxMetaspaceSize=size, Java8 é»˜è®¤ä¸é™åˆ¶ Meta ç©ºé—´, ä¸€èˆ¬ä¸å…è®¸è®¾ç½®è¯¥é€‰é¡¹ã€‚</p><p>-XXï¼šMaxDirectMemorySize=sizeï¼Œç³»ç»Ÿå¯ä»¥ä½¿ç”¨çš„æœ€å¤§å †å¤–å†…å­˜ï¼Œè¿™ä¸ªå‚æ•°è·Ÿ -Dsun.nio.MaxDirectMemorySize æ•ˆæœç›¸åŒã€‚</p><p>-Xss, è®¾ç½®æ¯ä¸ªçº¿ç¨‹æ ˆçš„å­—èŠ‚æ•°ã€‚ ä¾‹å¦‚ -Xss1m æŒ‡å®šçº¿ç¨‹æ ˆä¸º 1MBï¼Œä¸-XX:ThreadStackSize=1m ç­‰ä»·</p><p>å †å†…ï¼ˆXms-Xmxï¼‰</p><p>éå †+å †å¤–</p><ol><li>å¦‚æœä»€ä¹ˆéƒ½ä¸é…ç½®ä¼šå¦‚ä½•ï¼Ÿ</li><li>Xmx æ˜¯å¦ä¸ Xms è®¾ç½®ç›¸ç­‰ï¼Ÿ</li><li>Xmx è®¾ç½®ä¸ºæœºå™¨å†…å­˜çš„ä»€ä¹ˆæ¯”ä¾‹åˆé€‚ï¼Ÿ</li><li>ä½œä¸šï¼šç”»ä¸€ä¸‹ Xmxã€Xmsã€Xmnã€Metaã€</li></ol><p>DirectMemoryã€Xss è¿™äº›å†…å­˜å‚æ•°çš„å…³ç³»</p><h3 id="JVM-å¯åŠ¨å‚æ•°-GC-ç›¸å…³"><a href="#JVM-å¯åŠ¨å‚æ•°-GC-ç›¸å…³" class="headerlink" title="JVM å¯åŠ¨å‚æ•° - GC ç›¸å…³"></a><strong>JVM å¯åŠ¨å‚æ•° - GC ç›¸å…³</strong></h3><p>![image-20210218235908235](/Users/cutie/Library/Application Support/typora-user-images/image-20210218235908235.png)</p><p>-XXï¼š+UseG1GCï¼šä½¿ç”¨ G1 åƒåœ¾å›æ”¶å™¨</p><p>-XXï¼š+UseConcMarkSweepGCï¼šä½¿ç”¨ CMS åƒåœ¾å›æ”¶å™¨</p><p>-XXï¼š+UseSerialGCï¼šä½¿ç”¨ä¸²è¡Œåƒåœ¾å›æ”¶å™¨</p><p>-XXï¼š+UseParallelGCï¼šä½¿ç”¨å¹¶è¡Œåƒåœ¾å›æ”¶å™¨</p><p>// Java 11+</p><p>-XXï¼š+UnlockExperimentalVMOptions -XX:+UseZGC</p><p>// Java 12+</p><ol><li>å„ä¸ª JVM ç‰ˆæœ¬çš„é»˜è®¤ GC æ˜¯ä»€ä¹ˆï¼Ÿ -XXï¼š+UnlockExperimentalVMOptions -XX:+UseShenandoahGC</li></ol><h3 id="JVM-å¯åŠ¨å‚æ•°-åˆ†æè¯Šæ–­"><a href="#JVM-å¯åŠ¨å‚æ•°-åˆ†æè¯Šæ–­" class="headerlink" title="JVM å¯åŠ¨å‚æ•°-åˆ†æè¯Šæ–­"></a><strong>JVM å¯åŠ¨å‚æ•°-åˆ†æè¯Šæ–­</strong></h3><p>-XXï¼š+-HeapDumpOnOutOfMemoryError é€‰é¡¹, å½“ OutOfMemoryError äº§ç”Ÿï¼Œå³å†…å­˜æº¢å‡º(å †å†…æˆ–æŒä¹…ä»£)æ—¶ï¼Œè‡ªåŠ¨ Dump å †å†…å­˜ã€‚</p><p>ç¤ºä¾‹ç”¨æ³•ï¼š java -XX:+HeapDumpOnOutOfMemoryError -Xmx256m ConsumeHeap</p><p>-XXï¼šHeapDumpPath é€‰é¡¹, ä¸ HeapDumpOnOutOfMemoryError æ­é…ä½¿ç”¨, æŒ‡å®šå†…å­˜æº¢å‡ºæ—¶ Dumpæ–‡ä»¶çš„ç›®å½•ã€‚</p><p>å¦‚æœæ²¡æœ‰æŒ‡å®šåˆ™é»˜è®¤ä¸ºå¯åŠ¨ Java ç¨‹åºçš„å·¥ä½œç›®å½•ã€‚</p><p>ç¤ºä¾‹ç”¨æ³•ï¼š java -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/usr/local/ ConsumeHeap</p><p>è‡ªåŠ¨ Dump çš„ hprof æ–‡ä»¶ä¼šå­˜å‚¨åˆ° /usr/local/ ç›®å½•ä¸‹ã€‚</p><p>-XXï¼šOnError é€‰é¡¹, å‘ç”Ÿè‡´å‘½é”™è¯¯æ—¶ï¼ˆfatal errorï¼‰æ‰§è¡Œçš„è„šæœ¬ã€‚</p><p>ä¾‹å¦‚, å†™ä¸€ä¸ªè„šæœ¬æ¥è®°å½•å‡ºé”™æ—¶é—´, æ‰§è¡Œä¸€äº›å‘½ä»¤, æˆ–è€… curl ä¸€ä¸‹æŸä¸ªåœ¨çº¿æŠ¥è­¦çš„ url.</p><p>ç¤ºä¾‹ç”¨æ³•ï¼šjava -XX:OnError=â€gdb - %pâ€ MyApp</p><p>å¯ä»¥å‘ç°æœ‰ä¸€ä¸ª %p çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè¿›ç¨‹ PIDã€‚</p><p>-XXï¼šOnOutOfMemoryError é€‰é¡¹, æŠ›å‡º OutOfMemoryError é”™è¯¯æ—¶æ‰§è¡Œçš„è„šæœ¬ã€‚</p><p>-XXï¼šErrorFile=filename é€‰é¡¹, è‡´å‘½é”™è¯¯çš„æ—¥å¿—æ–‡ä»¶å,ç»å¯¹è·¯å¾„æˆ–è€…ç›¸å¯¹è·¯å¾„ã€‚</p><p>-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=1506ï¼Œè¿œç¨‹è°ƒè¯•</p><h3 id="JVM-å¯åŠ¨å‚æ•°-JavaAgent"><a href="#JVM-å¯åŠ¨å‚æ•°-JavaAgent" class="headerlink" title="JVM å¯åŠ¨å‚æ•° -JavaAgent"></a><strong>JVM å¯åŠ¨å‚æ•° -JavaAgent</strong></h3><p>Agent æ˜¯ JVM ä¸­çš„ä¸€é¡¹é»‘ç§‘æŠ€, å¯ä»¥é€šè¿‡æ— ä¾µå…¥æ–¹å¼æ¥åšå¾ˆå¤šäº‹æƒ…ï¼Œæ¯”å¦‚æ³¨å…¥ AOP ä»£ç ï¼Œæ‰§è¡Œç»Ÿè®¡ç­‰ç­‰ï¼Œæƒé™éå¸¸å¤§ã€‚è¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹é…ç½®é€‰é¡¹ï¼Œè¯¦ç»†åŠŸèƒ½éœ€è¦ä¸“é—¨æ¥è®²ã€‚</p><p>è®¾ç½® agent çš„è¯­æ³•å¦‚ä¸‹:</p><p>agentlib:libname[=options] å¯ç”¨ native æ–¹å¼çš„ agent, å‚è€ƒ LD_LIBRARY_PATH è·¯å¾„ã€‚</p><p>agentpath:pathname[=options] å¯ç”¨ native æ–¹å¼çš„ agentã€‚</p><p>javaagent:jarpath[=options] å¯ç”¨å¤–éƒ¨çš„ agent åº“, æ¯”å¦‚ pinpoint.jar ç­‰ç­‰ã€‚</p><p>Xnoagent åˆ™æ˜¯ç¦ç”¨æ‰€æœ‰ agentã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹å¼€å¯ CPU ä½¿ç”¨æ—¶é—´æŠ½æ ·åˆ†æ:</p><p>JAVA_OPTS=â€-agentlib:hprof=cpu=samples,file=cpu.samples.logâ€</p><h2 id="6-æ€»ç»“å›é¡¾ä¸ä½œä¸šå®è·µ"><a href="#6-æ€»ç»“å›é¡¾ä¸ä½œä¸šå®è·µ" class="headerlink" title="6.æ€»ç»“å›é¡¾ä¸ä½œä¸šå®è·µ"></a>6.æ€»ç»“å›é¡¾ä¸ä½œä¸šå®è·µ</h2><h3 id="ç¬¬1è¯¾æ€»ç»“å›é¡¾"><a href="#ç¬¬1è¯¾æ€»ç»“å›é¡¾" class="headerlink" title="ç¬¬1è¯¾æ€»ç»“å›é¡¾"></a><strong>ç¬¬1è¯¾æ€»ç»“å›é¡¾</strong></h3><p>å­—èŠ‚ç æŠ€æœ¯</p><p>ç±»åŠ è½½å™¨</p><p>å†…å­˜æ¨¡å‹</p><p>å¯åŠ¨å‚æ•°</p><h3 id="ç¬¬1è¯¾ä½œä¸šå®è·µ"><a href="#ç¬¬1è¯¾ä½œä¸šå®è·µ" class="headerlink" title="ç¬¬1è¯¾ä½œä¸šå®è·µ"></a><strong>ç¬¬1è¯¾ä½œä¸šå®è·µ</strong></h3><p>1ã€ï¼ˆå¯é€‰ï¼‰è‡ªå·±å†™ä¸€ä¸ªç®€å•çš„ Hello.javaï¼Œé‡Œé¢éœ€è¦æ¶‰åŠåŸºæœ¬ç±»å‹ï¼Œå››åˆ™è¿è¡Œï¼Œif å’Œ forï¼Œç„¶åè‡ªå·±åˆ†æä¸€ä¸‹å¯¹åº”çš„å­—èŠ‚ç ï¼Œæœ‰é—®é¢˜ç¾¤é‡Œè®¨è®ºã€‚</p><p>2ã€ï¼ˆå¿…åšï¼‰è‡ªå®šä¹‰ä¸€ä¸ª Classloaderï¼ŒåŠ è½½ä¸€ä¸ª Hello.xlass æ–‡ä»¶ï¼Œæ‰§è¡Œ hello æ–¹æ³•ï¼Œæ­¤æ–‡ä»¶å†…å®¹æ˜¯ä¸€ä¸ª Hello.class æ–‡ä»¶æ‰€æœ‰å­—èŠ‚ï¼ˆx=255-xï¼‰å¤„ç†åçš„æ–‡ä»¶ã€‚æ–‡ä»¶ç¾¤é‡Œæä¾›ã€‚</p><p>3ã€ï¼ˆå¿…åšï¼‰ç”»ä¸€å¼ å›¾ï¼Œå±•ç¤º Xmxã€Xmsã€Xmnã€Metaã€DirectMemoryã€Xss è¿™äº›å†…å­˜å‚æ•°çš„å…³ç³»ã€‚</p><p>4ã€ï¼ˆå¯é€‰ï¼‰æ£€æŸ¥ä¸€ä¸‹è‡ªå·±ç»´æŠ¤çš„ä¸šåŠ¡ç³»ç»Ÿçš„ JVM å‚æ•°é…ç½®ï¼Œç”¨ jstat å’Œ jstackã€jmap æŸ¥çœ‹ä¸€ä¸‹è¯¦æƒ…ï¼Œå¹¶ä¸”è‡ªå·±ç‹¬ç«‹åˆ†æä¸€ä¸‹å¤§æ¦‚æƒ…å†µï¼Œæ€è€ƒæœ‰æ²¡æœ‰ä¸åˆç†çš„åœ°æ–¹ï¼Œå¦‚ä½•æ”¹è¿›ã€‚</p><p>æ³¨æ„ï¼šå¦‚æœæ²¡æœ‰çº¿ä¸Šç³»ç»Ÿï¼Œå¯ä»¥è‡ªå·± run ä¸€ä¸ª web/java é¡¹ç›®ã€‚</p><h2 id="7-å…¶ä»–ç¬”è®°"><a href="#7-å…¶ä»–ç¬”è®°" class="headerlink" title="7.å…¶ä»–ç¬”è®°"></a>7.å…¶ä»–ç¬”è®°</h2><p>javaç‰¹æ€§</p><p>GC - åƒåœ¾å›æ”¶ï¼Œjvmå†…å­˜ç®¡ç†å™¨ï¼›golangå’Œruståœ¨ç¼–è¯‘æ—¶å€™å°±è¿›è¡Œåƒåœ¾å›æ”¶å¤„ç†ï¼Œä¸éœ€è¦è™šæ‹Ÿæœºã€‚javaæ˜¯äºŒè¿›åˆ¶è·¨å¹³å°ï¼Œc&amp;c++æ˜¯æºä»£ç è·¨å¹³å°çš„ã€‚</p><p>javaè·¨å¹³å°ï¼Œä¸€ç›´å‘å‰å…¼å®¹ï¼Œç”Ÿæ€å®Œæ•´ï¼ˆä»»ä½•ä¸œè¥¿javaå®ç°éƒ½å¯ä»¥æ‰¾åˆ°ï¼‰ã€‚</p><p><strong>æ€»ç»“ä¸‹å­¦äº†ä»€ä¹ˆï¼Œæœ‰å“ªäº›ç‚¹æ²¡æ‡‚ï¼Ÿ</strong></p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æå®¢æ—¶é—´ </tag>
            
            <tag> ç§¦é‡‘å« </tag>
            
            <tag> æå®¢å¤§å­¦ </tag>
            
            <tag> Java è¿›é˜¶è®­ç»ƒè¥ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="2021/02/18/hello-world/"/>
      <url>2021/02/18/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo new <span class="token string">"My New Post"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo generate<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo deploy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      <categories>
          
          <category> hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
            <tag> åšå®¢ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
